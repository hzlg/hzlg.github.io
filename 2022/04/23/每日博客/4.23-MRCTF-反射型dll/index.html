<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="re,game," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="MRCTF，没出的cicada 复盘后得知是反射加载了位于data段的dll,其中存在一个ast执行器用于加解密 直接动调就能找到dll,ast是当时没做出来的原因">
<meta property="og:type" content="article">
<meta property="og:title" content="4.23-MRCTF-cicada-反射型dll">
<meta property="og:url" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/index.html">
<meta property="og:site_name" content="hzlg&#39;s blog">
<meta property="og:description" content="MRCTF，没出的cicada 复盘后得知是反射加载了位于data段的dll,其中存在一个ast执行器用于加解密 直接动调就能找到dll,ast是当时没做出来的原因">
<meta property="og:locale">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220711202309664.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220423231601691.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220423234358532.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220423234947263.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220711214225913.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220711233049062.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220711233237039.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220711233909470.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220711233815488.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/68747470733a2f2f6d642e627570746d6572616b2e636e2f75706c6f6164732f75706c6f61645f39313636616134323534353966336338656361356633656438666663333832652e706e67.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/68747470733a2f2f6d642e627570746d6572616b2e636e2f75706c6f6164732f75706c6f61645f63633633356639343232393732376339366433663763366237633130396166662e706e67.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220712145948349.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220712150026148.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220712150000102.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220712152230593.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220712154932288.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/68747470733a2f2f6d642e627570746d6572616b2e636e2f75706c6f6164732f75706c6f61645f30313662613566666230336636343732623564383163306635323664663264392e706e67.png">
<meta property="article:published_time" content="2022-04-22T16:00:00.000Z">
<meta property="article:modified_time" content="2022-07-24T16:13:57.619Z">
<meta property="article:author" content="hzlg">
<meta property="article:tag" content="re">
<meta property="article:tag" content="game">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220711202309664.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://hzlg.github.ioz/2022/04/23/每日博客/4.23-MRCTF-反射型dll/"/>





  <title>4.23-MRCTF-cicada-反射型dll | hzlg's blog</title>
  














<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">hzlg's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">笔记、日常</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hzlg.github.ioz/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hzlg's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">4.23-MRCTF-cicada-反射型dll</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-04-23T00:00:00+08:00">
                2022-04-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>MRCTF，没出的cicada</p>
<p>复盘后得知是反射加载了位于data段的dll,其中存在一个ast执行器用于加解密</p>
<p>直接动调就能找到dll,ast是当时没做出来的原因</p>
<span id="more"></span>

<h2 id="DLL注入"><a href="#DLL注入" class="headerlink" title="DLL注入"></a>DLL注入</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/h2zZhou/p/7721797.html">DLL注入新姿势：反射式DLL注入研究</a></p>
<p><a target="_blank" rel="noopener" href="http://www.ctfiot.com/18464.html">【免杀72】sRDI反射型DLL注入免杀</a></p>
<p><strong>常规</strong>的DLL注入方式 : 利用<code>CreateRemoteThread</code>这一函数在目标进程中开始一个新的线程，这个线程执行系统的API函数<code>LoadLibrary</code>，之后DLL就被装载到目标进程中了。而常规的注入方式太过于套路化(CreateRemoteThread+ LoadLibrary)，导致它十分容易被检测出来。同时，常规的DLL注入方式还需要目标<strong>DLL必须存在磁盘上，而文件一旦“落地”就也存在着被杀毒软件查杀的风险。</strong>(文件落地指存在硬盘里,不落地指直接内存执行)</p>
<blockquote>
<p><strong>具体注入方式</strong></p>
<ol>
<li><code>VirtualAllocEx</code> 在目标进程内存空间申请内存，<code>WriteProcessMemory</code> 写入dll路径，<code>CreateRemoteThread</code> 创建远程线程调用 <code>LoadLibrary</code> 加载dll；</li>
<li>CreateRemoteThread 可被 替换为其他创建线程的API（例如：RtlCreateUserThread，或者挂起线程修改线程上下文再还原等等），减少被拦截的风险</li>
<li>替换程序运行时会加载的dll；</li>
<li>修改注册表键值AppInit_dll，程序启动时如果加载了USER32.dll，就会自动加载该键值下的有效dll；</li>
<li>SetWindowsHookEx挂钩,IAT_HOOK,InLine_HOOK等(本质也是让目标进程执行自己的代码)(x86与x64下InLine_HOOK略有不同)；</li>
<li>dll加载顺序挟持(Dll Search Order Hijacking);</li>
</ol>
</blockquote>
<p><img src="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220711202309664.png" alt="image-20220711202309664"> </p>
<p><strong>反射式</strong>DLL注入方式 : <strong>不使用LoadLibrary</strong>,而是自己来实现整个装载过程,在操作系统中<strong>没有”注册”DLL</strong>,因此更容易通过杀软的行为检测。且<strong>不需要在文件系统存放目标DLL</strong>，减少了文件“落地”被删的风险。</p>
<ul>
<li><p>不使用LoadLibrary,我们可以为待注入的DLL添加一个导出函数，<code>ReflectiveLoader</code>，这个函数实现的功能就是装载它自身。那么我们只需要将这个DLL文件写入目标进程的虚拟空间中，然后通过DLL的导出表找到这个ReflectiveLoader并调用它，我们的任务就完成了。</p>
</li>
<li><p>不想让DLL文件“落地”,我们可以在<strong>磁盘</strong>上存放一份DLL的<strong>加密后</strong>的版本，然后将其<strong>解密后</strong>储存在<strong>内存</strong>里。然后可以用VirtualAlloc和WriteProcessMemory将DLL文件写入目标进程的虚拟空间中。</p>
</li>
</ul>
<p>于是，我们的任务就转到了编写这个<code>ReflectiveLoader</code>上。由于<code>ReflectiveLoader</code>运行时所在的DLL还没有被装载，它在运行时会受到诸多的限制，例如无法正常使用全局变量等。而且，由于我们无法确认我们究竟将DLL文件写到目标进程哪一处虚拟空间上，所以我们编写的ReflectiveLoader必须是<strong>地址无关的</strong>。也就是说，ReflectiveLoader中的代码无论处于虚拟空间的哪个位置，它都必须能正确运行。这样的代码被我们称为“地址无关代码”(position-independent code, PIC)。</p>
<blockquote>
<p><strong>注入思路</strong></p>
<ol>
<li><p>将待注入DLL读入<code>自身内存</code>(利用解密磁盘上加密的文件、网络传输等方式避免文件落地)</p>
</li>
<li><p>利用VirtualAlloc和WriteProcessMemory在<code>目标进程</code>中写入待注入的DLL文件</p>
</li>
<li><p>利用CreateRemoteThread等函数<code>启动</code>位于目标进程中的<code>ReflectiveLoader</code></p>
</li>
</ol>
</blockquote>
<blockquote>
<p><strong>具体注入方式</strong></p>
<ol>
<li>使用 RWX 权限打开目标进程，并为 DLL 分配足够大的内存。</li>
<li>将 DLL 复制到分配的内存空间中。</li>
<li>计算 DLL 中用于执行反射加载的导出的内存偏移量。</li>
<li>使用反射性加载器函数的偏移地址作为入口，调用 CreateRemoteThread（或等效的未公开的 API 函数，如 RtlCreateUserThread）开始在远程进程中执行。</li>
<li><code>ReflectiveLoader</code>功能使用适当的 CPU 寄存器查找目标进程的进程环境块（PEB），并使用该寄存器在内存 kernel32.dll 和任何其他所需库中查找地址。</li>
<li>解析的 KERNEL32 出口目录中找到所需的 API 功能，如内存地址 <code>LoadLibraryA，GetProcAddress和VirtualAlloc</code>。</li>
<li>然后使用这些函数将 DLL（自身）正确加载到内存中，并调用其入口点 DllMain。</li>
</ol>
</blockquote>
<blockquote>
<p><code>ReflectiveLoader</code>具体操作</p>
<h5 id="1）-定位DLL文件在内存中的基址"><a href="#1）-定位DLL文件在内存中的基址" class="headerlink" title="1） 定位DLL文件在内存中的基址"></a>1） 定位DLL文件在内存中的基址</h5><p>ReflectiveLoader做的第一件事就是查找自身所在的DLL具体被写入了哪个位置。</p>
<p>ReflectiveLoader首先利用一个重定位技巧找到自身所在的大致位置：</p>
<p>ULONG_PTR caller( VOID ) { return(ULONG_PTR)_ReturnAddress(); }</p>
<p>其中函数_ReturnAddress()返回的是当前调用函数的返回地址，也就是caller()的下一条指令的地址。这个地址位于ReflectiveLoader的内部，而ReflectiveLoader位于被注入的DLL文件内部，因此这个地址离DLL文件的头部不远了。</p>
<p>借助上文找到的地址，我们逐字节的向上遍历，当查找到符合PE格式的文件头之后，就可以认为<strong>找到了DLL文件在内存中的地址</strong>了。</p>
<h6 id="2）获取所需的系统API。"><a href="#2）获取所需的系统API。" class="headerlink" title="2）获取所需的系统API。"></a>2）获取所需的系统API。</h6><p>ReflectiveLoader启动时，目标进程已在正常的运行状态中了，此时目标进程已经装载了一些核心的DLL文件。我们可以搜索这些DLL文件，查找需要的API函数，为后续操作提供方便。具体地，我们需要的函数是kernel32.dll中的LoadLibraryA(), GetProcAddress()， VirtualAlloc()以及ntdll.dll中的NtFlushInstructionCache()函数。</p>
<p>ReflectiveLoader借助PEB (ProcessEnvironment Block)来查找kernel32.dll和ntdll.dll在内存中的位置。</p>
<p>在PEB结构的0x0C偏移处，是一个指向PEB_LDR_DATA结构体的指针,其中的三个LIST_ENTRY是三个链表，按照不同的顺序规则将当前进程加载的所有模块链接起来。通过遍历其中的任意一个LIST_ENTRY，我们就可以获得所有模块的基地址,在获取了模块基地址之后，通过对PE文件的解析，找到DLL文件的导出表，再根据导出表就可以找到任一导出函数的地址了。</p>
<p><strong>在此，我们得到了函数LoadLibraryA(), GetProcAddress(), VirtualAlloc()以及NtFlushInstructionCache()。它们将在之后被用到。</strong></p>
<h5 id="3）-分配一片用来装载DLL的空间。"><a href="#3）-分配一片用来装载DLL的空间。" class="headerlink" title="3） 分配一片用来装载DLL的空间。"></a>3） 分配一片用来装载DLL的空间。</h5><p>虽然在ReflectiveLoader运行时，DLL文件已经在进程内存中了，但是要装载这个DLL，我们还需要更大的空间。借助在第2）步得到的函数VirtualAlloc()，我们可以分配一片更大的内存空间用于加载DLL。在PE头中的IMAGE_OPTIONAL_HEADER结构体中的SizeOfImage成员记载DLL被装载后的大小，我们按照这个大小分配内存即可。</p>
<h5 id="4）-复制PE文件头和各个节"><a href="#4）-复制PE文件头和各个节" class="headerlink" title="4） 复制PE文件头和各个节"></a>4） 复制PE文件头和各个节</h5><p>分配了用于装载的空间后，ReflectiveLoader将DLL文件的头部(也就是DOS文件头、DOS插桩代码和PE文件头)复制到新的空间的首部。再根据PE文件的节表将各个节复制到相应的位置中.</p>
<h5 id="5）-处理DLL的输入表"><a href="#5）-处理DLL的输入表" class="headerlink" title="5） 处理DLL的输入表"></a>5） 处理DLL的输入表</h5><p>被注入的DLL可能还依赖于其他的DLL，因此我们还需要装载这些被依赖的DLL，并修改本DLL的输入表，使这些被引入的函数能正常运行。</p>
<p>PE文件的输入表是一个元素为IID(IMAGE_IMPORT_DESCRIPTOR)的数组。每一个被依赖的DLL都对应着数组中的一个元素。</p>
<p>我们要做的就是根据IMAGE_IMPORT_DESCRIPTOR中的NAME成员找到DLL的名称，根据名称装载这些被依赖的DLL。 IMAGE_IMPORT_DESCRIPTOR中的<code>OriginalFirstThunk</code>指示了<strong>要从该DLL中引入哪些函数</strong>。有的函数是由名称导入的，此时IMAGE_THUNK_DATA会指向这个函数名；有的函数是由函数序号导入，此时分析IMAGE_THUNK_DATA我们会得到这个序号。无论是以什么方式导入，我们都要<strong>需要找到对应的函数，然后将其地址填入FirstThunk指向的IMAGE_THUNK_DATA数组中</strong>。装载这些被依赖的DLL就不需要我们手工操作了，我们直接利用步骤2）中获得的<code>LoadLibraryA()</code>来装载它们。对于那些通过函数名导入的函数来说，我们可以直接用<code>GetProcAddress()</code>来得到它们的地址；而对于通过序数导入的函数来说，则需要我们再次手工分析PE文件的导出表来找到它们的位置。</p>
<h5 id="6）-对DLL进行重定位"><a href="#6）-对DLL进行重定位" class="headerlink" title="6） 对DLL进行重定位"></a>6） 对DLL进行重定位</h5><p>被注入的DLL只有其ReflectiveLoader中的代码是故意写成地址无关、不需要重定位的，其他部分的代码则需要经过重定位才能正确运行。幸运的是DLL文件提供了我们进行重定位所需的所有信息，这是因为每一个DLL都具有加载不到预定基地址的可能性，所以每一个DLL都对自身的重定位做好了准备。不想看了,总之就是算偏移这那的</p>
<h5 id="7）-调用DLL入口点"><a href="#7）-调用DLL入口点" class="headerlink" title="7） 调用DLL入口点"></a>7） 调用DLL入口点</h5><p>至此，ReflectiveLoader的任务全部完成，最后它将控制权转交给DLL文件的入口点，这个入口点可以通过NT可选印象头中的AddressOfEntryPoint找到。一般地，它会完成C运行库的初始化，执行一系列安全检查并调用dllmain。</p>
</blockquote>
<h2 id="初始化-输入-合并"><a href="#初始化-输入-合并" class="headerlink" title="初始化,输入,合并"></a>初始化,输入,合并</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">start</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v1; <span class="comment">// rcx</span></span><br><span class="line"></span><br><span class="line">  num_0 = <span class="number">0</span>;</span><br><span class="line">  func_1();                                     <span class="comment">// 一些获取进程/线程ID操作,获取时间戳操作,可能是反调试?</span></span><br><span class="line">  <span class="keyword">return</span> func_2(v1, v0);                        <span class="comment">// 关键</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反编译func2,第一句就是ida的提示<code>// write access to const memory has been detected, the output may be wrong!</code>,内存拥有了写权限,想到可能会有SMC(其实是打开了目标进程,以便后续dll注入)</p>
<p>func2整了一堆<code>初始化</code>的东西,然后在sub_401800函数调用sub_401790,里面有个<code>虚函数表</code></p>
<p>虚函数1,即sub_4016E4<code>改控制台名字</code>,再调用40167A(<code>dll加载函数</code>)</p>
<p>40167A先sub_401560,把数据段的一串数据异或上0xE9(<code>数据解密</code>),<code>data段</code>中0040E1B0的一串数据异或后变成了<code>代码</code></p>
<p>然后sub_4015AD再寻找dll入口点,找到了就进入data段里的dll进行自加载</p>
<p>获取TEB,然后寻找<code>GetProcAddress</code>,<code>VirtualAlloc</code>,<code>GetModuleHandleA</code>这几个api…</p>
<p>一系列加载后执行<code>debug段</code>里的dllmain</p>
<p>sub_911320调用sub_9111EC，调用sub_15BC88进行输出和输入</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">write_and_read_sub_15BC88</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v2; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// er9</span></span><br><span class="line">  _BYTE *v4; <span class="comment">// r8</span></span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// dl</span></span><br><span class="line">  <span class="keyword">char</span> v6; <span class="comment">// cl</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v7; <span class="comment">// rax</span></span><br><span class="line">  __int128 v8; <span class="comment">// [rsp+20h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [rsp+30h] [rbp-40h]</span></span><br><span class="line">  __int128 v10[<span class="number">3</span>]; <span class="comment">// [rsp+38h] [rbp-38h] BYREF</span></span><br><span class="line">  __int16 v11; <span class="comment">// [rsp+68h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  off_176020();</span><br><span class="line">  <span class="keyword">if</span> ( byte_180BA0 )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>i64;</span><br><span class="line">  byte_180BA0 = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v10, <span class="number">0</span>, <span class="keyword">sizeof</span>(v10));</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  v8 = <span class="number">0</span>i64;</span><br><span class="line">  ((<span class="keyword">void</span> (__fastcall *)(<span class="keyword">char</span> *))write_consle_sub_1758AC)(aKey);</span><br><span class="line">  ((<span class="keyword">void</span> (__fastcall *)(__int128 *))read_consle_sub_175824)(v10);</span><br><span class="line">  v2 = <span class="number">-1</span>i64;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    ++v2;</span><br><span class="line">  <span class="keyword">while</span> ( *((_BYTE *)v10 + v2) );</span><br><span class="line">  <span class="keyword">if</span> ( v2 == <span class="number">32</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = <span class="number">0</span>;</span><br><span class="line">    v4 = (<span class="keyword">char</span> *)v10 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v5 = *(v4 - <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)(v5 - <span class="number">97</span>) &lt;= <span class="number">0x19</span>u )</span><br><span class="line">        v5 -= <span class="number">87</span>;</span><br><span class="line">      v6 = <span class="number">87</span>;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)(*v4 - <span class="number">97</span>) &gt; <span class="number">0x19</span>u )</span><br><span class="line">        v6 = <span class="number">48</span>;</span><br><span class="line">      v7 = (<span class="keyword">unsigned</span> __int64)(<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3 &gt;&gt; <span class="number">1</span>;</span><br><span class="line">      LOBYTE(v1) = *v4 + <span class="number">16</span> * v5 - v6;</span><br><span class="line">      v3 += <span class="number">2</span>;</span><br><span class="line">      v4 += <span class="number">2</span>;</span><br><span class="line">      *((_BYTE *)&amp;v8 + v7) = v1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v3 &lt; <span class="number">32</span> );</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)((__int64 (__fastcall *)(__int128 *, __int64, _BYTE *))unk_15C160)(&amp;v8, v1, v4) )</span><br><span class="line">    &#123;</span><br><span class="line">      ((<span class="keyword">void</span> (__fastcall *)(<span class="keyword">char</span> *))write_consle_sub_1758AC)(aYouWinYourFlag);</span><br><span class="line">      ((<span class="keyword">void</span> (__fastcall *)(__int128 *))write_consle_sub_1758AC)(v10);</span><br><span class="line">      ((<span class="keyword">void</span> (__fastcall *)(<span class="keyword">void</span> *))write_consle_sub_1758AC)(&amp;unk_17D634);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>i64;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ((<span class="keyword">void</span> (__fastcall *)(<span class="keyword">char</span> *))write_consle_sub_1758AC)(aWrong);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>i64;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输入的长度为32  //abcdef123456789abcdef123456789ab</p>
<p>偶-87+16*(奇-87)</p>
<p>就是在a-f和0-9之间的两个字符能合成16进制数</p>
<p>ab : 97-87=10,10*16=160(0xA0),0xA0+B=0xAB</p>
<blockquote>
<p>其实data段里也能f5，当时有笨比嗯逆汇编，原本是我</p>
<p>到call rax那里f7,然后一直f8到停顿,能找到输入和校验函数</p>
<p><img src="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220423231601691.png" alt="image-20220423231601691" style="zoom:80%;"> <img src="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220423234358532.png" alt="image-20220423234358532"> <img src="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220423234947263.png" alt="image-20220423234947263"> </p>
</blockquote>
<blockquote>
<p>↑写错了 ： </p>
<p>rax那是右移，所以是</p>
<p>前几个dl是（第一个字符-0x57）*16-0x57+第二个字符</p>
<p>后3个是0x30</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span>(<span class="params">flag</span>):</span></span><br><span class="line">    ret = [<span class="number">0</span>]*<span class="number">16</span></span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">32</span>, <span class="number">2</span>):</span><br><span class="line">        dl = flag[i]</span><br><span class="line">        eax = (flag[i]-<span class="number">0x61</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">        <span class="keyword">if</span> eax &lt;= <span class="number">0x19</span>:</span><br><span class="line">            dl = (dl-<span class="number">0x57</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">        j = i+<span class="number">1</span></span><br><span class="line">        ecx = <span class="number">0x57</span></span><br><span class="line">        r10 = ecx-<span class="number">0x27</span></span><br><span class="line">        al = (flag[j]-<span class="number">0x61</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">        <span class="keyword">if</span> (al &gt; <span class="number">0x19</span>):</span><br><span class="line">            ecx = r10</span><br><span class="line">        dl = (dl*<span class="number">16</span> - ecx+flag[j]) &amp; <span class="number">0xFF</span></span><br><span class="line">        ret[index] = <span class="built_in">hex</span>(dl)</span><br><span class="line">        index += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = [</span><br><span class="line">    <span class="number">97</span>, <span class="number">98</span>, <span class="number">99</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">99</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>, <span class="number">97</span>, <span class="number">98</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">ret = enc(flag)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ret:</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="校验-取ast语法树"><a href="#校验-取ast语法树" class="headerlink" title="校验,取ast语法树"></a>校验,取ast语法树</h2><p>当时做的时候感觉分析量太大了，可能是方法不对</p>
<p>确实不对,ida都分析不出来,怎么有笨逼想嗯分析啊哈哈哈哈，wp给出的方法是ast语法树</p>
<p><img src="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220711214225913.png" alt="image-20220711214225913"> </p>
<p>wp用ida python把ast树表示了出来,用到了idaapi和ida_funcs,参考文档如下</p>
<p><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-258831.htm">IDAPython常用API整理</a></p>
<p><a target="_blank" rel="noopener" href="https://hex-rays.com/products/ida/support/idapython_docs/">hex-rays官网</a></p>
<p>内存中有些东西</p>
<p><img src="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220711233049062.png" alt="image-20220711233049062"> </p>
<p>在校验函数的开头调用virtual alloc分配了一些空间 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall sub_9357A0(__int64 a1, int a2)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 v2; // rdi</span><br><span class="line">  __int64 v3; // rax</span><br><span class="line">  int v4; // ebx</span><br><span class="line">  __int64 result; // rax</span><br><span class="line"></span><br><span class="line">  v2 = a2;</span><br><span class="line">  *((_QWORD *)&amp;unk_940BB0 + 2 * dword_940BA4) = a1;</span><br><span class="line">  v3 = kernel32_VirtualAlloc_off_936000(0i64, 8 * a2, 4096i64, 64i64);</span><br><span class="line">  v4 = dword_940BA4;</span><br><span class="line">  *((_QWORD *)&amp;unk_940BB0 + 2 * dword_940BA4 + 1) = v3;</span><br><span class="line">  result = ((__int64 (__fastcall *)(__int64, _QWORD, __int64))unk_911E60)(v3, 0i64, 8 * v2);</span><br><span class="line">  dword_940BA4 = v4 + 1;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>整了些指针放内存里</p>
<p><img src="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220711233237039.png" alt="image-20220711233237039">    </p>
<p>loc_EFC1F2结合loc_EFC21D 找flag的内存空间</p>
<p>loc_EFC209把处理后的flag放在内存空间中</p>
<p><img src="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220711233909470.png" alt="image-20220711233909470"> </p>
<p><img src="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220711233815488.png" alt="image-20220711233815488"> </p>
<p>loc_91C226开始就是纯纯的折磨,疯狂virtual_alloc,每次分配10000大小的空间,放个函数,一些值,搞不懂在干嘛</p>
<p>update:就是在构造语法树,语法树由一个函数指针和若干个参数构成的，参数可以是另外一个函数的值也可以是变量也可以是常量，类型取决于type。</p>
<p>知道了语法树的结构就能通过idapython把语法树提取出来</p>
<p>wp给出的语法树结构:</p>
<p><img src="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/68747470733a2f2f6d642e627570746d6572616b2e636e2f75706c6f6164732f75706c6f61645f39313636616134323534353966336338656361356633656438666663333832652e706e67.png" alt="img"> </p>
<p>其中的函数(这么多真的能逆出来吗?)</p>
<p><img src="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/68747470733a2f2f6d642e627570746d6572616b2e636e2f75706c6f6164732f75706c6f61645f63633633356639343232393732376339366433663763366237633130396166662e706e67.png" alt="img"></p>
<p>执行到语法树构造完毕(virtual alloc没了),发现调用了func1,跟了一下,函数太多了,逆了几个不想逆了</p>
<p><img src="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220712145948349.png" alt="image-20220712145948349"> </p>
<p><img src="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220712150026148.png" alt="image-20220712150026148"> </p>
<p><img src="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220712150000102.png" alt="image-20220712150000102">  </p>
<p><img src="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220712152230593.png" alt="image-20220712152230593"> </p>
<blockquote>
<p>func1找到8个函数指针,依次执行</p>
<p>6a0000处的函数后跟着一个地址0x6B0000,其中有三个标识符+地址的组合,根据标识符访问地址获得变量(1表示要继续寻址,2表示到了末尾,3表示是变量),找到变量后把第三次找到的值填入变量的内存空间</p>
<p>700000处的函数与刚刚相同</p>
<p>func2-&gt;func2-&gt;func3-&gt;func2-&gt;func3-&gt;func2-&gt;func3</p>
</blockquote>
<p><img src="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/image-20220712154932288.png" alt="image-20220712154932288"> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">import idaapi</span><br><span class="line">import ida_funcs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def read_function(addr):</span><br><span class="line">    return idaapi.get_qword(addr)  # idaapi.get_qword : 从addr处获取一个qword数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def read_arg_num(addr):</span><br><span class="line">    return idaapi.get_qword(addr+8)  # 从addr+8处获取一个qword数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_parameter(addr, idx):</span><br><span class="line">    arr = idaapi.get_qword(addr+16)</span><br><span class="line">    return arr+idx*16</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_parameter_type(addr):</span><br><span class="line">    return idaapi.get_qword(addr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_parameter_data(addr):</span><br><span class="line">    return idaapi.get_qword(addr+8)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def dump_str(addr):</span><br><span class="line">    str_len = 0</span><br><span class="line">    r = b&#x27;&#x27;</span><br><span class="line">    while True:</span><br><span class="line">        c = idaapi.get_bytes(addr+str_len, 1)</span><br><span class="line">        if c[0] == 0:</span><br><span class="line">            break</span><br><span class="line">        str_len += 1</span><br><span class="line">        r += int.to_bytes(c[0], 1, byteorder=&#x27;little&#x27;)</span><br><span class="line">    return r.decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def dump_ast(node_addr):</span><br><span class="line">    ast = &quot;&quot;</span><br><span class="line">    tmp = ida_funcs.get_func_name(read_function(node_addr))</span><br><span class="line">    if tmp is not None:</span><br><span class="line">        ast = tmp+&#x27;(&#x27;</span><br><span class="line">    num = read_arg_num(node_addr)</span><br><span class="line">    for i in range(num):</span><br><span class="line">        son = get_parameter(node_addr, i)</span><br><span class="line">        type = get_parameter_type(son)</span><br><span class="line">        if type == 1:</span><br><span class="line">            tmp = dump_ast(get_parameter_data(son))</span><br><span class="line">            if tmp is not None:</span><br><span class="line">                ast += tmp</span><br><span class="line">        elif type == 2:</span><br><span class="line">            tmp = str(get_parameter_data(son))</span><br><span class="line">            if tmp is not None:</span><br><span class="line">                ast += tmp</span><br><span class="line">        elif type == 3:</span><br><span class="line">            tmp = dump_str(get_parameter_data(son))</span><br><span class="line">            if tmp is not None:</span><br><span class="line">                ast += &#x27;\&quot;&#x27; + tmp + &#x27;\&quot;&#x27;</span><br><span class="line">        else:</span><br><span class="line">            raise Exception(&quot;Unknown type&quot;)</span><br><span class="line">        if i != num-1:</span><br><span class="line">            ast += &#x27;,&#x27;</span><br><span class="line">    ast += &#x27;)&#x27;</span><br><span class="line">    return ast</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(dump_ast(0x680000)) #0x680000是语法树的起点,即第一个virtual alloc出来的地址</span><br></pre></td></tr></table></figure>

<p>wp给出的ast树:</p>
<p><img src="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-%E5%8F%8D%E5%B0%84%E5%9E%8Bdll/68747470733a2f2f6d642e627570746d6572616b2e636e2f75706c6f6164732f75706c6f61645f30313662613566666230336636343732623564383163306635323664663264392e706e67.png" alt="img"> </p>
<p>加密函数:</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> i, j, a[<span class="number">4</span>], b[<span class="number">16</span>], flag[<span class="number">16</span>] = &#123;<span class="number">0xa3</span>, <span class="number">0xbc</span>, <span class="number">0xdb</span>, <span class="number">0xcb</span>, <span class="number">0x2d</span>, <span class="number">0xce</span>, <span class="number">0x48</span>, <span class="number">0xb4</span>, <span class="number">0x86</span>, <span class="number">0xf9</span>, <span class="number">0xd6</span>, <span class="number">0xce</span>, <span class="number">0xad</span>, <span class="number">0x13</span>, <span class="number">0x7b</span>, <span class="number">0xd1</span>&#125;;</span><br><span class="line">i = <span class="number">0</span>;</span><br><span class="line">j = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (i &lt; <span class="number">4</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (j &lt; <span class="number">4</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        a[i] = ((a[i] &lt;&lt; <span class="number">8</span>) | flag[<span class="number">4</span> * i + j]);</span><br><span class="line">        j = j + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    j = <span class="number">0</span>;</span><br><span class="line">    i = i + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (i &lt; <span class="number">4</span>)</span><br><span class="line">&#123;</span><br><span class="line">    a[i] = a[i] ^ ((a[i] &lt;&lt; <span class="number">3</span>) &amp; <span class="number">4294967295</span>) ^ i;</span><br><span class="line">    i = i + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (i &lt; <span class="number">4</span>)</span><br><span class="line">&#123;</span><br><span class="line">    b[<span class="number">4</span> * i] = a[i] &amp; <span class="number">255</span>;</span><br><span class="line">    b[<span class="number">4</span> * i + <span class="number">1</span>] = (a[i] &gt;&gt; <span class="number">8</span>) &amp; <span class="number">255</span>;</span><br><span class="line">    b[<span class="number">4</span> * i + <span class="number">2</span>] = (a[i] &gt;&gt; <span class="number">16</span>) &amp; <span class="number">255</span>;</span><br><span class="line">    b[<span class="number">4</span> * i + <span class="number">3</span>] = (a[i] &gt;&gt; <span class="number">24</span>) &amp; <span class="number">255</span>;</span><br><span class="line">    i = i + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>验证函数,全是加法和乘法,是个解方程,z3</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getVar</span>(<span class="params">a,b</span>):</span></span><br><span class="line">	<span class="keyword">return</span> a+<span class="string">&#x27;[&#x27;</span>+b+<span class="string">&#x27;]&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getNumber</span>(<span class="params">a</span>):</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">str</span>(a)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mul</span>(<span class="params">a,b</span>):</span></span><br><span class="line">	<span class="keyword">return</span> a+<span class="string">&#x27;*&#x27;</span>+b</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a,b</span>):</span></span><br><span class="line">	<span class="keyword">return</span> a+<span class="string">&#x27;+&#x27;</span>+b</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eq</span>(<span class="params">a,b</span>):</span></span><br><span class="line">	<span class="keyword">return</span> a+<span class="string">&#x27;==&#x27;</span>+b</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ands</span>(<span class="params">a,b</span>):</span></span><br><span class="line">	ll=[]</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">type</span>(a)==<span class="built_in">list</span>:</span><br><span class="line">		<span class="keyword">for</span> s <span class="keyword">in</span> a:</span><br><span class="line">			ll.append(s)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		ll.append(a)</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">type</span>(b)==<span class="built_in">list</span>:</span><br><span class="line">		<span class="keyword">for</span> s <span class="keyword">in</span> b:</span><br><span class="line">			ll.append(s)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		ll.append(b)</span><br><span class="line">	<span class="keyword">return</span> ll</span><br><span class="line">constraints=ands(eq(add(add(add(add(add(add(add(add(add(add(add(add(add(add(add(mul(getNumber(<span class="number">165</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">0</span>))),mul(getNumber(<span class="number">206</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">1</span>)))),mul(getNumber(<span class="number">184</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">2</span>)))),mul(getNumber(<span class="number">188</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">3</span>)))),mul(getNumber(<span class="number">153</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">4</span>)))),mul(getNumber(<span class="number">183</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">5</span>)))),mul(getNumber(<span class="number">233</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">6</span>)))),mul(getNumber(<span class="number">160</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">7</span>)))),mul(getNumber(<span class="number">193</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">8</span>)))),mul(getNumber(<span class="number">255</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">9</span>)))),mul(getNumber(<span class="number">20</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">10</span>)))),mul(getNumber(<span class="number">92</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">11</span>)))),mul(getNumber(<span class="number">34</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">12</span>)))),mul(getNumber(<span class="number">102</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">13</span>)))),mul(getNumber(<span class="number">133</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">14</span>)))),mul(getNumber(<span class="number">81</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">15</span>)))),getNumber(<span class="number">269764</span>)),ands(eq(add(add(add(add(add(add(add(add(add(add(add(add(add(add(add(mul(getNumber(<span class="number">160</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">0</span>))),mul(getNumber(<span class="number">12</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">1</span>)))),mul(getNumber(<span class="number">112</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">2</span>)))),mul(getNumber(<span class="number">62</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">3</span>)))),mul(getNumber(<span class="number">22</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">4</span>)))),mul(getNumber(<span class="number">52</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">5</span>)))),mul(getNumber(<span class="number">154</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">6</span>)))),mul(getNumber(<span class="number">28</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">7</span>)))),mul(getNumber(<span class="number">166</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">8</span>)))),mul(getNumber(<span class="number">71</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">9</span>)))),mul(getNumber(<span class="number">86</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">10</span>)))),mul(getNumber(<span class="number">70</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">11</span>)))),mul(getNumber(<span class="number">78</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">12</span>)))),mul(getNumber(<span class="number">28</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">13</span>)))),mul(getNumber(<span class="number">179</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">14</span>)))),mul(getNumber(<span class="number">221</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">15</span>)))),getNumber(<span class="number">212071</span>)),ands(eq(add(add(add(add(add(add(add(add(add(add(add(add(add(add(add(mul(getNumber(<span class="number">188</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">0</span>))),mul(getNumber(<span class="number">118</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">1</span>)))),mul(getNumber(<span class="number">244</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">2</span>)))),mul(getNumber(<span class="number">107</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">3</span>)))),mul(getNumber(<span class="number">100</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">4</span>)))),mul(getNumber(<span class="number">206</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">5</span>)))),mul(getNumber(<span class="number">64</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">6</span>)))),mul(getNumber(<span class="number">198</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">7</span>)))),mul(getNumber(<span class="number">207</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">8</span>)))),mul(getNumber(<span class="number">83</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">9</span>)))),mul(getNumber(<span class="number">155</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">10</span>)))),mul(getNumber(<span class="number">56</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">11</span>)))),mul(getNumber(<span class="number">54</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">12</span>)))),mul(getNumber(<span class="number">48</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">13</span>)))),mul(getNumber(<span class="number">21</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">14</span>)))),mul(getNumber(<span class="number">220</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">15</span>)))),getNumber(<span class="number">224889</span>)),ands(eq(add(add(add(add(add(add(add(add(add(add(add(add(add(add(add(mul(getNumber(<span class="number">79</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">0</span>))),mul(getNumber(<span class="number">13</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">1</span>)))),mul(getNumber(<span class="number">65</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">2</span>)))),mul(getNumber(<span class="number">75</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">3</span>)))),mul(getNumber(<span class="number">103</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">4</span>)))),mul(getNumber(<span class="number">216</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">5</span>)))),mul(getNumber(<span class="number">233</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">6</span>)))),mul(getNumber(<span class="number">120</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">7</span>)))),mul(getNumber(<span class="number">177</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">8</span>)))),mul(getNumber(<span class="number">197</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">9</span>)))),mul(getNumber(<span class="number">0</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">10</span>)))),mul(getNumber(<span class="number">217</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">11</span>)))),mul(getNumber(<span class="number">222</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">12</span>)))),mul(getNumber(<span class="number">147</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">13</span>)))),mul(getNumber(<span class="number">216</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">14</span>)))),mul(getNumber(<span class="number">200</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">15</span>)))),getNumber(<span class="number">292201</span>)),ands(eq(add(add(add(add(add(add(add(add(add(add(add(add(add(add(add(mul(getNumber(<span class="number">237</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">0</span>))),mul(getNumber(<span class="number">18</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">1</span>)))),mul(getNumber(<span class="number">150</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">2</span>)))),mul(getNumber(<span class="number">40</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">3</span>)))),mul(getNumber(<span class="number">69</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">4</span>)))),mul(getNumber(<span class="number">226</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">5</span>)))),mul(getNumber(<span class="number">226</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">6</span>)))),mul(getNumber(<span class="number">75</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">7</span>)))),mul(getNumber(<span class="number">1</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">8</span>)))),mul(getNumber(<span class="number">125</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">9</span>)))),mul(getNumber(<span class="number">227</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">10</span>)))),mul(getNumber(<span class="number">19</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">11</span>)))),mul(getNumber(<span class="number">139</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">12</span>)))),mul(getNumber(<span class="number">119</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">13</span>)))),mul(getNumber(<span class="number">106</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">14</span>)))),mul(getNumber(<span class="number">88</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">15</span>)))),getNumber(<span class="number">199862</span>)),ands(eq(add(add(add(add(add(add(add(add(add(add(add(add(add(add(add(mul(getNumber(<span class="number">108</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">0</span>))),mul(getNumber(<span class="number">5</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">1</span>)))),mul(getNumber(<span class="number">109</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">2</span>)))),mul(getNumber(<span class="number">138</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">3</span>)))),mul(getNumber(<span class="number">98</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">4</span>)))),mul(getNumber(<span class="number">189</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">5</span>)))),mul(getNumber(<span class="number">184</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">6</span>)))),mul(getNumber(<span class="number">152</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">7</span>)))),mul(getNumber(<span class="number">179</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">8</span>)))),mul(getNumber(<span class="number">156</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">9</span>)))),mul(getNumber(<span class="number">223</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">10</span>)))),mul(getNumber(<span class="number">16</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">11</span>)))),mul(getNumber(<span class="number">194</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">12</span>)))),mul(getNumber(<span class="number">77</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">13</span>)))),mul(getNumber(<span class="number">119</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">14</span>)))),mul(getNumber(<span class="number">135</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">15</span>)))),getNumber(<span class="number">237891</span>)),ands(eq(add(add(add(add(add(add(add(add(add(add(add(add(add(add(add(mul(getNumber(<span class="number">224</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">0</span>))),mul(getNumber(<span class="number">168</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">1</span>)))),mul(getNumber(<span class="number">133</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">2</span>)))),mul(getNumber(<span class="number">59</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">3</span>)))),mul(getNumber(<span class="number">100</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">4</span>)))),mul(getNumber(<span class="number">122</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">5</span>)))),mul(getNumber(<span class="number">55</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">6</span>)))),mul(getNumber(<span class="number">247</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">7</span>)))),mul(getNumber(<span class="number">254</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">8</span>)))),mul(getNumber(<span class="number">132</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">9</span>)))),mul(getNumber(<span class="number">210</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">10</span>)))),mul(getNumber(<span class="number">55</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">11</span>)))),mul(getNumber(<span class="number">72</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">12</span>)))),mul(getNumber(<span class="number">198</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">13</span>)))),mul(getNumber(<span class="number">236</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">14</span>)))),mul(getNumber(<span class="number">141</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">15</span>)))),getNumber(<span class="number">268255</span>)),ands(eq(add(add(add(add(add(add(add(add(add(add(add(add(add(add(add(mul(getNumber(<span class="number">158</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">0</span>))),mul(getNumber(<span class="number">253</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">1</span>)))),mul(getNumber(<span class="number">219</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">2</span>)))),mul(getNumber(<span class="number">67</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">3</span>)))),mul(getNumber(<span class="number">48</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">4</span>)))),mul(getNumber(<span class="number">106</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">5</span>)))),mul(getNumber(<span class="number">109</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">6</span>)))),mul(getNumber(<span class="number">66</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">7</span>)))),mul(getNumber(<span class="number">85</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">8</span>)))),mul(getNumber(<span class="number">213</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">9</span>)))),mul(getNumber(<span class="number">218</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">10</span>)))),mul(getNumber(<span class="number">50</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">11</span>)))),mul(getNumber(<span class="number">35</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">12</span>)))),mul(getNumber(<span class="number">210</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">13</span>)))),mul(getNumber(<span class="number">246</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">14</span>)))),mul(getNumber(<span class="number">227</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">15</span>)))),getNumber(<span class="number">257474</span>)),ands(eq(add(add(add(add(add(add(add(add(add(add(add(add(add(add(add(mul(getNumber(<span class="number">60</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">0</span>))),mul(getNumber(<span class="number">67</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">1</span>)))),mul(getNumber(<span class="number">171</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">2</span>)))),mul(getNumber(<span class="number">236</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">3</span>)))),mul(getNumber(<span class="number">234</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">4</span>)))),mul(getNumber(<span class="number">30</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">5</span>)))),mul(getNumber(<span class="number">167</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">6</span>)))),mul(getNumber(<span class="number">146</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">7</span>)))),mul(getNumber(<span class="number">111</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">8</span>)))),mul(getNumber(<span class="number">112</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">9</span>)))),mul(getNumber(<span class="number">82</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">10</span>)))),mul(getNumber(<span class="number">235</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">11</span>)))),mul(getNumber(<span class="number">150</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">12</span>)))),mul(getNumber(<span class="number">162</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">13</span>)))),mul(getNumber(<span class="number">3</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">14</span>)))),mul(getNumber(<span class="number">67</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">15</span>)))),getNumber(<span class="number">247429</span>)),ands(eq(add(add(add(add(add(add(add(add(add(add(add(add(add(add(add(mul(getNumber(<span class="number">142</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">0</span>))),mul(getNumber(<span class="number">251</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">1</span>)))),mul(getNumber(<span class="number">115</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">2</span>)))),mul(getNumber(<span class="number">190</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">3</span>)))),mul(getNumber(<span class="number">248</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">4</span>)))),mul(getNumber(<span class="number">103</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">5</span>)))),mul(getNumber(<span class="number">114</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">6</span>)))),mul(getNumber(<span class="number">63</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">7</span>)))),mul(getNumber(<span class="number">63</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">8</span>)))),mul(getNumber(<span class="number">119</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">9</span>)))),mul(getNumber(<span class="number">216</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">10</span>)))),mul(getNumber(<span class="number">137</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">11</span>)))),mul(getNumber(<span class="number">40</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">12</span>)))),mul(getNumber(<span class="number">168</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">13</span>)))),mul(getNumber(<span class="number">191</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">14</span>)))),mul(getNumber(<span class="number">164</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">15</span>)))),getNumber(<span class="number">249780</span>)),ands(eq(add(add(add(add(add(add(add(add(add(add(add(add(add(add(add(mul(getNumber(<span class="number">170</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">0</span>))),mul(getNumber(<span class="number">232</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">1</span>)))),mul(getNumber(<span class="number">239</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">2</span>)))),mul(getNumber(<span class="number">131</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">3</span>)))),mul(getNumber(<span class="number">255</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">4</span>)))),mul(getNumber(<span class="number">86</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">5</span>)))),mul(getNumber(<span class="number">154</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">6</span>)))),mul(getNumber(<span class="number">227</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">7</span>)))),mul(getNumber(<span class="number">251</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">8</span>)))),mul(getNumber(<span class="number">74</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">9</span>)))),mul(getNumber(<span class="number">74</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">10</span>)))),mul(getNumber(<span class="number">118</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">11</span>)))),mul(getNumber(<span class="number">157</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">12</span>)))),mul(getNumber(<span class="number">149</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">13</span>)))),mul(getNumber(<span class="number">23</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">14</span>)))),mul(getNumber(<span class="number">65</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">15</span>)))),getNumber(<span class="number">257080</span>)),ands(eq(add(add(add(add(add(add(add(add(add(add(add(add(add(add(add(mul(getNumber(<span class="number">228</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">0</span>))),mul(getNumber(<span class="number">10</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">1</span>)))),mul(getNumber(<span class="number">29</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">2</span>)))),mul(getNumber(<span class="number">66</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">3</span>)))),mul(getNumber(<span class="number">227</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">4</span>)))),mul(getNumber(<span class="number">61</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">5</span>)))),mul(getNumber(<span class="number">45</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">6</span>)))),mul(getNumber(<span class="number">87</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">7</span>)))),mul(getNumber(<span class="number">24</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">8</span>)))),mul(getNumber(<span class="number">138</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">9</span>)))),mul(getNumber(<span class="number">195</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">10</span>)))),mul(getNumber(<span class="number">91</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">11</span>)))),mul(getNumber(<span class="number">250</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">12</span>)))),mul(getNumber(<span class="number">89</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">13</span>)))),mul(getNumber(<span class="number">56</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">14</span>)))),mul(getNumber(<span class="number">146</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">15</span>)))),getNumber(<span class="number">186720</span>)),ands(eq(add(add(add(add(add(add(add(add(add(add(add(add(add(add(add(mul(getNumber(<span class="number">209</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">0</span>))),mul(getNumber(<span class="number">161</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">1</span>)))),mul(getNumber(<span class="number">57</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">2</span>)))),mul(getNumber(<span class="number">71</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">3</span>)))),mul(getNumber(<span class="number">202</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">4</span>)))),mul(getNumber(<span class="number">171</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">5</span>)))),mul(getNumber(<span class="number">120</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">6</span>)))),mul(getNumber(<span class="number">179</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">7</span>)))),mul(getNumber(<span class="number">75</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">8</span>)))),mul(getNumber(<span class="number">25</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">9</span>)))),mul(getNumber(<span class="number">161</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">10</span>)))),mul(getNumber(<span class="number">33</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">11</span>)))),mul(getNumber(<span class="number">132</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">12</span>)))),mul(getNumber(<span class="number">38</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">13</span>)))),mul(getNumber(<span class="number">144</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">14</span>)))),mul(getNumber(<span class="number">80</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">15</span>)))),getNumber(<span class="number">175856</span>)),ands(eq(add(add(add(add(add(add(add(add(add(add(add(add(add(add(add(mul(getNumber(<span class="number">71</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">0</span>))),mul(getNumber(<span class="number">47</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">1</span>)))),mul(getNumber(<span class="number">193</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">2</span>)))),mul(getNumber(<span class="number">25</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">3</span>)))),mul(getNumber(<span class="number">25</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">4</span>)))),mul(getNumber(<span class="number">115</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">5</span>)))),mul(getNumber(<span class="number">8</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">6</span>)))),mul(getNumber(<span class="number">81</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">7</span>)))),mul(getNumber(<span class="number">137</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">8</span>)))),mul(getNumber(<span class="number">23</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">9</span>)))),mul(getNumber(<span class="number">130</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">10</span>)))),mul(getNumber(<span class="number">241</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">11</span>)))),mul(getNumber(<span class="number">192</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">12</span>)))),mul(getNumber(<span class="number">109</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">13</span>)))),mul(getNumber(<span class="number">203</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">14</span>)))),mul(getNumber(<span class="number">116</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">15</span>)))),getNumber(<span class="number">205239</span>)),ands(eq(add(add(add(add(add(add(add(add(add(add(add(add(add(add(add(mul(getNumber(<span class="number">90</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">0</span>))),mul(getNumber(<span class="number">117</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">1</span>)))),mul(getNumber(<span class="number">113</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">2</span>)))),mul(getNumber(<span class="number">129</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">3</span>)))),mul(getNumber(<span class="number">116</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">4</span>)))),mul(getNumber(<span class="number">164</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">5</span>)))),mul(getNumber(<span class="number">169</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">6</span>)))),mul(getNumber(<span class="number">202</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">7</span>)))),mul(getNumber(<span class="number">6</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">8</span>)))),mul(getNumber(<span class="number">229</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">9</span>)))),mul(getNumber(<span class="number">65</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">10</span>)))),mul(getNumber(<span class="number">52</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">11</span>)))),mul(getNumber(<span class="number">116</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">12</span>)))),mul(getNumber(<span class="number">222</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">13</span>)))),mul(getNumber(<span class="number">214</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">14</span>)))),mul(getNumber(<span class="number">56</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">15</span>)))),getNumber(<span class="number">221466</span>)),eq(add(add(add(add(add(add(add(add(add(add(add(add(add(add(add(mul(getNumber(<span class="number">95</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">0</span>))),mul(getNumber(<span class="number">116</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">1</span>)))),mul(getNumber(<span class="number">71</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">2</span>)))),mul(getNumber(<span class="number">137</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">3</span>)))),mul(getNumber(<span class="number">193</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">4</span>)))),mul(getNumber(<span class="number">145</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">5</span>)))),mul(getNumber(<span class="number">105</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">6</span>)))),mul(getNumber(<span class="number">247</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">7</span>)))),mul(getNumber(<span class="number">57</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">8</span>)))),mul(getNumber(<span class="number">36</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">9</span>)))),mul(getNumber(<span class="number">253</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">10</span>)))),mul(getNumber(<span class="number">147</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">11</span>)))),mul(getNumber(<span class="number">163</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">12</span>)))),mul(getNumber(<span class="number">106</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">13</span>)))),mul(getNumber(<span class="number">223</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">14</span>)))),mul(getNumber(<span class="number">20</span>),getVar(<span class="string">&quot;b&quot;</span>,getNumber(<span class="number">15</span>)))),getNumber(<span class="number">209726</span>)))))))))))))))))</span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">b=[Int(<span class="string">&#x27;b[&#x27;</span>+<span class="built_in">str</span>(x)+<span class="string">&#x27;]&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">s=Solver()</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> constraints:</span><br><span class="line">	s.add(<span class="built_in">eval</span>(c))</span><br><span class="line">s.check()</span><br><span class="line"><span class="built_in">print</span>(s.model())</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[b[11] = 177,</span><br><span class="line"> b[5] = 13,  </span><br><span class="line"> b[15] = 197,</span><br><span class="line"> b[12] = 90, </span><br><span class="line"> b[7] = 67,  </span><br><span class="line"> b[10] = 55, </span><br><span class="line"> b[1] = 5,   </span><br><span class="line"> b[9] = 96,</span><br><span class="line"> b[2] = 90,</span><br><span class="line"> b[4] = 21,</span><br><span class="line"> b[0] = 147,</span><br><span class="line"> b[13] = 165,</span><br><span class="line"> b[14] = 136,</span><br><span class="line"> b[6] = 188,</span><br><span class="line"> b[3] = 190,</span><br><span class="line"> b[8] = 188]</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://blog.leanote.com/post/xp0int/2022-MRCTF-%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE-Writeup-By-Xp0int">2022 MRCTF 部分题目 Writeup By Xp0int (leanote.com)</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getAnsOfPowerOfTwo</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    ans = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(a, b):</span><br><span class="line">        ans += <span class="built_in">pow</span>(<span class="number">2</span>, i)</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getBit</span>(<span class="params">n, i</span>):</span></span><br><span class="line">    t = <span class="built_in">pow</span>(<span class="number">2</span>, i)</span><br><span class="line">    <span class="keyword">return</span> (t &amp; n) &gt;&gt; i</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leftShiftXor</span>(<span class="params">n, m</span>):</span></span><br><span class="line">    r = n &amp; getAnsOfPowerOfTwo(<span class="number">0</span>, m)</span><br><span class="line">    l = n &amp; getAnsOfPowerOfTwo(m, <span class="number">32</span>)</span><br><span class="line">    t = r</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m, <span class="number">32</span>):</span><br><span class="line">        t_i = getBit(t, i - m) ^ getBit(n, i)</span><br><span class="line">        t += t_i &lt;&lt; i</span><br><span class="line">    <span class="keyword">return</span> t &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b = [Int(<span class="string">&#x27;b[%d]&#x27;</span> % i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">s = Solver()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    s.add(b[i] &gt;= <span class="number">0</span>)</span><br><span class="line">    s.add(b[i] &lt;= <span class="number">255</span>)</span><br><span class="line">s.add(<span class="number">0xa5</span>*b[<span class="number">0</span>] + <span class="number">0xce</span>*b[<span class="number">1</span>] + <span class="number">0xb8</span>*b[<span class="number">2</span>] + <span class="number">0xbc</span>*b[<span class="number">3</span>] + <span class="number">0x99</span>*b[<span class="number">4</span>] + <span class="number">0xb7</span>*b[<span class="number">5</span>] + <span class="number">0xe9</span>*b[<span class="number">6</span>] + <span class="number">0xa0</span>*b[<span class="number">7</span>] + <span class="number">0xc1</span> *</span><br><span class="line">      b[<span class="number">8</span>] + <span class="number">0xff</span>*b[<span class="number">9</span>] + <span class="number">0x14</span>*b[<span class="number">10</span>] + <span class="number">0x5c</span>*b[<span class="number">11</span>] + <span class="number">0x22</span>*b[<span class="number">12</span>] + <span class="number">0x66</span>*b[<span class="number">13</span>] + <span class="number">0x85</span>*b[<span class="number">14</span>] + <span class="number">0x51</span>*b[<span class="number">15</span>] == <span class="number">0x41DC4</span>)</span><br><span class="line">s.add(<span class="number">0xa0</span>*b[<span class="number">0</span>] + <span class="number">0xc</span>*b[<span class="number">1</span>] + <span class="number">0x70</span>*b[<span class="number">2</span>] + <span class="number">0x3e</span>*b[<span class="number">3</span>] + <span class="number">0x16</span>*b[<span class="number">4</span>] + <span class="number">0x34</span>*b[<span class="number">5</span>] + <span class="number">0x9a</span>*b[<span class="number">6</span>] + <span class="number">0x1c</span>*b[<span class="number">7</span>] + <span class="number">0xa6</span> *</span><br><span class="line">      b[<span class="number">8</span>] + <span class="number">0x47</span>*b[<span class="number">9</span>] + <span class="number">0x56</span>*b[<span class="number">10</span>] + <span class="number">0x46</span>*b[<span class="number">11</span>] + <span class="number">0x4e</span>*b[<span class="number">12</span>] + <span class="number">0x1c</span>*b[<span class="number">13</span>] + <span class="number">0xb3</span>*b[<span class="number">14</span>] + <span class="number">0xdd</span>*b[<span class="number">15</span>] == <span class="number">0x33C67</span>)</span><br><span class="line">s.add(<span class="number">0xbc</span>*b[<span class="number">0</span>] + <span class="number">0x76</span>*b[<span class="number">1</span>] + <span class="number">0xf4</span>*b[<span class="number">2</span>] + <span class="number">0x6b</span>*b[<span class="number">3</span>] + <span class="number">0x64</span>*b[<span class="number">4</span>] + <span class="number">0xce</span>*b[<span class="number">5</span>] + <span class="number">0x40</span>*b[<span class="number">6</span>] + <span class="number">0xc6</span>*b[<span class="number">7</span>] + <span class="number">0xcf</span> *</span><br><span class="line">      b[<span class="number">8</span>] + <span class="number">0x53</span>*b[<span class="number">9</span>] + <span class="number">0x9b</span>*b[<span class="number">10</span>] + <span class="number">0x38</span>*b[<span class="number">11</span>] + <span class="number">0x36</span>*b[<span class="number">12</span>] + <span class="number">0x30</span>*b[<span class="number">13</span>] + <span class="number">0x15</span>*b[<span class="number">14</span>] + <span class="number">0xdc</span>*b[<span class="number">15</span>] == <span class="number">0x36e79</span>)</span><br><span class="line">s.add(<span class="number">0x4f</span>*b[<span class="number">0</span>] + <span class="number">0xd</span>*b[<span class="number">1</span>] + <span class="number">0x41</span>*b[<span class="number">2</span>] + <span class="number">0x4b</span>*b[<span class="number">3</span>] + <span class="number">0x67</span>*b[<span class="number">4</span>] + <span class="number">0xd8</span>*b[<span class="number">5</span>] + <span class="number">0xe9</span>*b[<span class="number">6</span>] + <span class="number">0x78</span>*b[<span class="number">7</span>] + <span class="number">0xb1</span> *</span><br><span class="line">      b[<span class="number">8</span>] + <span class="number">0xc5</span>*b[<span class="number">9</span>] + <span class="number">0x0</span>*b[<span class="number">10</span>] + <span class="number">0xd9</span>*b[<span class="number">11</span>] + <span class="number">0xde</span>*b[<span class="number">12</span>] + <span class="number">0x93</span>*b[<span class="number">13</span>] + <span class="number">0xd8</span>*b[<span class="number">14</span>] + <span class="number">0xc8</span>*b[<span class="number">15</span>] == <span class="number">0x47569</span>)</span><br><span class="line">s.add(<span class="number">0xed</span>*b[<span class="number">0</span>] + <span class="number">0x12</span>*b[<span class="number">1</span>] + <span class="number">0x96</span>*b[<span class="number">2</span>] + <span class="number">0x28</span>*b[<span class="number">3</span>] + <span class="number">0x45</span>*b[<span class="number">4</span>] + <span class="number">0xe2</span>*b[<span class="number">5</span>] + <span class="number">0xe2</span>*b[<span class="number">6</span>] + <span class="number">0x4b</span>*b[<span class="number">7</span>] + <span class="number">0x1</span> *</span><br><span class="line">      b[<span class="number">8</span>] + <span class="number">0x7d</span>*b[<span class="number">9</span>] + <span class="number">0xe3</span>*b[<span class="number">10</span>] + <span class="number">0x13</span>*b[<span class="number">11</span>] + <span class="number">0x8b</span>*b[<span class="number">12</span>] + <span class="number">0x77</span>*b[<span class="number">13</span>] + <span class="number">0x6a</span>*b[<span class="number">14</span>] + <span class="number">0x58</span>*b[<span class="number">15</span>] == <span class="number">0x30cb6</span>)</span><br><span class="line">s.add(<span class="number">0x6c</span>*b[<span class="number">0</span>] + <span class="number">0x5</span>*b[<span class="number">1</span>] + <span class="number">0x6d</span>*b[<span class="number">2</span>] + <span class="number">0x8a</span>*b[<span class="number">3</span>] + <span class="number">0x62</span>*b[<span class="number">4</span>] + <span class="number">0xbd</span>*b[<span class="number">5</span>] + <span class="number">0xb8</span>*b[<span class="number">6</span>] + <span class="number">0x98</span>*b[<span class="number">7</span>] + <span class="number">0xb3</span> *</span><br><span class="line">      b[<span class="number">8</span>] + <span class="number">0x9c</span>*b[<span class="number">9</span>] + <span class="number">0xdf</span>*b[<span class="number">10</span>] + <span class="number">0x10</span>*b[<span class="number">11</span>] + <span class="number">0xc2</span>*b[<span class="number">12</span>] + <span class="number">0x4d</span>*b[<span class="number">13</span>] + <span class="number">0x77</span>*b[<span class="number">14</span>] + <span class="number">0x87</span>*b[<span class="number">15</span>] == <span class="number">0x3a143</span>)</span><br><span class="line">s.add(<span class="number">0xe0</span>*b[<span class="number">0</span>] + <span class="number">0xa8</span>*b[<span class="number">1</span>] + <span class="number">0x85</span>*b[<span class="number">2</span>] + <span class="number">0x3b</span>*b[<span class="number">3</span>] + <span class="number">0x64</span>*b[<span class="number">4</span>] + <span class="number">0x7a</span>*b[<span class="number">5</span>] + <span class="number">0x37</span>*b[<span class="number">6</span>] + <span class="number">0xf7</span>*b[<span class="number">7</span>] + <span class="number">0xfe</span> *</span><br><span class="line">      b[<span class="number">8</span>] + <span class="number">0x84</span>*b[<span class="number">9</span>] + <span class="number">0xd2</span>*b[<span class="number">10</span>] + <span class="number">0x37</span>*b[<span class="number">11</span>] + <span class="number">0x48</span>*b[<span class="number">12</span>] + <span class="number">0xc6</span>*b[<span class="number">13</span>] + <span class="number">0xec</span>*b[<span class="number">14</span>] + <span class="number">0x8d</span>*b[<span class="number">15</span>] == <span class="number">0x417df</span>)</span><br><span class="line">s.add(<span class="number">0x9e</span>*b[<span class="number">0</span>] + <span class="number">0xfd</span>*b[<span class="number">1</span>] + <span class="number">0xdb</span>*b[<span class="number">2</span>] + <span class="number">0x43</span>*b[<span class="number">3</span>] + <span class="number">0x30</span>*b[<span class="number">4</span>] + <span class="number">0x6a</span>*b[<span class="number">5</span>] + <span class="number">0x6d</span>*b[<span class="number">6</span>] + <span class="number">0x42</span>*b[<span class="number">7</span>] + <span class="number">0x55</span> *</span><br><span class="line">      b[<span class="number">8</span>] + <span class="number">0xd5</span>*b[<span class="number">9</span>] + <span class="number">0xda</span>*b[<span class="number">10</span>] + <span class="number">0x32</span>*b[<span class="number">11</span>] + <span class="number">0x23</span>*b[<span class="number">12</span>] + <span class="number">0xd2</span>*b[<span class="number">13</span>] + <span class="number">0xf6</span>*b[<span class="number">14</span>] + <span class="number">0xe3</span>*b[<span class="number">15</span>] == <span class="number">0x3edc2</span>)</span><br><span class="line">s.add(<span class="number">0x3c</span>*b[<span class="number">0</span>] + <span class="number">0x43</span>*b[<span class="number">1</span>] + <span class="number">0xab</span>*b[<span class="number">2</span>] + <span class="number">0xec</span>*b[<span class="number">3</span>] + <span class="number">0xea</span>*b[<span class="number">4</span>] + <span class="number">0x1e</span>*b[<span class="number">5</span>] + <span class="number">0xa7</span>*b[<span class="number">6</span>] + <span class="number">0x92</span>*b[<span class="number">7</span>] + <span class="number">0x6f</span> *</span><br><span class="line">      b[<span class="number">8</span>] + <span class="number">0x70</span>*b[<span class="number">9</span>] + <span class="number">0x52</span>*b[<span class="number">10</span>] + <span class="number">0xeb</span>*b[<span class="number">11</span>] + <span class="number">0x96</span>*b[<span class="number">12</span>] + <span class="number">0xa2</span>*b[<span class="number">13</span>] + <span class="number">0x3</span>*b[<span class="number">14</span>] + <span class="number">0x43</span>*b[<span class="number">15</span>] == <span class="number">0x3c685</span>)</span><br><span class="line">s.add(<span class="number">0x8e</span>*b[<span class="number">0</span>] + <span class="number">0xfb</span>*b[<span class="number">1</span>] + <span class="number">0x73</span>*b[<span class="number">2</span>] + <span class="number">0xbe</span>*b[<span class="number">3</span>] + <span class="number">0xf8</span>*b[<span class="number">4</span>] + <span class="number">0x67</span>*b[<span class="number">5</span>] + <span class="number">0x72</span>*b[<span class="number">6</span>] + <span class="number">0x3f</span>*b[<span class="number">7</span>] + <span class="number">0x3f</span> *</span><br><span class="line">      b[<span class="number">8</span>] + <span class="number">0x77</span>*b[<span class="number">9</span>] + <span class="number">0xd8</span>*b[<span class="number">10</span>] + <span class="number">0x89</span>*b[<span class="number">11</span>] + <span class="number">0x28</span>*b[<span class="number">12</span>] + <span class="number">0xa8</span>*b[<span class="number">13</span>] + <span class="number">0xbf</span>*b[<span class="number">14</span>] + <span class="number">0xa4</span>*b[<span class="number">15</span>] == <span class="number">0x3CFB4</span>)</span><br><span class="line">s.add(<span class="number">0xaa</span>*b[<span class="number">0</span>] + <span class="number">0xe8</span>*b[<span class="number">1</span>] + <span class="number">0xef</span>*b[<span class="number">2</span>] + <span class="number">0x83</span>*b[<span class="number">3</span>] + <span class="number">0xff</span>*b[<span class="number">4</span>] + <span class="number">0x56</span>*b[<span class="number">5</span>] + <span class="number">0x9a</span>*b[<span class="number">6</span>] + <span class="number">0xe3</span>*b[<span class="number">7</span>] + <span class="number">0xfb</span> *</span><br><span class="line">      b[<span class="number">8</span>] + <span class="number">0x4a</span>*b[<span class="number">9</span>] + <span class="number">0x4a</span>*b[<span class="number">10</span>] + <span class="number">0x76</span>*b[<span class="number">11</span>] + <span class="number">0x9d</span>*b[<span class="number">12</span>] + <span class="number">0x95</span>*b[<span class="number">13</span>] + <span class="number">0x17</span>*b[<span class="number">14</span>] + <span class="number">0x41</span>*b[<span class="number">15</span>] == <span class="number">0x3EC38</span>)</span><br><span class="line">s.add(<span class="number">0xe4</span>*b[<span class="number">0</span>] + <span class="number">0xa</span>*b[<span class="number">1</span>] + <span class="number">0x1d</span>*b[<span class="number">2</span>] + <span class="number">0x42</span>*b[<span class="number">3</span>] + <span class="number">0xe3</span>*b[<span class="number">4</span>] + <span class="number">0x3d</span>*b[<span class="number">5</span>] + <span class="number">0x2d</span>*b[<span class="number">6</span>] + <span class="number">0x57</span>*b[<span class="number">7</span>] + <span class="number">0x18</span> *</span><br><span class="line">      b[<span class="number">8</span>] + <span class="number">0x8a</span>*b[<span class="number">9</span>] + <span class="number">0xc3</span>*b[<span class="number">10</span>] + <span class="number">0x5b</span>*b[<span class="number">11</span>] + <span class="number">0xfa</span>*b[<span class="number">12</span>] + <span class="number">0x59</span>*b[<span class="number">13</span>] + <span class="number">0x38</span>*b[<span class="number">14</span>] + <span class="number">0x92</span>*b[<span class="number">15</span>] == <span class="number">0x2D960</span>)</span><br><span class="line">s.add(<span class="number">0xd1</span>*b[<span class="number">0</span>] + <span class="number">0xa1</span>*b[<span class="number">1</span>] + <span class="number">0x39</span>*b[<span class="number">2</span>] + <span class="number">0x47</span>*b[<span class="number">3</span>] + <span class="number">0xca</span>*b[<span class="number">4</span>] + <span class="number">0xab</span>*b[<span class="number">5</span>] + <span class="number">0x78</span>*b[<span class="number">6</span>] + <span class="number">0xb3</span>*b[<span class="number">7</span>] + <span class="number">0x4b</span> *</span><br><span class="line">      b[<span class="number">8</span>] + <span class="number">0x19</span>*b[<span class="number">9</span>] + <span class="number">0xa1</span>*b[<span class="number">10</span>] + <span class="number">0x21</span>*b[<span class="number">11</span>] + <span class="number">0x84</span>*b[<span class="number">12</span>] + <span class="number">0x26</span>*b[<span class="number">13</span>] + <span class="number">0x90</span>*b[<span class="number">14</span>] + <span class="number">0x50</span>*b[<span class="number">15</span>] == <span class="number">0x2AEF0</span>)</span><br><span class="line">s.add(<span class="number">0x47</span>*b[<span class="number">0</span>] + <span class="number">0x2f</span>*b[<span class="number">1</span>] + <span class="number">0xc1</span>*b[<span class="number">2</span>] + <span class="number">0x19</span>*b[<span class="number">3</span>] + <span class="number">0x19</span>*b[<span class="number">4</span>] + <span class="number">0x73</span>*b[<span class="number">5</span>] + <span class="number">0x8</span>*b[<span class="number">6</span>] + <span class="number">0x51</span>*b[<span class="number">7</span>] + <span class="number">0x89</span> *</span><br><span class="line">      b[<span class="number">8</span>] + <span class="number">0x17</span>*b[<span class="number">9</span>] + <span class="number">0x82</span>*b[<span class="number">10</span>] + <span class="number">0xf1</span>*b[<span class="number">11</span>] + <span class="number">0xc0</span>*b[<span class="number">12</span>] + <span class="number">0x6d</span>*b[<span class="number">13</span>] + <span class="number">0xcb</span>*b[<span class="number">14</span>] + <span class="number">0x74</span>*b[<span class="number">15</span>] == <span class="number">0x321B7</span>)</span><br><span class="line">s.add(<span class="number">0x5a</span>*b[<span class="number">0</span>] + <span class="number">0x75</span>*b[<span class="number">1</span>] + <span class="number">0x71</span>*b[<span class="number">2</span>] + <span class="number">0x81</span>*b[<span class="number">3</span>] + <span class="number">0x74</span>*b[<span class="number">4</span>] + <span class="number">0xa4</span>*b[<span class="number">5</span>] + <span class="number">0xa9</span>*b[<span class="number">6</span>] + <span class="number">0xca</span>*b[<span class="number">7</span>] + <span class="number">0x6</span> *</span><br><span class="line">      b[<span class="number">8</span>] + <span class="number">0xe5</span>*b[<span class="number">9</span>] + <span class="number">0x41</span>*b[<span class="number">10</span>] + <span class="number">0x34</span>*b[<span class="number">11</span>] + <span class="number">0x74</span>*b[<span class="number">12</span>] + <span class="number">0xde</span>*b[<span class="number">13</span>] + <span class="number">0xd6</span>*b[<span class="number">14</span>] + <span class="number">0x38</span>*b[<span class="number">15</span>] == <span class="number">0x3611A</span>)</span><br><span class="line">s.add(<span class="number">0x5f</span>*b[<span class="number">0</span>] + <span class="number">0x74</span>*b[<span class="number">1</span>] + <span class="number">0x47</span>*b[<span class="number">2</span>] + <span class="number">0x89</span>*b[<span class="number">3</span>] + <span class="number">0xc1</span>*b[<span class="number">4</span>] + <span class="number">0x91</span>*b[<span class="number">5</span>] + <span class="number">0x69</span>*b[<span class="number">6</span>] + <span class="number">0xf7</span>*b[<span class="number">7</span>] + <span class="number">0x39</span> *</span><br><span class="line">      b[<span class="number">8</span>] + <span class="number">0x24</span>*b[<span class="number">9</span>] + <span class="number">0xfd</span>*b[<span class="number">10</span>] + <span class="number">0x93</span>*b[<span class="number">11</span>] + <span class="number">0xa3</span>*b[<span class="number">12</span>] + <span class="number">0x6a</span>*b[<span class="number">13</span>] + <span class="number">0xdf</span>*b[<span class="number">14</span>] + <span class="number">0x14</span>*b[<span class="number">15</span>] == <span class="number">0x3333E</span>)</span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    m = s.model()</span><br><span class="line">    <span class="built_in">print</span>(m)</span><br><span class="line">    enc = [m[b[i]].as_long() <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">    flag = [<span class="built_in">int</span>.from_bytes(<span class="built_in">bytes</span>(enc[<span class="number">4</span>*i:<span class="number">4</span>*(i+<span class="number">1</span>)]),</span><br><span class="line">                           <span class="string">&#x27;little&#x27;</span>) ^ i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        flag[i] = leftShiftXor(flag[i], <span class="number">3</span>)</span><br><span class="line">    flag_byte = <span class="string">b&#x27;&#x27;</span>.join([flag[i].to_bytes(<span class="number">4</span>, <span class="string">&#x27;big&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">hex</span>(flag_byte[i])[<span class="number">2</span>:].zfill(<span class="number">2</span>), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>MRCTF{a3bcdbcb2dce48b486f9d6cead137bd1}</p>
</blockquote>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/re/" rel="tag"># re</a>
          
            <a href="/tags/game/" rel="tag"># game</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2022/04/20/game/starctf2020/starctf2022/" rel="next" title="文件操作-starctf2022">
                <i class="fa fa-chevron-left"></i> 文件操作-starctf2022
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2022/04/28/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.28-angr/" rel="prev" title="4.28-angr安装+入门">
                4.28-angr安装+入门 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="" />
          <p class="site-author-name" itemprop="name"></p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">96</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#DLL%E6%B3%A8%E5%85%A5"><span class="nav-number">1.</span> <span class="nav-text">DLL注入</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1%EF%BC%89-%E5%AE%9A%E4%BD%8DDLL%E6%96%87%E4%BB%B6%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%E7%9A%84%E5%9F%BA%E5%9D%80"><span class="nav-number">1.0.0.1.</span> <span class="nav-text">1） 定位DLL文件在内存中的基址</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#2%EF%BC%89%E8%8E%B7%E5%8F%96%E6%89%80%E9%9C%80%E7%9A%84%E7%B3%BB%E7%BB%9FAPI%E3%80%82"><span class="nav-number">1.0.0.1.1.</span> <span class="nav-text">2）获取所需的系统API。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3%EF%BC%89-%E5%88%86%E9%85%8D%E4%B8%80%E7%89%87%E7%94%A8%E6%9D%A5%E8%A3%85%E8%BD%BDDLL%E7%9A%84%E7%A9%BA%E9%97%B4%E3%80%82"><span class="nav-number">1.0.0.2.</span> <span class="nav-text">3） 分配一片用来装载DLL的空间。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4%EF%BC%89-%E5%A4%8D%E5%88%B6PE%E6%96%87%E4%BB%B6%E5%A4%B4%E5%92%8C%E5%90%84%E4%B8%AA%E8%8A%82"><span class="nav-number">1.0.0.3.</span> <span class="nav-text">4） 复制PE文件头和各个节</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5%EF%BC%89-%E5%A4%84%E7%90%86DLL%E7%9A%84%E8%BE%93%E5%85%A5%E8%A1%A8"><span class="nav-number">1.0.0.4.</span> <span class="nav-text">5） 处理DLL的输入表</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6%EF%BC%89-%E5%AF%B9DLL%E8%BF%9B%E8%A1%8C%E9%87%8D%E5%AE%9A%E4%BD%8D"><span class="nav-number">1.0.0.5.</span> <span class="nav-text">6） 对DLL进行重定位</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7%EF%BC%89-%E8%B0%83%E7%94%A8DLL%E5%85%A5%E5%8F%A3%E7%82%B9"><span class="nav-number">1.0.0.6.</span> <span class="nav-text">7） 调用DLL入口点</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96-%E8%BE%93%E5%85%A5-%E5%90%88%E5%B9%B6"><span class="nav-number">2.</span> <span class="nav-text">初始化,输入,合并</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%A1%E9%AA%8C-%E5%8F%96ast%E8%AF%AD%E6%B3%95%E6%A0%91"><span class="nav-number">3.</span> <span class="nav-text">校验,取ast语法树</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hzlg</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
