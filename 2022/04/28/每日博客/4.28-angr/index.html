<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="re," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="angr">
<meta property="og:type" content="article">
<meta property="og:title" content="4.28-angr安装+入门">
<meta property="og:url" content="https://hzlg.github.ioz/2022/04/28/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.28-angr/index.html">
<meta property="og:site_name" content="hzlg&#39;s blog">
<meta property="og:description" content="angr">
<meta property="og:locale">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/28/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.28-angr/image-20220507230809699.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/28/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.28-angr/zjyy-16520118757264.jpg">
<meta property="article:published_time" content="2022-04-28T07:55:42.860Z">
<meta property="article:modified_time" content="2022-05-10T16:56:41.402Z">
<meta property="article:author" content="hzlg">
<meta property="article:tag" content="re">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hzlg.github.ioz/2022/04/28/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.28-angr/image-20220507230809699.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://hzlg.github.ioz/2022/04/28/每日博客/4.28-angr/"/>





  <title>4.28-angr安装+入门 | hzlg's blog</title>
  














<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">hzlg's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">笔记、日常</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hzlg.github.ioz/2022/04/28/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.28-angr/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hzlg's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">4.28-angr安装+入门</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-04-28T15:55:42+08:00">
                2022-04-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>angr</p>
<span id="more"></span>

<h1 id="安装wsl"><a href="#安装wsl" class="headerlink" title="安装wsl"></a>安装wsl</h1><p>powershell<strong>管理员</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl -<span class="literal">-install</span> <span class="literal">-d</span> Ubuntu</span><br></pre></td></tr></table></figure>

<p>重启电脑</p>
<p>打开ubuntu之后不是root的话，关掉ubuntu然后 powershell<strong>管理员</strong>：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ubuntu config -<span class="literal">-default</span><span class="literal">-user</span> root</span><br></pre></td></tr></table></figure>



<p>想要复制粘贴的话</p>
<p><img src="/2022/04/28/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.28-angr/image-20220507230809699.png" alt="image-20220507230809699"> </p>
<blockquote>
<p>刚装好wsl没有pip?  最好在wsl搭梯子执行↓</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -y update</span><br><span class="line">sudo apt install python3-pip </span><br></pre></td></tr></table></figure>

<p>64位的系统，教程是32位的程序</p>
<p>加装32位的库↓</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg --add-architecture i386</span><br><span class="line"> </span><br><span class="line">sudo apt-get update</span><br><span class="line"> </span><br><span class="line">sudo apt-get install libc6:i386 libncurses5:i386 libstdc++6:i386</span><br></pre></td></tr></table></figure>





<h1 id="python虚拟环境安装angr"><a href="#python虚拟环境安装angr" class="headerlink" title="python虚拟环境安装angr"></a>python虚拟环境安装angr</h1><p>根据文档，angr 会修改 <code>libz3</code> 和 <code>libVEX</code>, 会影响其他程序的正常使用，因此官方推荐使用 Python 虚拟环境 <code>virtualenvwrapper</code></p>
<blockquote>
<p>We highly recommend using a <a target="_blank" rel="noopener" href="https://virtualenvwrapper.readthedocs.org/en/latest/">Python virtual environment</a> to install and use angr. Several of angr’s dependencies (z3, pyvex) require libraries of native code that are forked from their originals, and if you already have libz3 or libVEX installed, you definitely don’t want to overwrite the official shared objects with ours. In general, don’t expect support for problems arising from installing angr outside of a virtualenv.</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/peiwang245/article/details/102467727">Linux 系统下 Python 使用 virtualenvwrapper 安装虚拟环境_peiwang245的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44907926/article/details/117435081">mkvirtualenv Command ‘‘ not found, but can be installed with_孤寒者的博客-CSDN博客</a> </p>
<blockquote>
<p>virtualenv是你在当前路径下创建出来你给取名字的虚拟环境，这样不容易管理，这样你会在哪哪都是虚拟环境，除非你每一次</p>
<p>都切换到你当前下唯一的一个目录下创建虚拟环境，这样你就会特别麻烦 所以引出来了virtualenvwrapper</p>
<p>virtualenvwrapper会在你配置的环境下创建虚拟环境目录，不管你在当前哪个路径下，只要使用命令</p>
<p>mkvirtualenv -p /usr/bin/python3  虚拟环境名 都是创建在你配置的环境中的特定的文件目录下</p>
</blockquote>
<p><strong>virtualenvwrapper创建虚拟环境</strong></p>
<p>pip安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install virtualenv</span><br><span class="line">pip install virtualenvwrapper</span><br></pre></td></tr></table></figure>

<p>修改bashrc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cd ~ </span><br><span class="line">mkdir $HOME/.virtualenvs</span><br><span class="line"></span><br><span class="line">vim .bashrc</span><br><span class="line"></span><br><span class="line">本来是在末尾加上这两句↓ :</span><br><span class="line"># export WORKON_HOME=$HOME/.virtualenvs</span><br><span class="line"># source /usr/local/bin/virtualenvwrapper.sh</span><br><span class="line">真正加这两句↓ :</span><br><span class="line">export VIRTUALENVWRAPPER_PYTHON=&#x27;/usr/bin/python3&#x27;</span><br><span class="line">source /usr/local/bin/virtualenvwrapper.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">加完后运行</span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>

<p>创建虚拟环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mkvirtualenv angr</span><br><span class="line">#创建名为angr的虚拟环境</span><br><span class="line"></span><br><span class="line">workon angr</span><br><span class="line">#在angr虚拟环境下工作</span><br><span class="line"></span><br><span class="line">(angr) root@PC:~# pip3 install angr</span><br><span class="line">#安装angr</span><br><span class="line">。</span><br><span class="line">。</span><br><span class="line">安</span><br><span class="line">装</span><br><span class="line">中</span><br><span class="line">。</span><br><span class="line">。</span><br><span class="line">(angr) root@PC:~#  python3</span><br><span class="line">#在python中import angr测试是否安装成功</span><br><span class="line">Python 3.8.10 (default, Mar 15 2022, 12:22:08)                                                                       [GCC 9.4.0] on linux                                                                                                 Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.                                               &gt;&gt;&gt; import angr</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">#未报错则成功</span><br><span class="line"></span><br><span class="line">deactivate</span><br><span class="line">#关闭环境</span><br></pre></td></tr></table></figure>

<p><strong>virtualenv创建虚拟环境的方法↓,我不喜欢</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">用virtualenv在当前目录下创建的话(开启环境命令好长,感觉virtualenvwrapper好一点):</span><br><span class="line">cd /mnt/d/ctf/re</span><br><span class="line">mkdir angr_ctf-master</span><br><span class="line">cd angr_ctf-master/</span><br><span class="line">whereis python</span><br><span class="line">python: /usr/bin/python3.8 /usr/bin/python3.8-config /usr/lib/python3.8 /usr/lib/python2.7 /etc/python3.8 /usr/local/lib/python3.8 /usr/include/python3.8 /mnt/c/Users/hzlg/AppData/Local/Programs/Python/Python39/python.exe </span><br><span class="line"></span><br><span class="line">把路径↑ 的第一个复制下来,此处我的是/usr/bin/python3.8</span><br><span class="line">virtualenv -p  /usr/bin/python3.8 myenv</span><br><span class="line"></span><br><span class="line">#启动环境</span><br><span class="line">source myenv/bin/activate</span><br></pre></td></tr></table></figure>



<p>我又装了个ipython</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ipython3</span><br><span class="line">sudo pip install ipython</span><br></pre></td></tr></table></figure>



<p>装完后我还是觉得指令太长了</p>
<p>编辑.bash_aliases文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd ~ </span><br><span class="line">vim .bash_aliases</span><br><span class="line"></span><br><span class="line">加入下面两句</span><br><span class="line">alias ipy=&quot;ipython3&quot;                                                                                                  alias angr=&quot;workon angr&quot; </span><br><span class="line"></span><br><span class="line">退出编辑然后运行下面一句</span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>

<h1 id="angr学习"><a href="#angr学习" class="headerlink" title="angr学习"></a>angr学习</h1><p><a target="_blank" rel="noopener" href="https://docs.angr.io/">README - angr Documentation</a></p>
<p><a target="_blank" rel="noopener" href="https://lantern.cool/note-tool-angr/">angr | Lantern’s 小站</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Kt411f7h7">漏洞银行丨二进制自动化解题技术-蓝鲸塔主丨咖面64期_哔哩哔哩_bilibili</a></p>
<h3 id="符号执行是什么"><a href="#符号执行是什么" class="headerlink" title="符号执行是什么"></a>符号执行是什么</h3><p>符号执行就是在运行程序时，用符号来替代真实值。符号执行相较于真实值执行的优点在于，当使用真实值执行程序时，我们能够遍历的程序路径只有一条，而使用符号进行执行时，由于符号是可变的，我们就可以利用这一特性，尽可能的将程序的<strong>每一条路径遍历</strong>，这样的话，必定存在至少一条能够输出正确结果的分支，每一条分支的结果都可以表示为一个离散关系式，使用约束求解引擎即可分析出正确结果。</p>
<blockquote>
<p>符号执行是一种程序分析技术。其可以通过分析程序来<strong>得到让特定代码区域执行的输入</strong>。使用符号执行分析一个程序时，该程序会<strong>使用符号值作为输入</strong>，而非一般执行程序时使用的具体值。在达到目标代码时，<strong>分析器可以得到相应的路径约束</strong>，然后通过约束求解器来得到可以触发目标代码的具体值。</p>
</blockquote>
<h3 id="利用-angr-暴力求解流程"><a href="#利用-angr-暴力求解流程" class="headerlink" title="利用 angr 暴力求解流程"></a>利用 angr 暴力求解流程</h3><ul>
<li>装载二进制文件到到分析平台（就像java定义对象，angr要把二进制文件读取为对象）</li>
<li>转换二进制文件为中间语言 (intermediate representation) (IR) （和ida很像，读取进来转换为汇编，angr是转换为统一的中间语言IR）</li>
<li>转换 IR 为语义描述 (即它做什么而不是它是什么，相当于ida f5转换成伪代码)</li>
<li>执行实际分析。这可能是：<ul>
<li>部分或全程序静态分析（提取条件，即依赖关系分析、程序切片)  “该片程序是否导致内存写入?”</li>
<li>对程序状态空间的符号探索（程序对符号的不断改变,进入下一个区块） “我们可以执行它直到找到溢出吗？”</li>
<li>上述内容的某种组合 “让我们仅执行导致内存写入的程序切片，以查找溢出”</li>
</ul>
</li>
</ul>
<h3 id="装载二进制文件"><a href="#装载二进制文件" class="headerlink" title="装载二进制文件"></a>装载二进制文件</h3><p>angr 的二进制装载组件是 CLE, 它负责装载二进制对象 (以及它依赖的任何库) 和把这个对象以易于操作的方式交给 angr 的其他组件。</p>
<p>(公司开发了个程序,想动态的自动的找出漏洞,就可以用到CLE)</p>
<p>装载命令:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line">b = angr.Project(<span class="string">&quot;ctf_game&quot;</span>)</span><br></pre></td></tr></table></figure>



<p>装载完之后,angr获得了文件的属性,就可以利用project的一些对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(b.entry) // 程序入口点</span><br><span class="line"><span class="built_in">print</span>(b.loader.min_addr, b.loader.max_addr) // 该二进制文件在内存空间中的最小地址和最大地址</span><br><span class="line"><span class="built_in">print</span>(b.filename) // 文件的全名</span><br></pre></td></tr></table></figure>

<h3 id="中间语言"><a href="#中间语言" class="headerlink" title="中间语言"></a>中间语言</h3><p>由于 angr 需要处理很多不同的架构，所以它必须选择一种中间语言 (IR) 来进行它的分析，我们使用 Valgrind 的中间语言，VEX 来完成这方面的内容。VEX 中间语言抽象了几种不同架构间的区别，允许在他们之上进行统一的分析</p>
<p> <img src="/2022/04/28/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.28-angr/zjyy-16520118757264.jpg" alt="zjyy"></p>
<h1 id="无参数模板find-amp-avoid"><a href="#无参数模板find-amp-avoid" class="headerlink" title="无参数模板find &amp; avoid"></a>无参数模板find &amp; avoid</h1><p>简洁版:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"></span><br><span class="line">proj = angr.Project(<span class="string">&#x27;文件名&#x27;</span>) <span class="comment"># 新建一个工程</span></span><br><span class="line"></span><br><span class="line">init_state=proj.factory.entry_state() <span class="comment"># 设置程序的入口</span></span><br><span class="line"></span><br><span class="line">sm=proj.factory.simulation_manager(init_state) <span class="comment"># 模拟执行程序</span></span><br><span class="line"></span><br><span class="line">sm.explore(find=[0xXXX, 0xXXX], avoid=[0xXXX, 0xXXX]) <span class="comment"># 执行到某个条件,避免某个条件,多放点条件比较好</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sm.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># import sys</span></span><br><span class="line"><span class="comment"># if simulation.found:   # 检查是否发现了解决方案</span></span><br><span class="line"><span class="comment">#     solution_state = simulation.found[0] # 找到符合条件的值</span></span><br><span class="line"><span class="comment">#     print(solution_state.posix.dumps(sys.stdin.fileno()))  # 打印出angr执行到这个状态时的输入，也就是我们所希望的flag</span></span><br><span class="line"><span class="comment"># else:</span></span><br><span class="line"><span class="comment">#     raise Exception(&#x27;Cannot find&#x27;)</span></span><br></pre></td></tr></table></figure>

<h1 id="有参数模板"><a href="#有参数模板" class="headerlink" title="有参数模板"></a>有参数模板</h1><p>pip install claripy</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line">proj = angr.Project(<span class="string">&#x27;./程序名字&#x27;</span>, auto_load_libs=<span class="literal">False</span>)</span><br><span class="line">argv1 = claripy.BVS(<span class="string">&quot;argv1&quot;</span>, <span class="number">9</span> * <span class="number">8</span>) <span class="comment"># BVS(比特向量字符串)这里用的单位是bit, 爆破9个char型变量需要9乘以8个bit</span></span><br><span class="line">state = proj.factory.entry_state(args=[<span class="string">&#x27;./程序名字&#x27;</span>, argv1])  <span class="comment"># 导入参数</span></span><br><span class="line">sm = proj.factory.sm(state)</span><br><span class="line"><span class="built_in">print</span>(sm.explore(find=<span class="number">0x4007DC</span>, avoid=<span class="number">0x4007EA</span>))</span><br><span class="line"><span class="built_in">print</span>(sm.found[<span class="number">0</span>].solver.<span class="built_in">eval</span>(argv1, cast_to=<span class="built_in">bytes</span>)) <span class="comment"># solver.eval是比特向量转字符串，直接输出是ascii码, 用cast_to=bytes转为bytes类型</span></span><br></pre></td></tr></table></figure>

<h1 id="多输入模板"><a href="#多输入模板" class="headerlink" title="//多输入模板"></a>//多输入模板</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line">p = angr.Project(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">init_addr = <span class="number">0x08048980</span>  <span class="comment">#scanf的下一条指令地址</span></span><br><span class="line">state = p.factory.blank_state(addr=init_addr)  <span class="comment">#创建一个状态，并将该地址赋给它，也就是跳过输入，直接执行下一条指令,此处使用.blank_state()而不再是.entry_state()</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#定义三个位向量，即三个输入</span></span><br><span class="line">p1 = claripy.BVS(<span class="string">&#x27;p1&#x27;</span>,<span class="number">32</span>)   <span class="comment">#32位寄存器（符号向量）</span></span><br><span class="line">p2 = claripy.BVS(<span class="string">&#x27;p2&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">p3 = claripy.BVS(<span class="string">&#x27;p3&#x27;</span>,<span class="number">32</span>)	</span><br><span class="line"> </span><br><span class="line">state.regs.eax = p1    <span class="comment">#.regs.eax 访问eax这个寄存器</span></span><br><span class="line">state.regs.ebx = p2</span><br><span class="line">state.regs.edx = p3</span><br><span class="line">sm = p.factory.simulation_manager(state)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">good</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Good Job.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bad</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Try again.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line">sm.explore(find = good, avoid = bad)</span><br><span class="line"><span class="keyword">if</span> sm.found:</span><br><span class="line">    find_state = sm.found[<span class="number">0</span>]</span><br><span class="line">    flag1 = find_state.solver.<span class="built_in">eval</span>(p1)<span class="comment">#将探索成功时的第一个输入赋给flag1，下面两个类似</span></span><br><span class="line">    flag2 = find_state.solver.<span class="built_in">eval</span>(p2)</span><br><span class="line">    flag3 = find_state.solver.<span class="built_in">eval</span>(p3)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#123;:x&#125; &#123;:x&#125; &#123;:x&#125;&#x27;</span>.<span class="built_in">format</span>(flag1,flag2,flag3))</span><br></pre></td></tr></table></figure>



<h1 id="网鼎杯-2020-青龙组-singal"><a href="#网鼎杯-2020-青龙组-singal" class="headerlink" title="网鼎杯 2020 青龙组 singal"></a>网鼎杯 2020 青龙组 singal</h1><p>一道vm,main函数就是给出opcode,执行</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4[<span class="number">117</span>]; <span class="comment">// [esp+18h] [ebp-1D4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  __main();</span><br><span class="line">  qmemcpy(v4, &amp;dword_403040, <span class="number">0x1C8</span>u);</span><br><span class="line">  vm_operad(v4, <span class="number">114</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;good,The answer format is:flag &#123;&#125;&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>找到成功和失败的地址,直接加进angr:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line">proj = angr.Project(<span class="string">&#x27;/mnt/d/ctf/re/buudownload/signal.exe&#x27;</span>,auto_load_libs = <span class="literal">False</span>)  <span class="comment">#载入文件创建镜像</span></span><br><span class="line">state = proj.factory.entry_state() <span class="comment"># 根据镜像创建进程</span></span><br><span class="line">sm = proj.factory.sm(state)  <span class="comment"># 创建一个模拟器，用来模拟执行求解</span></span><br><span class="line">sm.explore(find = <span class="number">0x40179E</span>,avoid = <span class="number">0x401539</span>)  <span class="comment"># 成功的地址和失败的地址</span></span><br><span class="line"><span class="built_in">print</span> (sm.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>))  <span class="comment"># 把要找的结果输出</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b&#x27;757515121f3d478\x00\x08J&quot;\x1aI\x00\x00\x00J\x01\x00\x01\x02\x00\x08\x00\x1a\x80\x01\x02\x89\x00\x0e\x80\x02\x00\x00\x08\x00\x04)\x8a)\x0f\x08\x19\x01)\x0e*\x01\x08\x02\x80&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;757515121f3d478&#125;</span><br></pre></td></tr></table></figure>



<p>多约束:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line">project = angr.Project(<span class="string">&quot;./signal.exe&quot;</span>)</span><br><span class="line">state = project.factory.entry_state()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReplacementScanf</span>(<span class="params">angr.SimProcedure</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self, format_string, string_address</span>):</span></span><br><span class="line">        flag = claripy.BVS(<span class="string">&#x27;flag&#x27;</span>, <span class="number">8</span> * <span class="number">0xf</span>)</span><br><span class="line">        self.state.memory.store(string_address, flag)</span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> flag.chop(bits=<span class="number">8</span>):   <span class="comment"># 限制为可见字符</span></span><br><span class="line">            self.state.add_constraints(char &gt;= <span class="string">&#x27;0&#x27;</span>, char &lt;= <span class="string">&#x27;z&#x27;</span>)</span><br><span class="line">        self.state.<span class="built_in">globals</span>[<span class="string">&#x27;solutions&#x27;</span>] = (flag)</span><br><span class="line"></span><br><span class="line">scanf_symbol = <span class="string">&quot;scanf&quot;</span></span><br><span class="line">project.hook_symbol(scanf_symbol, ReplacementScanf())</span><br><span class="line"></span><br><span class="line">sm = project.factory.sm(state)</span><br><span class="line">sm.explore(find=<span class="number">0x0040179E</span>, avoid=<span class="number">0x04016E6</span>)</span><br><span class="line"><span class="keyword">if</span> sm.found:</span><br><span class="line">    solver_state = sm.found[<span class="number">0</span>]</span><br><span class="line">    stored_solution = solver_state.<span class="built_in">globals</span>[<span class="string">&#x27;solutions&#x27;</span>]</span><br><span class="line">    <span class="built_in">print</span>(solver_state.solver.<span class="built_in">eval</span>(</span><br><span class="line">        stored_solution, cast_to = <span class="built_in">bytes</span>))</span><br></pre></td></tr></table></figure>



<hr>
<p>angr_ctf</p>
<p>b站视频<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV167411o7WK?spm_id_from=333.999.0.0">angr符号执行练习 00_angr_find_哔哩哔哩_bilibili</a></p>
<p>b站视频里的题库<a target="_blank" rel="noopener" href="https://github.com/jakespringer/angr_ctf">jakespringer/angr_ctf (github.com)</a> </p>
<p>b站视频里题库的脚本<a target="_blank" rel="noopener" href="https://blog.csdn.net/Palmer9/article/details/103737973">二进制分析工具angr的使用学习（1）_Forgo7ten的博客-CSDN博客_angr工具</a></p>
<h1 id="find输入流判断函数"><a href="#find输入流判断函数" class="headerlink" title="find输入流判断函数"></a>find输入流判断函数</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">    bin_path = argv[<span class="number">1</span>]</span><br><span class="line">    proj = angr.Project(bin_path)</span><br><span class="line">    init_state = proj.factory.entry_state()</span><br><span class="line">    sm = proj.factory.simgr(init_state)</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">is_good</span>(<span class="params">state</span>):</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">b&quot;Good Job.&quot;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">is_bad</span>(<span class="params">state</span>):</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">b&quot;Try again.&quot;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	sm.explore(find=is_good, avoid=is_bad)    </span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> sm.found:</span><br><span class="line">		<span class="built_in">print</span>(sm.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main(sys.argv)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HETOBRCU</span><br></pre></td></tr></table></figure>






















      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/re/" rel="tag"># re</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-data%E4%B8%AD%E5%87%BD%E6%95%B0/" rel="next" title="4.23-MRCTF-cicada">
                <i class="fa fa-chevron-left"></i> 4.23-MRCTF-cicada
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2022/05/03/game/minil2022/twin/" rel="prev" title="TLS回调,Hook,子进程保护，xxtea">
                TLS回调,Hook,子进程保护，xxtea <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="" />
          <p class="site-author-name" itemprop="name"></p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">71</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85wsl"><span class="nav-number">1.</span> <span class="nav-text">安装wsl</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#python%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85angr"><span class="nav-number">2.</span> <span class="nav-text">python虚拟环境安装angr</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#angr%E5%AD%A6%E4%B9%A0"><span class="nav-number">3.</span> <span class="nav-text">angr学习</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%A6%E5%8F%B7%E6%89%A7%E8%A1%8C%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">3.0.1.</span> <span class="nav-text">符号执行是什么</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8-angr-%E6%9A%B4%E5%8A%9B%E6%B1%82%E8%A7%A3%E6%B5%81%E7%A8%8B"><span class="nav-number">3.0.2.</span> <span class="nav-text">利用 angr 暴力求解流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A3%85%E8%BD%BD%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6"><span class="nav-number">3.0.3.</span> <span class="nav-text">装载二进制文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%AD%E9%97%B4%E8%AF%AD%E8%A8%80"><span class="nav-number">3.0.4.</span> <span class="nav-text">中间语言</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%97%A0%E5%8F%82%E6%95%B0%E6%A8%A1%E6%9D%BFfind-amp-avoid"><span class="nav-number">4.</span> <span class="nav-text">无参数模板find &amp; avoid</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%89%E5%8F%82%E6%95%B0%E6%A8%A1%E6%9D%BF"><span class="nav-number">5.</span> <span class="nav-text">有参数模板</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A4%9A%E8%BE%93%E5%85%A5%E6%A8%A1%E6%9D%BF"><span class="nav-number">6.</span> <span class="nav-text">&#x2F;&#x2F;多输入模板</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-singal"><span class="nav-number">7.</span> <span class="nav-text">网鼎杯 2020 青龙组 singal</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#find%E8%BE%93%E5%85%A5%E6%B5%81%E5%88%A4%E6%96%AD%E5%87%BD%E6%95%B0"><span class="nav-number">8.</span> <span class="nav-text">find输入流判断函数</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hzlg</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
