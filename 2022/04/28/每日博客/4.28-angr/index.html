<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="re," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="angr">
<meta property="og:type" content="article">
<meta property="og:title" content="4.28-angr安装+入门">
<meta property="og:url" content="https://hzlg.github.ioz/2022/04/28/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.28-angr/index.html">
<meta property="og:site_name" content="hzlg&#39;s blog">
<meta property="og:description" content="angr">
<meta property="og:locale">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/28/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.28-angr/image-20220511151551398.png">
<meta property="og:image" content="https://hzlg.github.ioz/2022/04/28/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.28-angr/image-20220507230809699.png">
<meta property="article:published_time" content="2022-04-28T07:55:42.860Z">
<meta property="article:modified_time" content="2022-05-14T15:02:42.883Z">
<meta property="article:author" content="hzlg">
<meta property="article:tag" content="re">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hzlg.github.ioz/2022/04/28/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.28-angr/image-20220511151551398.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://hzlg.github.ioz/2022/04/28/每日博客/4.28-angr/"/>





  <title>4.28-angr安装+入门 | hzlg's blog</title>
  














<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">hzlg's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">笔记、日常</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hzlg.github.ioz/2022/04/28/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.28-angr/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hzlg's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">4.28-angr安装+入门</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-04-28T15:55:42+08:00">
                2022-04-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>angr</p>
<span id="more"></span>

<p>本来安装流程记录在最前面的,但是每次翻笔记都看到,烦了,放最后去了</p>
<hr>
<p>angr_ctf</p>
<p>b站视频   <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV167411o7WK?spm_id_from=333.999.0.0">angr符号执行练习 00_angr_find_哔哩哔哩_bilibili</a></p>
<p>b站视频里的题库   <a target="_blank" rel="noopener" href="https://github.com/jakespringer/angr_ctf">jakespringer/angr_ctf (github.com)</a> </p>
<p>angr总览,里面有angr_ctf写好的脚本  <a target="_blank" rel="noopener" href="https://lantern.cool/note-tool-angr/">angr | Lantern’s 小站</a></p>
<h1 id="00-amp-01-无参数模板-find-amp-avoid"><a href="#00-amp-01-无参数模板-find-amp-avoid" class="headerlink" title="00 &amp; 01 无参数模板 find &amp; avoid"></a>00 &amp; 01 无参数模板 find &amp; avoid</h1><p>find(想要的地址), avoid(不想要的地址)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"></span><br><span class="line">proj = angr.Project(<span class="string">&#x27;文件名&#x27;</span>) <span class="comment"># 新建一个工程</span></span><br><span class="line"></span><br><span class="line">init_state=proj.factory.entry_state() <span class="comment"># 设置程序的入口</span></span><br><span class="line"></span><br><span class="line">sm=proj.factory.simgr(init_state) <span class="comment"># 模拟执行程序</span></span><br><span class="line"></span><br><span class="line">sm.explore(find=[0xXXX, 0xXXX], avoid=[0xXXX, 0xXXX]) <span class="comment">#explore:根据find和avoid进行基本块的执行，最后会返回found和avoid状态</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sm.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>)) <span class="comment">#打印输入</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># import sys</span></span><br><span class="line"><span class="comment"># if simulation.found:   # 检查是否发现了解决方案</span></span><br><span class="line"><span class="comment">#     solution_state = simulation.found[0] # 找到符合条件的值</span></span><br><span class="line"><span class="comment">#     print(solution_state.posix.dumps(sys.stdin.fileno()))  # 打印出angr执行到这个状态时的输入，也就是我们所希望的flag</span></span><br><span class="line"><span class="comment"># else:</span></span><br><span class="line"><span class="comment">#     raise Exception(&#x27;Cannot find&#x27;)</span></span><br></pre></td></tr></table></figure>



<h1 id="02-find-输出流校验"><a href="#02-find-输出流校验" class="headerlink" title="02 find( 输出流校验 )"></a>02 find( 输出流校验 )</h1><p>写一个函数返回布尔值,输出流里有想要的就返回true,把函数放进find里</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_good</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;Good Job.&quot;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_bad</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;Try again.&quot;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">    bin_path = argv[<span class="number">1</span>]</span><br><span class="line">    proj = angr.Project(bin_path)</span><br><span class="line">    init_state = proj.factory.entry_state()</span><br><span class="line">    sm = proj.factory.simgr(init_state)</span><br><span class="line">    sm.explore(find=is_good, avoid=is_bad)</span><br><span class="line">    <span class="keyword">if</span> sm.found:</span><br><span class="line">        <span class="built_in">print</span>(sm.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main(sys.argv)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python 02.py ./02_angr_find_condition </span><br><span class="line">b&#x27;HETOBRCU&#x27;</span><br></pre></td></tr></table></figure>



<h1 id="03-多输入-寄存器符号化"><a href="#03-多输入-寄存器符号化" class="headerlink" title="03 多输入 寄存器符号化"></a>03 多输入 寄存器符号化</h1><blockquote>
<p>用01和02的脚本测试,发现其实angr现在已经支持多输入了</p>
</blockquote>
<p>main函数:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [esp+8h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  v3 = get_user_input();</span><br><span class="line">  v7 = HIDWORD(v3);</span><br><span class="line">  v5 = complex_function_1(v3);</span><br><span class="line">  v6 = complex_function_2();</span><br><span class="line">  v8 = complex_function_3(v7);</span><br><span class="line">  <span class="keyword">if</span> ( v5 || v6 || v8 )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>input附近的汇编:输入存到了寄存器中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.text:08048978                 add     esp, 10h</span><br><span class="line">.text:0804897B                 call    get_user_input</span><br><span class="line">.text:08048980                 mov     [ebp+var_14], eax</span><br><span class="line">.text:08048983                 mov     [ebp+var_10], ebx</span><br><span class="line">.text:08048986                 mov     [ebp+var_C], edx</span><br><span class="line">.text:08048989                 sub     esp, 0Ch</span><br><span class="line">.text:0804898C                 push    [ebp+var_14]</span><br><span class="line">.text:0804898F                 call    complex_function_1</span><br></pre></td></tr></table></figure>

<p>有多个变量,就要引入claripy(不用其实也行)</p>
<p>在<strong>设置模拟程序入口</strong>时绕过scanf (用<strong>blank_state</strong>而不是entry_state了)</p>
<p><strong>定义</strong> 比特向量(位向量)字符串 ,<strong>赋给寄存器</strong>以代替输入</p>
<p><strong>求解</strong> ( 此时find_state.posix.dumps(0)<strong>输入为空</strong>,输出为b’Good Job.\n’ )</p>
<p>format的基本语法是通过 <strong>{}</strong> 和 <strong>:</strong> 来代替以前的 <strong>%</strong> </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># import claripy</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_good</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;Good Job.&quot;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_bad</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;Try again.&quot;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">    bin_path = argv[<span class="number">1</span>]</span><br><span class="line">    proj = angr.Project(bin_path)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># init_state = proj.factory.entry_state()</span></span><br><span class="line">    start_addr = <span class="number">0x08048980</span> <span class="comment"># 绕过scanf</span></span><br><span class="line">    state = proj.factory.blank_state(addr = start_addr)</span><br><span class="line">    <span class="comment"># 使用.blank_state()而不再是上面的 .entry_state()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义三个位向量，即三个输入</span></span><br><span class="line">    <span class="comment"># 用claripy的话就是p1 = claripy.BVS(&#x27;p1&#x27;, 32)</span></span><br><span class="line">    p1 = state.solver.BVS(<span class="string">&#x27;p1&#x27;</span>, <span class="number">32</span>)  <span class="comment"># 32位寄存器（符号向量）</span></span><br><span class="line">    p2 = state.solver.BVS(<span class="string">&#x27;p2&#x27;</span>, <span class="number">32</span>)</span><br><span class="line">    p3 = state.solver.BVS(<span class="string">&#x27;p3&#x27;</span>, <span class="number">32</span>)</span><br><span class="line">    </span><br><span class="line">    state.regs.eax = p1  <span class="comment"># 第一个输入在ida中看到被存入了eax</span></span><br><span class="line">    state.regs.ebx = p2</span><br><span class="line">    state.regs.edx = p3</span><br><span class="line"></span><br><span class="line">    sm = proj.factory.simgr(state)</span><br><span class="line"></span><br><span class="line">    sm.explore(find=is_good, avoid=is_bad)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> sm.found:</span><br><span class="line">        find_state = sm.found[<span class="number">0</span>] <span class="comment"># 此时输入为空,输出为b&#x27;Good Job.\n&#x27;</span></span><br><span class="line">        flag1 = find_state.solver.<span class="built_in">eval</span>(p1)  <span class="comment"># 探索成功时求解得到的第一个输入赋给flag1</span></span><br><span class="line">        flag2 = find_state.solver.<span class="built_in">eval</span>(p2)</span><br><span class="line">        flag3 = find_state.solver.<span class="built_in">eval</span>(p3)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&#123;:x&#125; &#123;:x&#125; &#123;:x&#125;&#x27;</span>.<span class="built_in">format</span>(flag1, flag2, flag3))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;No result&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main(sys.argv)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b9ffd04e ccf63fe8 8fd4d959</span><br></pre></td></tr></table></figure>



<h1 id="04-多输入-栈符号化"><a href="#04-多输入-栈符号化" class="headerlink" title="04 多输入 栈符号化"></a>04 多输入 栈符号化</h1><blockquote>
<p>02的脚本其实也行</p>
</blockquote>
<p>scanf旁的汇编:输入存到了栈中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.text:08048679 var_10= dword ptr -10h</span><br><span class="line">.text:08048679 var_C= dword ptr -0Ch</span><br><span class="line"></span><br><span class="line">.text:0804868F call    ___isoc99_scanf</span><br><span class="line">.text:08048694 add     esp, 10h              //这里是清除scanf的栈帧</span><br><span class="line">.text:08048697 mov     eax, [ebp+var_C]      //从这里开始</span><br><span class="line">.text:0804869A sub     esp, 0Ch</span><br><span class="line">.text:0804869D push    eax</span><br><span class="line">.text:0804869E call    complex_function0</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/28/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.28-angr/image-20220511151551398.png" alt="image-20220511151551398"> </p>
<p>把栈模拟成这样就行了</p>
<p>压栈:<code>state.stack_push(state.regs.ebp)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_good</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;Good Job.&quot;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_bad</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;Try again.&quot;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">    bin_path = argv[<span class="number">1</span>]</span><br><span class="line">    proj = angr.Project(bin_path)</span><br><span class="line">    </span><br><span class="line">    start_addr = <span class="number">0x08048697</span> <span class="comment"># 绕过scanf</span></span><br><span class="line">    state = proj.factory.blank_state(addr = start_addr)</span><br><span class="line"></span><br><span class="line">    p1 = state.solver.BVS(<span class="string">&#x27;p1&#x27;</span>, <span class="number">32</span>)</span><br><span class="line">    p2 = state.solver.BVS(<span class="string">&#x27;p2&#x27;</span>, <span class="number">32</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 此时ebp是 &lt;BV32 reg_ebp_7_32&#123;UNINITIALIZED&#125;&gt;, esp是&lt;BV32 0x7fff0000&gt; </span></span><br><span class="line">    state.regs.ebp = state.regs.esp</span><br><span class="line">    </span><br><span class="line">    padding = <span class="number">0xC</span>-<span class="number">4</span></span><br><span class="line">    state.regs.esp -= padding <span class="comment"># 把无关的空间跳过</span></span><br><span class="line">  </span><br><span class="line">    state.stack_push(p1)  <span class="comment"># 第一个输入入栈</span></span><br><span class="line">    state.stack_push(p2)</span><br><span class="line"></span><br><span class="line">    sm = proj.factory.simgr(state)</span><br><span class="line"></span><br><span class="line">    sm.explore(find=is_good, avoid=is_bad)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> sm.found:</span><br><span class="line">        find_state = sm.found[<span class="number">0</span>]</span><br><span class="line">        flag1 = find_state.solver.<span class="built_in">eval</span>(p1)  </span><br><span class="line">        flag2 = find_state.solver.<span class="built_in">eval</span>(p2)</span><br><span class="line">        <span class="built_in">print</span>(flag1,flag2)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;No result&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main(sys.argv)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1704280884 2382341151 </span><br></pre></td></tr></table></figure>



<h1 id="05-多输入-内存符号化"><a href="#05-多输入-内存符号化" class="headerlink" title="05 多输入 内存符号化"></a>05 多输入 内存符号化</h1><blockquote>
<p>02的脚本还是可以</p>
</blockquote>
<p>main:输入到了已知的内存</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(user_input, <span class="number">0</span>, <span class="number">0x21</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%8s %8s %8s %8s&quot;</span>, user_input, &amp;unk_A1BA1C8, &amp;unk_A1BA1D0, &amp;unk_A1BA1D8);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">    *(_BYTE *)(i + <span class="number">169583040</span>) = complex_function(*(<span class="keyword">char</span> *)(i + <span class="number">169583040</span>), i);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(user_input, <span class="string">&quot;NJPURZPCDYEAXCSJZJMPSOMBFDDLHBVN&quot;</span>, <span class="number">0x20</span>u) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>scanf附件的汇编:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.text:080485D5 call    _printf</span><br><span class="line">.text:080485DA add     esp, 10h</span><br><span class="line">.text:080485DD sub     esp, 0Ch</span><br><span class="line">.text:080485E0 push    offset unk_A1BA1D8</span><br><span class="line">.text:080485E5 push    offset unk_A1BA1D0</span><br><span class="line">.text:080485EA push    offset unk_A1BA1C8</span><br><span class="line">.text:080485EF push    offset user_input</span><br><span class="line">.text:080485F4 push    offset a8s8s8s8s ; &quot;%8s %8s %8s %8s&quot;</span><br><span class="line">.text:080485F9 call    ___isoc99_scanf</span><br></pre></td></tr></table></figure>

<p>把BVS塞进内存就行</p>
<p><code>p1_addr = 0xA1BA1C0</code></p>
<p><code>state.memory.store(p1_addr, p1)</code></p>
<p>(因为是scanf 8%s,所以bvs里是8*8=64位,求解的时候也要加<code>cast_to=bytes</code>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_good</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;Good Job.&quot;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_bad</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;Try again.&quot;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">    bin_path = argv[<span class="number">1</span>]</span><br><span class="line">    proj = angr.Project(bin_path)</span><br><span class="line"></span><br><span class="line">    start_addr = <span class="number">0x08048601</span>  <span class="comment"># 绕过scanf</span></span><br><span class="line">    state = proj.factory.blank_state(addr=start_addr)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#p1 = state.solver.BVS(&#x27;p1&#x27;, 64)</span></span><br><span class="line">    <span class="comment">#p2 = state.solver.BVS(&#x27;p2&#x27;, 64)</span></span><br><span class="line">    <span class="comment">#p3 = state.solver.BVS(&#x27;p3&#x27;, 64)</span></span><br><span class="line">    <span class="comment">#p4 = state.solver.BVS(&#x27;p4&#x27;, 64)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#p1_addr = 0xA1BA1C0</span></span><br><span class="line">    <span class="comment">#p2_addr = 0xA1BA1C8</span></span><br><span class="line">    <span class="comment">#p3_addr = 0xA1BA1D0</span></span><br><span class="line">    <span class="comment">#p4_addr = 0xA1BA1D8</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#state.memory.store(p1_addr, p1)</span></span><br><span class="line">    <span class="comment">#state.memory.store(p2_addr, p2)</span></span><br><span class="line">    <span class="comment">#state.memory.store(p3_addr, p3)</span></span><br><span class="line">    <span class="comment">#state.memory.store(p4_addr, p4)</span></span><br><span class="line"></span><br><span class="line">    p1_addr = <span class="number">0xA1BA1C0</span></span><br><span class="line">    <span class="comment"># %8s也就是8个字节, 也就是64位</span></span><br><span class="line">    password = [state.solver.BVS(<span class="string">&quot;p%d&quot;</span>, <span class="number">64</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这四个参数的地址是连续的, 间隔8个字节</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        state.memory.store(p1_addr + i * <span class="number">8</span>, password[i])</span><br><span class="line">        </span><br><span class="line">    sm = proj.factory.simgr(state)</span><br><span class="line"></span><br><span class="line">    sm.explore(find=is_good, avoid=is_bad)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> sm.found:</span><br><span class="line">        find_state = sm.found[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            <span class="built_in">print</span>(find_state.solver.<span class="built_in">eval</span>(password[i], cast_to=<span class="built_in">bytes</span>).decode())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;No result&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main(sys.argv)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NAXTHGNR JVSFTPWE LMGAUHWC XMDCPALU</span><br></pre></td></tr></table></figure>



<h1 id="06-多输入-随机内存符号化"><a href="#06-多输入-随机内存符号化" class="headerlink" title="06 多输入 随机内存符号化"></a>06 多输入 随机内存符号化</h1><p>main函数：随机malloc空间来存输入</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *v3; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">char</span> *v4; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [esp-10h] [ebp-1Ch]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+0h] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  buffer0 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">9u</span>);</span><br><span class="line">  buffer1 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">9u</span>);</span><br><span class="line">  <span class="built_in">memset</span>(buffer0, <span class="number">0</span>, <span class="number">9u</span>);</span><br><span class="line">  <span class="built_in">memset</span>(buffer1, <span class="number">0</span>, <span class="number">9u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%8s %8s&quot;</span>, buffer0, buffer1, v6);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = &amp;buffer0[i];</span><br><span class="line">    *v3 = complex_function(buffer0[i], i);</span><br><span class="line">    v4 = &amp;buffer1[i];</span><br><span class="line">    *v4 = complex_function(buffer1[i], i + <span class="number">32</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(buffer0, <span class="string">&quot;UODXLZBI&quot;</span>, <span class="number">8u</span>) &amp;&amp; !<span class="built_in">strncmp</span>(buffer1, <span class="string">&quot;UAORRAYF&quot;</span>, <span class="number">8u</span>) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="built_in">free</span>(buffer0);</span><br><span class="line">  <span class="built_in">free</span>(buffer1);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>scanf旁的汇编:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:08048691 call    ___isoc99_scanf</span><br><span class="line">.text:08048696 add     esp, 10h</span><br><span class="line">.text:08048699 mov     [ebp+var_C], 0</span><br></pre></td></tr></table></figure>



<p>伪造malloc出来的空间,再构造BVS即可</p>
<blockquote>
<p>其中 endness有三个值，分别为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Variables:  </span><br><span class="line">LE – little endian, least significant byte is stored at lowest address</span><br><span class="line">BE – big endian, most significant byte is stored at lowest address</span><br><span class="line">ME – Middle-endian. Yep.</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_good</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;Good Job.&quot;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_bad</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;Try again.&quot;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">    bin_path = argv[<span class="number">1</span>]</span><br><span class="line">    proj = angr.Project(bin_path)</span><br><span class="line"></span><br><span class="line">    start_addr = <span class="number">0x08048699</span>  <span class="comment"># 绕过scanf</span></span><br><span class="line">    state = proj.factory.blank_state(addr=start_addr)</span><br><span class="line"></span><br><span class="line">    p1 = state.solver.BVS(<span class="string">&#x27;p1&#x27;</span>, <span class="number">64</span>)</span><br><span class="line">    p2 = state.solver.BVS(<span class="string">&#x27;p2&#x27;</span>, <span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(&quot;ESP:&quot;,state.regs.esp)   查看当前esp地址，用作开辟堆空间</span></span><br><span class="line">    fake_p0 = state.regs.esp - <span class="number">0x100</span>  <span class="comment"># 伪造一个地址作为malloc出来的随机地址,等下存入buufer0中</span></span><br><span class="line">    buffer0_addr = <span class="number">0x0ABCC8A4</span>  <span class="comment"># ida中bss段里buffer0的地址</span></span><br><span class="line">    <span class="comment"># angr默认大端存放数据，需要转换为小端存放</span></span><br><span class="line">    state.memory.store(buffer0_addr, fake_p0, endness=proj.arch.memory_endness)</span><br><span class="line"></span><br><span class="line">    fake_p1 = state.regs.esp - <span class="number">0x200</span></span><br><span class="line">    buffer1_addr = <span class="number">0x0ABCC8AC</span></span><br><span class="line">    state.memory.store(buffer1_addr, fake_p1, endness=proj.arch.memory_endness)</span><br><span class="line"></span><br><span class="line">    state.memory.store(fake_p0, p1)</span><br><span class="line">    state.memory.store(fake_p1, p2)</span><br><span class="line"></span><br><span class="line">    sm = proj.factory.simgr(state)</span><br><span class="line"></span><br><span class="line">    sm.explore(find=is_good, avoid=is_bad)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> sm.found:</span><br><span class="line">        find_state = sm.found[<span class="number">0</span>]</span><br><span class="line">        flag1 = find_state.solver.<span class="built_in">eval</span>(p1, cast_to=<span class="built_in">bytes</span>).decode()</span><br><span class="line">        flag2 = find_state.solver.<span class="built_in">eval</span>(p2, cast_to=<span class="built_in">bytes</span>).decode()</span><br><span class="line">        <span class="built_in">print</span>(flag1, flag2)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;No result&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main(sys.argv)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UBDKLMBV UNOERNYS</span><br></pre></td></tr></table></figure>

<h1 id="07-多输入-文件符号化"><a href="#07-多输入-文件符号化" class="headerlink" title="//07 多输入 文件符号化"></a>//07 多输入 文件符号化</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AZOMMMZM</span><br></pre></td></tr></table></figure>



<h1 id="安装wsl"><a href="#安装wsl" class="headerlink" title="安装wsl"></a>安装wsl</h1><p>powershell<strong>管理员</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl -<span class="literal">-install</span> <span class="literal">-d</span> Ubuntu</span><br></pre></td></tr></table></figure>

<p>重启电脑</p>
<p>打开ubuntu之后不是root的话，关掉ubuntu然后 powershell<strong>管理员</strong>：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ubuntu config -<span class="literal">-default</span><span class="literal">-user</span> root</span><br></pre></td></tr></table></figure>



<p>想要复制粘贴的话</p>
<p><img src="/2022/04/28/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.28-angr/image-20220507230809699.png" alt="image-20220507230809699"> </p>
<blockquote>
<p>刚装好wsl没有pip?  最好在wsl搭梯子执行↓</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -y update</span><br><span class="line">sudo apt install python3-pip </span><br></pre></td></tr></table></figure>

<p>64位的系统，教程是32位的程序</p>
<p>加装32位的库↓</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg --add-architecture i386</span><br><span class="line"> </span><br><span class="line">sudo apt-get update</span><br><span class="line"> </span><br><span class="line">sudo apt-get install libc6:i386 libncurses5:i386 libstdc++6:i386</span><br></pre></td></tr></table></figure>





<h1 id="python虚拟环境安装angr"><a href="#python虚拟环境安装angr" class="headerlink" title="python虚拟环境安装angr"></a>python虚拟环境安装angr</h1><p>根据文档，angr 会修改 <code>libz3</code> 和 <code>libVEX</code>, 会影响其他程序的正常使用，因此官方推荐使用 Python 虚拟环境 <code>virtualenvwrapper</code></p>
<blockquote>
<p>We highly recommend using a <a target="_blank" rel="noopener" href="https://virtualenvwrapper.readthedocs.org/en/latest/">Python virtual environment</a> to install and use angr. Several of angr’s dependencies (z3, pyvex) require libraries of native code that are forked from their originals, and if you already have libz3 or libVEX installed, you definitely don’t want to overwrite the official shared objects with ours. In general, don’t expect support for problems arising from installing angr outside of a virtualenv.</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/peiwang245/article/details/102467727">Linux 系统下 Python 使用 virtualenvwrapper 安装虚拟环境_peiwang245的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44907926/article/details/117435081">mkvirtualenv Command ‘‘ not found, but can be installed with_孤寒者的博客-CSDN博客</a> </p>
<blockquote>
<p>virtualenv是你在当前路径下创建出来你给取名字的虚拟环境，这样不容易管理，这样你会在哪哪都是虚拟环境，除非你每一次</p>
<p>都切换到你当前下唯一的一个目录下创建虚拟环境，这样你就会特别麻烦 所以引出来了virtualenvwrapper</p>
<p>virtualenvwrapper会在你配置的环境下创建虚拟环境目录，不管你在当前哪个路径下，只要使用命令</p>
<p>mkvirtualenv -p /usr/bin/python3  虚拟环境名 都是创建在你配置的环境中的特定的文件目录下</p>
</blockquote>
<p><strong>virtualenvwrapper创建虚拟环境</strong></p>
<p>pip安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install virtualenv</span><br><span class="line">pip install virtualenvwrapper</span><br></pre></td></tr></table></figure>

<p>修改bashrc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cd ~ </span><br><span class="line">mkdir $HOME/.virtualenvs</span><br><span class="line"></span><br><span class="line">vim .bashrc</span><br><span class="line"></span><br><span class="line">本来是在末尾加上这两句↓ :</span><br><span class="line"># export WORKON_HOME=$HOME/.virtualenvs</span><br><span class="line"># source /usr/local/bin/virtualenvwrapper.sh</span><br><span class="line">真正加这两句↓ :</span><br><span class="line">export VIRTUALENVWRAPPER_PYTHON=&#x27;/usr/bin/python3&#x27;</span><br><span class="line">source /usr/local/bin/virtualenvwrapper.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">加完后运行</span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>

<p>创建虚拟环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mkvirtualenv angr</span><br><span class="line">#创建名为angr的虚拟环境</span><br><span class="line"></span><br><span class="line">workon angr</span><br><span class="line">#在angr虚拟环境下工作</span><br><span class="line"></span><br><span class="line">(angr) root@PC:~# pip3 install angr</span><br><span class="line">#安装angr</span><br><span class="line">。</span><br><span class="line">。</span><br><span class="line">安</span><br><span class="line">装</span><br><span class="line">中</span><br><span class="line">。</span><br><span class="line">。</span><br><span class="line">(angr) root@PC:~#  python3</span><br><span class="line">#在python中import angr测试是否安装成功</span><br><span class="line">Python 3.8.10 (default, Mar 15 2022, 12:22:08)                                                                       [GCC 9.4.0] on linux                                                                                                 Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.                                               &gt;&gt;&gt; import angr</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">#未报错则成功</span><br><span class="line"></span><br><span class="line">deactivate</span><br><span class="line">#关闭环境</span><br></pre></td></tr></table></figure>

<p><strong>virtualenv创建虚拟环境的方法↓,我不喜欢</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">用virtualenv在当前目录下创建的话(开启环境命令好长,感觉virtualenvwrapper好一点):</span><br><span class="line">cd /mnt/d/ctf/re</span><br><span class="line">mkdir angr_ctf-master</span><br><span class="line">cd angr_ctf-master/</span><br><span class="line">whereis python</span><br><span class="line">python: /usr/bin/python3.8 /usr/bin/python3.8-config /usr/lib/python3.8 /usr/lib/python2.7 /etc/python3.8 /usr/local/lib/python3.8 /usr/include/python3.8 /mnt/c/Users/hzlg/AppData/Local/Programs/Python/Python39/python.exe </span><br><span class="line"></span><br><span class="line">把路径↑ 的第一个复制下来,此处我的是/usr/bin/python3.8</span><br><span class="line">virtualenv -p  /usr/bin/python3.8 myenv</span><br><span class="line"></span><br><span class="line">#启动环境</span><br><span class="line">source myenv/bin/activate</span><br></pre></td></tr></table></figure>



<p>我又装了个ipython</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ipython3</span><br><span class="line">sudo pip install ipython</span><br></pre></td></tr></table></figure>



<p>装完后我还是觉得指令太长了</p>
<p>编辑.bash_aliases文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd ~ </span><br><span class="line">vim .bash_aliases</span><br><span class="line"></span><br><span class="line">加入下面两句</span><br><span class="line">alias ipy=&quot;ipython3&quot;                                                                                                  alias angr=&quot;workon angr&quot; </span><br><span class="line"></span><br><span class="line">退出编辑然后运行下面一句</span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>


      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/re/" rel="tag"># re</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2022/04/23/%E6%AF%8F%E6%97%A5%E5%8D%9A%E5%AE%A2/4.23-MRCTF-data%E4%B8%AD%E5%87%BD%E6%95%B0/" rel="next" title="4.23-MRCTF-cicada">
                <i class="fa fa-chevron-left"></i> 4.23-MRCTF-cicada
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2022/05/03/game/minil2022/twin/" rel="prev" title="TLS回调,Hook,子进程保护，xxtea">
                TLS回调,Hook,子进程保护，xxtea <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="" />
          <p class="site-author-name" itemprop="name"></p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">74</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#00-amp-01-%E6%97%A0%E5%8F%82%E6%95%B0%E6%A8%A1%E6%9D%BF-find-amp-avoid"><span class="nav-number">1.</span> <span class="nav-text">00 &amp; 01 无参数模板 find &amp; avoid</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#02-find-%E8%BE%93%E5%87%BA%E6%B5%81%E6%A0%A1%E9%AA%8C"><span class="nav-number">2.</span> <span class="nav-text">02 find( 输出流校验 )</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#03-%E5%A4%9A%E8%BE%93%E5%85%A5-%E5%AF%84%E5%AD%98%E5%99%A8%E7%AC%A6%E5%8F%B7%E5%8C%96"><span class="nav-number">3.</span> <span class="nav-text">03 多输入 寄存器符号化</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#04-%E5%A4%9A%E8%BE%93%E5%85%A5-%E6%A0%88%E7%AC%A6%E5%8F%B7%E5%8C%96"><span class="nav-number">4.</span> <span class="nav-text">04 多输入 栈符号化</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#05-%E5%A4%9A%E8%BE%93%E5%85%A5-%E5%86%85%E5%AD%98%E7%AC%A6%E5%8F%B7%E5%8C%96"><span class="nav-number">5.</span> <span class="nav-text">05 多输入 内存符号化</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#06-%E5%A4%9A%E8%BE%93%E5%85%A5-%E9%9A%8F%E6%9C%BA%E5%86%85%E5%AD%98%E7%AC%A6%E5%8F%B7%E5%8C%96"><span class="nav-number">6.</span> <span class="nav-text">06 多输入 随机内存符号化</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#07-%E5%A4%9A%E8%BE%93%E5%85%A5-%E6%96%87%E4%BB%B6%E7%AC%A6%E5%8F%B7%E5%8C%96"><span class="nav-number">7.</span> <span class="nav-text">&#x2F;&#x2F;07 多输入 文件符号化</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85wsl"><span class="nav-number">8.</span> <span class="nav-text">安装wsl</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#python%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85angr"><span class="nav-number">9.</span> <span class="nav-text">python虚拟环境安装angr</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hzlg</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
