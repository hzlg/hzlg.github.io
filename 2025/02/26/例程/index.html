<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="CFI," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="例程">
<meta property="og:type" content="article">
<meta property="og:title" content="例程">
<meta property="og:url" content="https://hzlg.github.ioz/2025/02/26/%E4%BE%8B%E7%A8%8B/index.html">
<meta property="og:site_name" content="hzlg&#39;s blog">
<meta property="og:description" content="例程">
<meta property="og:locale">
<meta property="og:image" content="https://hzlg.github.ioz/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250415153433267.png">
<meta property="og:image" content="https://hzlg.github.ioz/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250415153457380.png">
<meta property="og:image" content="https://hzlg.github.ioz/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250415153636336.png">
<meta property="og:image" content="https://hzlg.github.ioz/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250415145940869.png">
<meta property="og:image" content="https://hzlg.github.ioz/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250415150017921.png">
<meta property="og:image" content="https://hzlg.github.ioz/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250415150139483.png">
<meta property="og:image" content="https://hzlg.github.ioz/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250415163323679.png">
<meta property="og:image" content="https://hzlg.github.ioz/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250412173012541.png">
<meta property="og:image" content="https://hzlg.github.ioz/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250412173240441.png">
<meta property="og:image" content="https://hzlg.github.ioz/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250412173510973.png">
<meta property="og:image" content="https://hzlg.github.ioz/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250302114027978.png">
<meta property="og:image" content="https://hzlg.github.ioz/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250302150402165.png">
<meta property="og:image" content="https://hzlg.github.ioz/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250413234807447.png">
<meta property="article:published_time" content="2025-02-26T04:40:30.060Z">
<meta property="article:modified_time" content="2025-05-13T07:21:34.703Z">
<meta property="article:author" content="hzlg">
<meta property="article:tag" content="CFI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hzlg.github.ioz/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250415153433267.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://hzlg.github.ioz/2025/02/26/例程/"/>





  <title>例程 | hzlg's blog</title>
  














<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">hzlg's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">笔记、日常</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hzlg.github.ioz/2025/02/26/%E4%BE%8B%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hzlg's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">例程</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-02-26T12:40:30+08:00">
                2025-02-26
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-05-13T15:21:34+08:00">
                2025-05-13
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>例程</p>
<span id="more"></span>

<h1 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h1><blockquote>
<p>Type Metadata 是 LLVM 中一种以元数据形式附加在全局对象（通常是 C++ 类的 vtable 常量）或函数上的机制，每个元数据节点由字节偏移量和类型标识符组成。LLVM 提供了 <code>llvm.type.test</code> 内建函数用于测试给定指针是否与某个类型标识符关联。借助元数据，如果 llvm.type.test 对特定指针返回 true，则我们可以静态地确定特定的 virtual call 可能会调用的虚拟函数的身份 。引入 Type Metadata 的主要目的是在不改变程序语义的前提下，为间接调用提供更加精确的静态类型信息。具体来说：我们在载入 LLVM Module后遍历全局变量，收集所有带有metadata 的 vtable 常量，构建一个从 TypeID 到若干 (GlobalVariable*, slotOffset) 对的映射；接着使用llvm.type.test结合 llvm.assume 定位在特定假设下可去虚拟化的 CallSite，随后根据映射从对应的 vtable 常量初始化器中按偏移读取出真实的函数指针作为候选CallTarget；最后我们生成一张CallSite 到目标函数集合的映射，将此映射与来自 SVF、DeepType 的结果合并，输出包含完整间接调用目标信息的 IR 文件。</p>
<p>Type Metadata is a mechanism in LLVM that attaches metadata to global objects (typically vtable constants of C++ classes) or functions. Each metadata node consists of a byte offset and a type identifier. LLVM provides the intrinsic ‘llvm.type.test’ to determine whether a given pointer is associated with a specific type identifier. With the assistance of metadata, if ‘llvm.type.test’ returns true for a particular pointer, we can statically deduce the identity of the virtual function that a specific virtual call might invoke. The primary objective of introducing Type Metadata is to furnish more precise static type information for indirect calls without altering program semantics. Specifically, after loading the LLVM Module, we traverse global variables, gather all vtable constants with metadata, and construct a mapping from TypeID to multiple (GlobalVariable*, slotOffset) pairs. Subsequently, ‘llvm.type.test’ and ‘llvm.assume’ are utilized to identify CallSites that can be devirtualized under certain assumptions and then take the actual function pointer from the corresponding vtable constant initializer as the candidate CallTarget according to the mapping.   Ultimately, we generate a mapping from CallSite to the Calltarget function set, merge this mapping with the results obtained from SVF and DeepType, and produce an IR file containing comprehensive indirect call target information.</p>
</blockquote>
<blockquote>
<p>Type metadata 是一种机制，允许 IR 模块协作地构建与一组全局变量内地址相对应的指针集合。 </p>
<p>LLVM 提供了 <code>llvm.type.test</code> 内建函数（intrinsic）用于测试给定指针是否与某个类型标识符关联；</p>
<p>借助这些元数据，<code>llvm.type.test</code> 可在运行时或 LTO 阶段判断某个指针是否属于特定类型，从而支持 CFI 检查与虚函数去虚拟化。</p>
<p>有了这个类型元数据，我们现在可以使用 llvm.type.test 内部函数来 测试给定指针是否与类型标识符兼容。如果 llvm.type.test 对特定指针返回 true，则 我们还可以静态地确定特定的 virtual call 可能会调用的虚拟函数的身份 。</p>
<p>With this type metadata, we can now use the <code>llvm.type.test</code> intrinsic to test whether a given pointer is compatible with a type identifier.if <code>llvm.type.test</code> returns true for a particular pointer, we can also statically determine the identities of the virtual functions that a particular virtual call may call.</p>
</blockquote>
<blockquote>
<p>为每个 vtable 全局常量加上Type metadata</p>
<p>使用两个llvm内建函数llvm.type.test（检查指针 <code>%ptr</code> 是否“可能指向”由 <code>TypeID</code> 标识的类型实例。）, llvm.assume（告诉 LLVM 优化器，“你可以假设 <code>%cond</code> 恒为真”，从而启发更多的优化。）</p>
<ol>
<li>重建 TypeID → {vtable,offset} 映射</li>
<li>扫描 type.test users，填充 CallSlots</li>
<li>对每个 (TypeID, offset) 分组：<ol>
<li>根据 TypeID+offset 找出所有候选函数</li>
<li>对该槽位下的每个调用点，读取 inCallID metadata 并将结果写入全局 map TypeMDIncallEdges</li>
</ol>
</li>
</ol>
<p><strong>效果</strong>：</p>
<ul>
<li>读取 Type Metadata（vtable 上的 <code>!llvm.type</code>）。</li>
<li>结合 CFI 插入的 <code>llvm.type.test</code>/<code>llvm.assume</code>，定位所有可去虚拟化的调用。</li>
<li>根据 vtable 常量解析真正的函数指针表项，生成精确的候选目标列表。</li>
<li>将 <code>(inCallID → &#123;isVCall, target set&#125;)</code> 写入 <code>TypeMDIncallEdges</code>，后续可供合并或直接用于 IR 注入。</li>
</ul>
<p><strong>Type Metadata</strong>（<code>!llvm.type</code>）标记了每个 vtable 全局常量属于哪些类型。</p>
<p>通过一个虚拟表指针%p，在llvm.assume（llvm.type）的假设下，查找所有的虚拟调用。测试(% p % md))。这表明%p指向类型标识符%md的成员。按（类型ID，偏移量）对（实际上是虚拟函数的标识）对调用进行分组，并存储到CallSlots中。</p>
<p>首先在偏移量s处搜索虚函数实现的类型标识符的每个成员。ByteOffset，并添加到TargetsForSlot。</p>
<p>ind all virtual calls via a virtual table pointer %p under an assumption of the form llvm.assume(llvm.type. test(%p, %md)).  This indicates that %p  points to a member of the type identifier %md.  Group calls by (type ID,  offset) pair (effectively the identity of the virtual function) and store to CallSlots.</p>
<p>Search each of the members of the type identifier for the virtual function implementation at offset S.first. ByteOffset, and add to TargetsForSlot. </p>
</blockquote>
<blockquote>
<p>When merging multiple IR modules, LLVM by default merges structure types with identical layouts.  This behavior can inadvertently cause the merging of types that are intended to remain distinct.  For tools such as MLTA, Deeptype, and HPCFI, which rely on type analysis to identify indirect calls, this merging can lead to false type matching, thereby causing the misidentification of indirect calls.</p>
<p>To address this issue, we have developed a patch for LLVM that enhances the IR merging process.  Specifically, the patch modifies the matching logic of <code>StructType</code> to prevent the erroneous merging of types with different names but identical layouts.</p>
<p>In detail, we introduced a ‘Name’ field into <code>StructTypeKeyInfo::KeyTy</code>, which stores the structure name.  Since LLVM automatically appends numeric suffixes to structure names during IR processing, we modified the <code>getTypeNamePrefix</code> function to support the restoration of the original structure names (e.g., <code>%foo.42.1.23</code> is reverted to <code>%foo</code>).  Subsequently, we updated the type-mapping logic to use the newly introduced ‘KeyTy’ instead of relying solely on layout-based matching.  This stricter struct-matching policy ensures that type mapping is not entirely dependent on memory layout.  Even if structs share the same layout, they remain independent after linking due to their semantically distinct names and origins from separate modules.  For instance, if <code>%class. A</code> exists in the destination module, <code>%class. B</code> with the same layout in the source module will not map to <code>%class.A</code>.  However, <code>%class.A. 2</code> and <code>%class.A. 3</code> will correctly map to <code>%class.A</code>.</p>
<p>当合并多个IR模块时，LLVM默认合并具有相同布局的结构类型。这种行为可能会无意中导致原本希望保持不同的类型合并。对于MLTA、Deeptype和HPCFI等依赖类型分析来识别间接调用的工具，这种合并可能导致错误的类型匹配，从而导致对间接调用的错误识别。</p>
<p>为了解决这个问题，我们为LLVM开发了一个补丁，增强了IR合并过程。具体来说，补丁修改了‘ StructType ’的匹配逻辑，以防止错误地合并具有不同名称但相同布局的类型。</p>
<p>详细地说，我们在StructTypeKeyInfo::KeyTy中引入了一个‘Name’字段，它存储了结构的名称。由于LLVM在IR处理过程中会自动将数字后缀添加到结构名称中，因此我们修改了‘ getTypeNamePrefix ’函数以支持恢复原始结构名称（例如，‘ %foo.42.1.23 ’被恢复为‘ %foo ’）。随后，我们更新了类型映射逻辑，使用新引入的“KeyTy”，而不是仅仅依赖于基于布局的匹配。这种更严格的结构匹配策略确保类型映射不完全依赖于内存布局。即使结构共享相同的布局，它们在链接后仍然保持独立，因为它们在语义上的名称不同，并且来自不同的模块。例如，if ‘ %class。‘存在于目标模块’ %class中。在源模块中具有相同布局的B ‘将不会映射到’ %class a ‘。然而,“% class.A.2 ‘和’ %class.A.3 ‘将正确映射到’ %class.A ‘。</p>
</blockquote>
<blockquote>
<p>在将多个 IR 模块合并时，LLVM 默认会合并布局相同的结构体类型。这会导致一些本意上应分离的类型被错误地合并。对于MLTA，Deeptype和HPCFI等依赖类型分析来识别间接调用的工具，这种合并可能引发错误的类型匹配，导致间接调用的错误识别。</p>
<p>因此，我们对LLVM进行了修补，这个补丁对 LLVM 的 IR 合并过程进行了增强，特别是修改了结构体类型（<code>StructType</code>）的匹配逻辑，以避免<strong>结构体名不同但布局相同</strong>的类型被错误地合并。 </p>
<p>具体来说，我们在 StructTypeKeyInfo::KeyTy 中加入 ‘Name’ 字段，它存储结构名。由于LLVM 在处理 IR 时会自动给 <code>%struct.name</code> 加上数字后缀（如 <code>%struct.name.42.1</code>）。为了获取没有数字后缀的结构名用于识别“原始类型”，我们修改了 getTypeNamePrefix 以支持恢复 LLVM 的自动重命名结构体（例如，%foo.42.1.23被还原为%foo）。随后我们修改了类型映射的逻辑，将原先的只看 layout的方式：改为使用新引入的 <code>KeyTy</code> 查找精确匹配的结构体。更严格的结构体匹配策略确保了类型映射不完全基于内存布局，即便结构体的布局相同，但由于它们语义上的名字不同、来自不同模块，它们在链接后会继续保持独立。如果目标模块中已有 <code>%class.A</code>，则 <code>%class.A.2</code>, <code>%class.A.3</code> 会识别为相同类别。如果是 <code>%class.B</code>，即使布局相同，也不会合并进 <code>%class.A</code>，因为前缀不同。</p>
<p>这确保了，从而防止合并具有相同布局的不同结构。例如，如果 %class.A存在于Dst中。在Src中具有相同布局的%class.B将不会映射到%class.A。然而,% class.A.2和%class.A.3将映射到%class.A。</p>
</blockquote>
<blockquote>
<p><strong>核心修改点分析</strong></p>
<ol>
<li><strong>引入类型名</strong>作为哈希和查找键的一部分,避免不同命名但结构相同的类型被视为相同</li>
</ol>
<p>在 <code>StructTypeKeyInfo::KeyTy</code> 中加入 <code>StringRef Name</code> 字段，并将其纳入比较和哈希逻辑中</p>
<img src="/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250415153433267.png" alt="image-20250415153433267" style="zoom:25%;"> 

<ol start="2">
<li><p>修改了 getTypeNamePrefix 以支持恢复 LLVM 的自动重命名结构体</p>
<p>Modified getTypeNamePrefix to support restoring LLVM’s auto-renamed structs,</p>
<p>引入 <code>getTypeNamePrefix</code> 逻辑，恢复类型前缀</p>
<p>目的：</p>
<p>LLVM 在处理 IR 时会自动给 <code>%struct.name</code> 加上数字后缀（如 <code>%struct.name.42.1</code>）。此函数会<strong>剥离尾部数字</strong>，保留原始前缀 <code>struct.name</code>，用于识别“原始类型”。</p>
<img src="/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250415153457380.png" alt="image-20250415153457380" style="zoom:25%;"> </li>
<li><p>在类型映射中使用名称前缀进行匹配</p>
</li>
</ol>
<img src="/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250415153636336.png" alt="image-20250415153636336" style="zoom:25%;"> 

<ol start="3">
<li><p>修改 IRLinker 的类型映射逻辑</p>
<p>将原先的“按前缀查找结构体类型”方式：改为使用新引入的 <code>KeyTy</code> 查找精确匹配的结构体：</p>
</li>
</ol>
<p>✅ <strong>优势</strong></p>
<ul>
<li><p>更严格的结构体匹配策略，即便结构体的布局相同，但由于它们语义上的名字不同、来自不同模块，它们在链接后会继续保持独立。避免语义错误合并。</p>
</li>
<li><h5 id="效果："><a href="#效果：" class="headerlink" title="效果："></a>效果：</h5><ol>
<li>如果目标模块中已有 <code>%class.A</code>，则 <code>%class.A.2</code>, <code>%class.A.3</code> 会识别为相同。</li>
<li>如果是 <code>%class.B</code>，即使布局相同，也不会合并进 <code>%class.A</code>，因为前缀不同。</li>
</ol>
</li>
<li><p>对 auto-renamed 类型（带数字后缀）仍保持合并能力。</p>
</li>
</ul>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// a.cpp</span><br><span class="line">struct A &#123;</span><br><span class="line">    int x;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">A a_obj;</span><br><span class="line"></span><br><span class="line">// b.cpp</span><br><span class="line">struct B &#123;</span><br><span class="line">    int x;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">B b_obj;</span><br><span class="line"></span><br><span class="line"><span class="comment"># /home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/</span></span><br><span class="line">clang++ -S -emit-llvm a.cpp -o a.ll</span><br><span class="line"><span class="comment">#%struct.A = type &#123; i32 &#125;</span></span><br><span class="line"><span class="comment">#@a_obj = dso_local global %struct.A zeroinitializer, align 4</span></span><br><span class="line"></span><br><span class="line">clang++ -S -emit-llvm b.cpp -o b.ll</span><br><span class="line"><span class="comment">#%struct.B = type &#123; i32 &#125;</span></span><br><span class="line"><span class="comment">#@b_obj = dso_local global %struct.B zeroinitializer, align 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ab.bc 是 bitcode 文件</span></span><br><span class="line">llvm-link a.ll b.ll -o ab.bc</span><br><span class="line"><span class="comment"># ab.ll 是可读的 LLVM IR 文本文件</span></span><br><span class="line">llvm-dis ab.bc -o ab.ll </span><br><span class="line"><span class="comment"># %struct.A = type &#123; i32 &#125;</span></span><br><span class="line"><span class="comment"># @a_obj = dso_local global %struct.A zeroinitializer, align 4</span></span><br><span class="line"><span class="comment"># @b_obj = dso_local global %struct.A zeroinitializer, align 4</span></span><br></pre></td></tr></table></figure>

<blockquote>
<img src="/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250415145940869.png" alt="image-20250415145940869" style="zoom: 25%;"> 

<img src="/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250415150017921.png" alt="image-20250415150017921" style="zoom:25%;"> 

<img src="/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250415150139483.png" alt="image-20250415150139483" style="zoom: 25%;"> 

<p>修改后</p>
<img src="/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250415163323679.png" alt="image-20250415163323679" style="zoom:25%;">  


</blockquote>
<p>Modified getTypeNamePrefix to support restoring LLVM’s auto-renamed structs</p>
<p>e.g., %foo.42.1.23 is restored to %foo.</p>
<p>修改getTypeNamePrefix以支持恢复LLVM的自动重命名结构 例如，%foo.42.1.23被还原为%foo。</p>
<p>When processing structs, first check if a struct with the same layout exists in Dst’s struct set.<br>We added a ‘Name’ field in the StructTypeKeyInfo index of DstStructTypesSet,<br>which stores the struct name without numerical suffixes (e.g., %foo.42 becomes %foo).<br>This ensures that type mapping is not based solely on memory layout, preventing merging of different structs with the same layout.<br>For example, if %class.A exists in Dst, %class.B with the same layout in Src will not map to %class.A.<br>However, %class.A.2 and %class.A.3 will map to %class.A.</p>
<p>处理结构体时，首先检查Dst的结构体集中是否存在具有相同布局的结构体。<br>我们在DstStructTypesSet的StructTypeKeyInfo索引中增加了一个‘Name’字段。<br>它存储没有数字后缀的结构名（例如%foo.42变成%foo）。<br>这确保了类型映射不完全基于内存布局，从而防止合并具有相同布局的不同结构。<br>例如，如果 %class.A存在于Dst中。在Src中具有相同布局的%class.B将不会映射到%class.A。<br>然而,% class.A.2和%class.A.3将映射到%class.A。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/Lqs66/llvm-16.0.4/tree/d03acbfd782b43daa7df58ffeb826d132f151aa4">Commit d03acbf</a></p>
<img src="/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250412173012541.png" alt="image-20250412173012541" style="zoom:50%;"> 

<p>Commit 8cf494d</p>
<p>llvm/include/llvm/Linker/IRMover.h</p>
<img src="/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250412173240441.png" alt="image-20250412173240441" style="zoom:50%;"> 

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">llvm/include/llvm/Linker/IRMover.h</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;llvm/ADT/StringRef.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">StringRef Name; <span class="comment">// Add struct type name as part of the key.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">KeyTy</span>(ArrayRef&lt;Type *&gt; E, StringRef Name, <span class="keyword">bool</span> P);</span><br><span class="line"></span><br><span class="line"><span class="function">StructType *<span class="title">findNonOpaque</span><span class="params">(ArrayRef&lt;Type *&gt; ETypes, StringRef Name, <span class="keyword">bool</span> IsPacked)</span></span>;</span><br></pre></td></tr></table></figure>

<p>llvm/lib/Linker/IRMover.cpp</p>
<img src="/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250412173510973.png" alt="image-20250412173510973" style="zoom:50%;"> 

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Modified getTypeNamePrefix to support restoring LLVM&#x27;s auto-renamed structs,</span></span><br><span class="line"><span class="comment">  *  e.g., %foo.42.1.23 is restored to %foo.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">static</span> StringRef <span class="title">getTypeNamePrefix</span><span class="params">(StringRef Name)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">while</span> (!Name.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">     <span class="keyword">size_t</span> DotPos = Name.<span class="built_in">rfind</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">     <span class="keyword">if</span> (DotPos == StringRef::npos || DotPos == <span class="number">0</span> || DotPos == Name.<span class="built_in">size</span>() - <span class="number">1</span>)</span><br><span class="line">       <span class="keyword">return</span> Name;</span><br><span class="line">       </span><br><span class="line">     <span class="comment">// 检查点号后面是否都是数字</span></span><br><span class="line">     <span class="keyword">bool</span> AllDigits = <span class="literal">true</span>;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">size_t</span> i = DotPos + <span class="number">1</span>; i &lt; Name.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">       <span class="keyword">if</span> (!<span class="built_in">isdigit</span>(<span class="keyword">static_cast</span>&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt;(Name[i]))) &#123;</span><br><span class="line">         AllDigits = <span class="literal">false</span>;</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (!AllDigits)</span><br><span class="line">       <span class="keyword">return</span> Name;</span><br><span class="line">       </span><br><span class="line">     Name = Name.<span class="built_in">substr</span>(<span class="number">0</span>, DotPos);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> Name;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   <span class="comment">// When processing structs, first check if a struct with the same layout exists in Dst&#x27;s struct set.</span></span><br><span class="line">   <span class="comment">// We added a &#x27;Name&#x27; field in the StructTypeKeyInfo index of DstStructTypesSet,</span></span><br><span class="line">   <span class="comment">// which stores the struct name without numerical suffixes (e.g., %foo.42 becomes %foo).</span></span><br><span class="line">   <span class="comment">// This ensures that type mapping is not based solely on memory layout, preventing merging of different structs with the same layout.</span></span><br><span class="line">   <span class="comment">// For example, if %class.A exists in Dst, %class.B with the same layout in Src will not map to %class.A.</span></span><br><span class="line">   <span class="comment">// However, %class.A.2 and %class.A.3 will map to %class.A.</span></span><br><span class="line"></span><br><span class="line">DstStructTypesSet.<span class="built_in">findNonOpaque</span>(ElementTypes, <span class="built_in">getTypeNamePrefix</span>(STy-&gt;<span class="built_in">getName</span>()), IsPacked)) &#123;</span><br></pre></td></tr></table></figure>


</blockquote>
<h1 id="spec"><a href="#spec" class="headerlink" title="spec"></a>spec</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/20438081/answer/1227008670">(7 封私信) 如何使用 SPEC CPU2006 ？ - 知乎</a></p>
<p><a target="_blank" rel="noopener" href="https://www.spec.org/cpu2006/Docs/">SPEC CPU2006 Documentation</a></p>
<p><a target="_blank" rel="noopener" href="https://www.spec.org/cpu2006/Docs/install-guide-unix.html">Unix 安装 SPEC CPU2006</a></p>
<p><a target="_blank" rel="noopener" href="https://www.spec.org/cpu2006/Docs/runspec.html">runspec (CPU2006)</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd media...</span><br><span class="line">cp sos_spec06.tar.xz ~/Desktop/</span><br><span class="line">cd ~/Desktop/</span><br><span class="line">tar -vxf sos_spec06.tar.xz</span><br><span class="line">cd spec2006/</span><br><span class="line">./install.sh</span><br><span class="line">yes</span><br><span class="line">source ./shrc</span><br><span class="line">cd config</span><br><span class="line">cp Example-linux64-amd64-gcc43+.cfg mytest.cfg</span><br></pre></td></tr></table></figure>

<blockquote>
<p>1）ref：测试规模（测试规模有 test, ref, train 其中 test 最小跑的时间最短，如果测试编译器正确性的时候可以用 test 规模，但是想测试性能时候用 ref）<br>2）iterations = 3 次：测试次数（编译器性能稳定时候测一次就行），也可以写成 n 3;<br>如果想得到加权统计的结果，也就是常说的 cpu 的 spec 分数，需要设置 iterations 大于等于 3。<br>3） all 测试范围: 表示进行 fp 和 int 测试（将 all 替换成 int 或 fp 进行定点和浮点的测试；将 all 替换成 456/444 等文件编号，表示对某一测试项进行单独测试）<br>对于 CPU 的 SPEC 测试，默认这一项是 all，但是对于其中的某一项测试分数不满意，可通过指定此测试项的编号，进行单独测试。测试也会得到一个分数，做单项的性能调优时候，可以用得到。<br>4）输出格式：-o text, screen, pdf 表示测试完成，生成报告的格式，依次分别是 txt, 屏幕显示和 pdf 格式，保存目录在 spec 解压目录 result 中。<br>5）noreportable &amp;&amp; reportable : 表示检测/不检测生成的二进制文件是否修改过。<br>–reportable 如果原来生成的二进制文件被修改了，则运行时会自动重新编译生成二进制文件，确保运行的程序是原始的程序。<br>6）测试核数：-r 设置测试的 CPU 核心数目；<br>7）测试模式：-tune = base 基准测试；-tune = peak 峰值测试；-tune 默认是 base 可以选择 base, peak, or all ，Report 首先是 base, 其次是 peak.<br>8）-I : 表示测试中，如遇报错，略过错误继续测试；</p>
</blockquote>
<blockquote>
<ol>
<li>(测试spec能不能用)执行 benchmark 可执行文件至少可以启动的最小验证</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runspec --config=mytest.cfg --size=test --noreportable --tune=base --iterations=1 bzip2</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ol start="2">
<li>(测试修改成clang能不能用)</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lin1216/p/13226689.html">spec cpu2006 测试 - 无人知晓 LLH - 博客园</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp Example-linux64-amd64-gcc43+.cfg clang.cfg</span><br><span class="line">vim clang.cfg</span><br></pre></td></tr></table></figure>

<p>==改成 clang==，只测试 C++</p>
<p>400 和 473,483 会有问题，需要==改一下配置文件，降低 C++标准==</p>
<p><img src="/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250302114027978.png" alt="image-20250302114027978" style="zoom: 50%;"> <img src="/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250302150402165.png" alt="image-20250302150402165" style="zoom:50%;"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CLANGPATH = /home/hzlg/Desktop/mlta/llvm-project/prefix</span><br><span class="line">#CC                 = /usr/bin/gcc</span><br><span class="line">#CXX                = /usr/bin/g++</span><br><span class="line">CC           = $&#123;CLANGPATH&#125;/bin/clang</span><br><span class="line">CXX          = $&#123;CLANGPATH&#125;/bin/clang++</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">400.perlbench=default=default=default:</span><br><span class="line">CPORTABILITY   = -DSPEC_CPU_LINUX_X64 -std=gnu89</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">473.astar=default=default=default:</span><br><span class="line">CXXOPTIMIZE += -std=c++98</span><br><span class="line"></span><br><span class="line">483.xalancbmk=default=default=default:</span><br><span class="line">CXXOPTIMIZE += -std=c++98</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">runspec -c clang.cfg -i test -noreportable -o text,screen,pdf -n 1 400 401 403 429 445 456 458 462 464 471 473 483</span><br><span class="line">runspec -c clang.cfg -i ref -noreportable -o text,screen,pdf -n 1 400 401 403 429 445 456 458 462 464 471 473 483</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><del>全项目测试</del>（Fortran不行）</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Luckiers/article/details/125816524">SPEC2006详细参数和测试过程常见问题处理总结（附实例操作）-CSDN博客</a></p>
<p>runspec -c MLTA_clang.cfg –size=ref -o text,screen,pdf -I –iterations=1 all</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Error: 1x410.bwaves 1x416.gamess 1x434.zeusmp 1x435.gromacs 1x436.cactusADM 1x437.leslie3d 1x447.dealII 1x450.soplex 1x454.calculix 1x459.GemsFDTD 1x465.tonto 1x481.wrf</span><br><span class="line"></span><br><span class="line">Success: 1x400.perlbench 1x401.bzip2 1x403.gcc 1x429.mcf 1x433.milc 1x444.namd 1x445.gobmk 1x453.povray 1x456.hmmer 1x458.sjeng 1x462.libquantum 1x464.h264ref 1x470.lbm 1x471.omnetpp 1x473.astar 1x482.sphinx3 1x483.xalancbmk 1x998.specrand 1x999.specrand</span><br></pre></td></tr></table></figure>

<h2 id="MLTA"><a href="#MLTA" class="headerlink" title="MLTA"></a>MLTA</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">cp clang.cfg MLTA.cfg</span><br><span class="line">vim MLTA.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment">#COPTIMIZE   = -O2 -fno-strict-aliasing</span></span><br><span class="line"><span class="comment">#CXXOPTIMIZE = -O2 -fno-strict-aliasing</span></span><br><span class="line">COPTIMIZE   = -Wno-error -g -Xclang -no-opaque-pointers -Xclang -flegacy-pass-manager -Xclang -load -Xclang /home/hzlg/Desktop/mlta/IRDumper/build/lib/libDumper.so</span><br><span class="line">CXXOPTIMIZE = -Wno-error -g -Xclang -no-opaque-pointers -Xclang -flegacy-pass-manager -Xclang -load -Xclang /home/hzlg/Desktop/mlta/IRDumper/build/lib/libDumper.so</span><br><span class="line"></span><br><span class="line"><span class="comment">#runspec -c MLTA.cfg -i test -noreportable -o text,screen,pdf -n 1 401</span></span><br><span class="line"><span class="comment">#runspec -c MLTA.cfg -i test -noreportable -o text,screen,pdf -n 1 458</span></span><br><span class="line"><span class="comment">#runspec -c MLTA.cfg -i test -noreportable -o text,screen,pdf -n 1 433</span></span><br><span class="line"><span class="comment">#runspec -c MLTA.cfg -i test -noreportable -o text,screen,pdf -n 1 482</span></span><br><span class="line"><span class="comment">#runspec -c MLTA.cfg -i test -noreportable -o text,screen,pdf -n 1 456</span></span><br><span class="line"><span class="comment">#runspec -c MLTA.cfg -i test -noreportable -o text,screen,pdf -n 1 464</span></span><br><span class="line"><span class="comment">#runspec -c MLTA.cfg -i test -noreportable -o text,screen,pdf -n 1 445</span></span><br><span class="line"><span class="comment">#runspec -c MLTA.cfg -i test -noreportable -o text,screen,pdf -n 1 400</span></span><br><span class="line"><span class="comment">#runspec -c MLTA.cfg -i test -noreportable -o text,screen,pdf -n 1 403</span></span><br><span class="line">thttpd</span><br><span class="line">memcached</span><br><span class="line">lighttpd</span><br><span class="line">exim</span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">#runspec -c MLTA.cfg -i ref -noreportable -o text,screen,pdf -n 3 401 458 433 482 456 464 445 400 403</span></span><br><span class="line"><span class="comment">#find ../../spec2006 -name &quot;*.bc&quot; &gt; ~/Desktop/mlta/build/lib/bc.list</span></span><br><span class="line">runspec -c MLTA.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 401 458 433 482 456 464 445 400 403</span><br><span class="line"><span class="comment">#  -exec realpath &#123;&#125; \;可以输出绝对路径</span></span><br><span class="line">find ../ -path <span class="string">&quot;*401*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc401.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*458*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc458.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*433*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc433.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*482*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc482.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*456*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc456.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*464*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc464.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*445*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc445.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*400*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc400.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*403*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc403.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line"></span><br><span class="line">403 429 445 456 458 462 464 471 473 483</span><br><span class="line"></span><br><span class="line"><span class="comment">#vim ~/Desktop/mlta/build/lib/*.list</span></span><br><span class="line"><span class="comment">#:argdo %s/\.\.\/benchspec\//\/home\/hzlg\/Desktop\/spec2006\/benchspec\//g | update</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#:%s/\.\.\/benchspec\//\/home\/hzlg\/Desktop\/spec2006\/benchspec\//g</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get_result.sh</span></span><br><span class="line"><span class="built_in">cd</span> /home/hzlg/Desktop/mlta/build/lib</span><br><span class="line">mkdir -p result</span><br><span class="line">./kanalyzer @bc401.list 2&gt;&amp;1 | tee result/bc401.txt</span><br><span class="line">./kanalyzer @bc458.list 2&gt;&amp;1 | tee result/bc458.txt</span><br><span class="line">./kanalyzer @bc433.list 2&gt;&amp;1 | tee result/bc433.txt</span><br><span class="line">./kanalyzer @bc482.list 2&gt;&amp;1 | tee result/bc482.txt</span><br><span class="line">./kanalyzer @bc456.list 2&gt;&amp;1 | tee result/bc456.txt</span><br><span class="line">./kanalyzer @bc464.list 2&gt;&amp;1 | tee result/bc464.txt</span><br><span class="line">./kanalyzer @bc445.list 2&gt;&amp;1 | tee result/bc445.txt</span><br><span class="line">./kanalyzer @bc400.list 2&gt;&amp;1 | tee result/bc400.txt</span><br><span class="line">./kanalyzer @bc403.list 2&gt;&amp;1 | tee result/bc403.txt</span><br></pre></td></tr></table></figure>



<table>
<thead>
<tr>
<th></th>
<th>401</th>
<th>458</th>
<th>433</th>
<th>482</th>
<th>456</th>
<th>464</th>
<th>445</th>
<th>400</th>
<th>403</th>
</tr>
</thead>
<tbody><tr>
<td>Total number of final callees</td>
<td>20</td>
<td>7</td>
<td>8</td>
<td>15</td>
<td>18</td>
<td>755</td>
<td>23153</td>
<td>942</td>
<td>7712</td>
</tr>
<tr>
<td>Number of indirect calls:</td>
<td>20</td>
<td>1</td>
<td>4</td>
<td>8</td>
<td>9</td>
<td>369</td>
<td>44</td>
<td>139</td>
<td>462</td>
</tr>
<tr>
<td>Number of indirect calls with targets:</td>
<td>20</td>
<td>1</td>
<td>4</td>
<td>3</td>
<td>2</td>
<td>369</td>
<td>43</td>
<td>121</td>
<td>389</td>
</tr>
<tr>
<td>Number of indirect-call targets:</td>
<td>20</td>
<td>7</td>
<td>8</td>
<td>15</td>
<td>18</td>
<td>755</td>
<td>23153</td>
<td>942</td>
<td>7712</td>
</tr>
<tr>
<td>Number of address-taken functions</td>
<td>2</td>
<td>7</td>
<td>2</td>
<td>6</td>
<td>25</td>
<td>59</td>
<td>1787</td>
<td>739</td>
<td>1257</td>
</tr>
<tr>
<td>Number of multi-layer calls:</td>
<td>20</td>
<td>1</td>
<td>0</td>
<td>3</td>
<td>1</td>
<td>35</td>
<td>24</td>
<td>55</td>
<td>102</td>
</tr>
<tr>
<td>Number of multi-layer targets:</td>
<td>20</td>
<td>7</td>
<td>0</td>
<td>15</td>
<td>10</td>
<td>87</td>
<td>23089</td>
<td>190</td>
<td>231</td>
</tr>
<tr>
<td>Number of one-layer calls:</td>
<td>0</td>
<td>0</td>
<td>4</td>
<td>0</td>
<td>1</td>
<td>334</td>
<td>20</td>
<td>77</td>
<td>295</td>
</tr>
<tr>
<td>Number of one-layer targets:</td>
<td>0</td>
<td>0</td>
<td>8</td>
<td>0</td>
<td>8</td>
<td>668</td>
<td>64</td>
<td>752</td>
<td>7481</td>
</tr>
</tbody></table>
<p>第一步准备 bitcode，第二步跑分析器 <code>./build/lib/kalalyzer @bc.list</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Configurations</span></span><br><span class="line"></span><br><span class="line">KERNEL_SRC=<span class="string">&quot;<span class="subst">$(pwd)</span>/../kernels/linux&quot;</span></span><br><span class="line">IRDUMPER=<span class="string">&quot;<span class="subst">$(pwd)</span>/IRDumper/build/lib/libDumper.so&quot;</span></span><br><span class="line">CLANG=<span class="string">&quot;<span class="subst">$(pwd)</span>/llvm-project/prefix/bin/clang&quot;</span></span><br><span class="line">CONFIG=<span class="string">&quot;defconfig&quot;</span></span><br><span class="line"><span class="comment">#CONFIG=&quot;allyesconfig&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Use -Wno-error to avoid turning warnings into errors</span></span><br><span class="line">NEW_CMD=<span class="string">&quot;\n\n\</span></span><br><span class="line"><span class="string">KBUILD_USERCFLAGS += -Wno-error -g -Xclang -no-opaque-pointers -Xclang -flegacy-pass-manager -Xclang -load -Xclang <span class="variable">$IRDUMPER</span>\nKBUILD_CFLAGS += -Wno-error -g -Xclang -no-opaque-pointers -Xclang -flegacy-pass-manager -Xclang -load -Xclang <span class="variable">$IRDUMPER</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Back up Linux Makefile</span></span><br><span class="line"><span class="comment">#cp $KERNEL_SRC/Makefile $KERNEL_SRC/Makefile.bak</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">&quot;<span class="variable">$KERNEL_SRC</span>/Makefile.bak&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;Back up Linux Makefile first&quot;</span></span><br><span class="line">	<span class="built_in">exit</span> -1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The new flags better follow &quot;# Add user supplied CPPFLAGS, AFLAGS and CFLAGS as the last assignments&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="variable">$NEW_CMD</span> &gt;<span class="variable">$KERNEL_SRC</span>/IRDumper.cmd</span><br><span class="line">cat <span class="variable">$KERNEL_SRC</span>/Makefile.bak <span class="variable">$KERNEL_SRC</span>/IRDumper.cmd &gt;<span class="variable">$KERNEL_SRC</span>/Makefile</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$KERNEL_SRC</span> &amp;&amp; make <span class="variable">$CONFIG</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$CLANG</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$NEW_CMD</span></span><br><span class="line">make CC=<span class="variable">$CLANG</span> -j`nproc` -k -i</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>不用 irgen.sh 生成 IR 的话，自己</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/home/hzlg/Desktop/mlta/llvm-project/prefix/bin/:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line">clang++ -Wno-error -g -Xclang -no-opaque-pointers -Xclang -flegacy-pass-manager -Xclang -load -Xclang /home/hzlg/Desktop/mlta/IRDumper/build/lib/libDumper.so hello.cpp</span><br><span class="line"></span><br><span class="line">clang++ -emit-llvm -c -g -Xclang -no-opaque-pointers hello.cpp -o hello2.bc</span><br></pre></td></tr></table></figure>





<h2 id="DeepType"><a href="#DeepType" class="headerlink" title="DeepType"></a>DeepType</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -save-temps 可以保存.s .bc .o等文件，编译飞控的时候可能会报错</span></span><br><span class="line">/home/hzlg/Desktop/llvm-project/build/bin/clang++ -g -Xclang -no-opaque-pointers -save-temps hello.cpp</span><br><span class="line">./kanalyzer ../../../<span class="built_in">test</span>/hello.bc</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">clang -g -Xclang -no-opaque-pointers </span><br><span class="line">-g -Xclang -no-opaque-pointers -save-temps</span><br><span class="line"><span class="built_in">cd</span> root/of/DeepType/build/lib</span><br><span class="line">./kanalyzer filename.bc</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cp Example-linux64-amd64-gcc43+.cfg clang.cfg</span><br><span class="line">vim clang.cfg</span><br><span class="line"></span><br><span class="line">CLANGPATH = /home/hzlg/Desktop/llvm-project/build</span><br><span class="line"><span class="comment">#CC                 = /usr/bin/gcc</span></span><br><span class="line"><span class="comment">#CXX                = /usr/bin/g++</span></span><br><span class="line">CC           = <span class="variable">$&#123;CLANGPATH&#125;</span>/bin/clang</span><br><span class="line">CXX          = <span class="variable">$&#123;CLANGPATH&#125;</span>/bin/clang++</span><br><span class="line"></span><br><span class="line">400.perlbench=default=default=default:</span><br><span class="line">CPORTABILITY   = -DSPEC_CPU_LINUX_X64 -std=gnu89</span><br><span class="line"></span><br><span class="line"><span class="comment">#clang版本变了之后，401报错了，可能是因为对 void * 到 int 的转换更严格了，需要忽略警告</span></span><br><span class="line">401.bzip2=default=default=default:</span><br><span class="line">COPTIMIZE += -Wno-int-conversion -Wno-void-pointer-to-int-cast</span><br><span class="line"></span><br><span class="line">473.astar=default=default=default:</span><br><span class="line">CXXOPTIMIZE += -std=c++98</span><br><span class="line"></span><br><span class="line">483.xalancbmk=default=default=default:</span><br><span class="line">CXXOPTIMIZE += -std=c++98</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">runspec -c clang.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 400 401 403 429 445 456 458 462 464 471 473 483</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">cp clang.cfg deeptype.cfg</span><br><span class="line">vim deeptype.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment">#COPTIMIZE   = -O2 -fno-strict-aliasing</span></span><br><span class="line"><span class="comment">#CXXOPTIMIZE = -O2 -fno-strict-aliasing</span></span><br><span class="line">COPTIMIZE   = -g -Xclang -no-opaque-pointers -save-temps</span><br><span class="line">CXXOPTIMIZE = -g -Xclang -no-opaque-pointers -save-temps</span><br><span class="line"></span><br><span class="line"><span class="comment">#runspec -c deeptype.cfg -i test -noreportable -o text,screen,pdf -n 1 401</span></span><br><span class="line"><span class="comment">#runspec -c deeptype.cfg -i test -noreportable -o text,screen,pdf -n 1 458</span></span><br><span class="line"><span class="comment">#runspec -c deeptype.cfg -i test -noreportable -o text,screen,pdf -n 1 433</span></span><br><span class="line"><span class="comment">#runspec -c deeptype.cfg -i test -noreportable -o text,screen,pdf -n 1 482</span></span><br><span class="line"><span class="comment">#runspec -c deeptype.cfg -i test -noreportable -o text,screen,pdf -n 1 456</span></span><br><span class="line"><span class="comment">#runspec -c deeptype.cfg -i test -noreportable -o text,screen,pdf -n 1 464</span></span><br><span class="line"><span class="comment">#runspec -c deeptype.cfg -i test -noreportable -o text,screen,pdf -n 1 445</span></span><br><span class="line"><span class="comment">#runspec -c deeptype.cfg -i test -noreportable -o text,screen,pdf -n 1 400</span></span><br><span class="line"><span class="comment">#runspec -c deeptype.cfg -i test -noreportable -o text,screen,pdf -n 1 403</span></span><br><span class="line">thttpd</span><br><span class="line">memcached</span><br><span class="line">lighttpd</span><br><span class="line">exim</span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">#runspec -c deeptype.cfg -i ref -noreportable -o text,screen,pdf -n 3 401 458 433 482 456 464 445 400 403</span></span><br><span class="line"><span class="comment">#find ../../spec2006 -name &quot;*.bc&quot; &gt; ~/Desktop/DeepType/build/lib/bc.list</span></span><br><span class="line">runspec -c deeptype.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 401 458 433 482 456 464 445 400 403</span><br><span class="line"><span class="comment"># -exec realpath &#123;&#125; \;可以输出绝对路径</span></span><br><span class="line">find ../ -path <span class="string">&quot;*401*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc401.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*458*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc458.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*433*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc433.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*482*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc482.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*456*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc456.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*464*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc464.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*445*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc445.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*400*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc400.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*403*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc403.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line"></span><br><span class="line">403 429 445 456 458 462 464 471 473 483</span><br><span class="line"></span><br><span class="line"><span class="comment">#vim ~/Desktop/DeepType/build/lib/*.list</span></span><br><span class="line"><span class="comment">#:argdo %s/\.\.\/benchspec\//\/home\/hzlg\/Desktop\/spec2006\/benchspec\//g | update</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#:%s/\.\.\/benchspec\//\/home\/hzlg\/Desktop\/spec2006\/benchspec\//g</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get_result.sh</span></span><br><span class="line"><span class="built_in">cd</span> /home/hzlg/Desktop/DeepType/build/lib</span><br><span class="line">mkdir -p result</span><br><span class="line">./kanalyzer @bc401.list 2&gt;&amp;1 | tee result/bc401.txt</span><br><span class="line">./kanalyzer @bc458.list 2&gt;&amp;1 | tee result/bc458.txt</span><br><span class="line">./kanalyzer @bc433.list 2&gt;&amp;1 | tee result/bc433.txt</span><br><span class="line">./kanalyzer @bc482.list 2&gt;&amp;1 | tee result/bc482.txt</span><br><span class="line">./kanalyzer @bc456.list 2&gt;&amp;1 | tee result/bc456.txt</span><br><span class="line">./kanalyzer @bc464.list 2&gt;&amp;1 | tee result/bc464.txt</span><br><span class="line">./kanalyzer @bc445.list 2&gt;&amp;1 | tee result/bc445.txt</span><br><span class="line">./kanalyzer @bc400.list 2&gt;&amp;1 | tee result/bc400.txt</span><br><span class="line">./kanalyzer @bc403.list 2&gt;&amp;1 | tee result/bc403.txt</span><br></pre></td></tr></table></figure>





<table>
<thead>
<tr>
<th></th>
<th>401</th>
<th>458</th>
<th>433</th>
<th>482</th>
<th>456</th>
<th>464</th>
<th>445</th>
<th>400</th>
<th>403</th>
</tr>
</thead>
<tbody><tr>
<td>Number of indirect calls:</td>
<td>17</td>
<td>0</td>
<td>4</td>
<td>0</td>
<td>6</td>
<td>361</td>
<td>31</td>
<td>97</td>
<td>342</td>
</tr>
<tr>
<td>Number of indirect-call targets:</td>
<td>17</td>
<td>0</td>
<td>4</td>
<td>0</td>
<td>8</td>
<td>1043</td>
<td>16462</td>
<td>422</td>
<td>2213</td>
</tr>
<tr>
<td>Number of address-taken functions</td>
<td>2</td>
<td>7</td>
<td>2</td>
<td>6</td>
<td>22</td>
<td>12</td>
<td>1772</td>
<td>262</td>
<td>561</td>
</tr>
<tr>
<td>Number of 0-target i-calls:</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>5</td>
<td>2</td>
<td>0</td>
<td>13</td>
<td>131</td>
</tr>
<tr>
<td>Ave. Number of indirect-call targets:</td>
<td>1.00</td>
<td>0.00</td>
<td>1.00</td>
<td>0.00</td>
<td>8.00</td>
<td>2.91</td>
<td>531.03</td>
<td>5.02</td>
<td>10.49</td>
</tr>
<tr>
<td>stage 1（ms）</td>
<td>59</td>
<td>40</td>
<td>53</td>
<td>101</td>
<td>130</td>
<td>263</td>
<td>1269</td>
<td>695</td>
<td>2124</td>
</tr>
<tr>
<td>stage 2（ms）</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>3</td>
<td>4</td>
<td>11</td>
<td>163</td>
<td>32</td>
<td>134</td>
</tr>
<tr>
<td>total（ms）</td>
<td>61</td>
<td>41</td>
<td>54</td>
<td>104</td>
<td>134</td>
<td>275</td>
<td>1433</td>
<td>728</td>
<td>2259</td>
</tr>
</tbody></table>
<h2 id="TFA"><a href="#TFA" class="headerlink" title="TFA"></a>TFA</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">cp clang.cfg TFA.cfg</span><br><span class="line">vim TFA.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment">#COPTIMIZE   = -O2 -fno-strict-aliasing</span></span><br><span class="line"><span class="comment">#CXXOPTIMIZE = -O2 -fno-strict-aliasing</span></span><br><span class="line">COPTIMIZE   = -O0 -g -save-temps</span><br><span class="line">CXXOPTIMIZE = -O0 -g -save-temps</span><br><span class="line"></span><br><span class="line"><span class="comment">#runspec -c TFA.cfg -i test -noreportable -o text,screen,pdf -n 1 401</span></span><br><span class="line"><span class="comment">#runspec -c TFA.cfg -i test -noreportable -o text,screen,pdf -n 1 458</span></span><br><span class="line"><span class="comment">#runspec -c TFA.cfg -i test -noreportable -o text,screen,pdf -n 1 433</span></span><br><span class="line"><span class="comment">#runspec -c TFA.cfg -i test -noreportable -o text,screen,pdf -n 1 482</span></span><br><span class="line"><span class="comment">#runspec -c TFA.cfg -i test -noreportable -o text,screen,pdf -n 1 456</span></span><br><span class="line"><span class="comment">#runspec -c TFA.cfg -i test -noreportable -o text,screen,pdf -n 1 464</span></span><br><span class="line"><span class="comment">#runspec -c TFA.cfg -i test -noreportable -o text,screen,pdf -n 1 445</span></span><br><span class="line"><span class="comment">#runspec -c TFA.cfg -i test -noreportable -o text,screen,pdf -n 1 400</span></span><br><span class="line"><span class="comment">#runspec -c TFA.cfg -i test -noreportable -o text,screen,pdf -n 1 403</span></span><br><span class="line">thttpd</span><br><span class="line">memcached</span><br><span class="line">lighttpd</span><br><span class="line">exim</span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">#runspec -c TFA.cfg -i ref -noreportable -o text,screen,pdf -n 3 401 458 433 482 456 464 445 400 403</span></span><br><span class="line"><span class="comment">#find ../../spec2006 -name &quot;*.bc&quot; &gt; ~/Desktop/TFA/build/lib/bc.list</span></span><br><span class="line">runspec -c TFA.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 401 458 433 482 456 464 445 400 403</span><br><span class="line"><span class="comment">#  -exec realpath &#123;&#125; \;可以输出绝对路径</span></span><br><span class="line">find ../ -path <span class="string">&quot;*401*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/TFA-project/build/lib/bc401.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*458*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/TFA-project/build/lib/bc458.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*433*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/TFA-project/build/lib/bc433.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*482*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/TFA-project/build/lib/bc482.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*456*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/TFA-project/build/lib/bc456.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*464*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/TFA-project/build/lib/bc464.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*445*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/TFA-project/build/lib/bc445.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*400*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/TFA-project/build/lib/bc400.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*403*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/TFA-project/build/lib/bc403.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line"></span><br><span class="line">403 429 445 456 458 462 464 471 473 483</span><br><span class="line"></span><br><span class="line"><span class="comment">#vim ~/Desktop/TFA/build/lib/*.list</span></span><br><span class="line"><span class="comment">#:argdo %s/\.\.\/benchspec\//\/home\/hzlg\/Desktop\/spec2006\/benchspec\//g | update</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#:%s/\.\.\/benchspec\//\/home\/hzlg\/Desktop\/spec2006\/benchspec\//g</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get_result.sh</span></span><br><span class="line"><span class="built_in">cd</span> /home/hzlg/Desktop/TFA-project/build/lib</span><br><span class="line">mkdir -p result</span><br><span class="line">vim get_result.sh</span><br><span class="line">./analyzer @bc401.list 2&gt;&amp;1 | tee result/bc401.txt</span><br><span class="line">./analyzer @bc458.list 2&gt;&amp;1 | tee result/bc458.txt</span><br><span class="line">./analyzer @bc433.list 2&gt;&amp;1 | tee result/bc433.txt</span><br><span class="line">./analyzer @bc482.list 2&gt;&amp;1 | tee result/bc482.txt</span><br><span class="line">./analyzer @bc456.list 2&gt;&amp;1 | tee result/bc456.txt</span><br><span class="line">./analyzer @bc464.list 2&gt;&amp;1 | tee result/bc464.txt</span><br><span class="line">./analyzer @bc445.list 2&gt;&amp;1 | tee result/bc445.txt</span><br><span class="line">./analyzer @bc400.list 2&gt;&amp;1 | tee result/bc400.txt</span><br><span class="line">./analyzer @bc403.list 2&gt;&amp;1 | tee result/bc403.txt</span><br><span class="line">bash get_result.sh</span><br></pre></td></tr></table></figure>



<table>
<thead>
<tr>
<th></th>
<th>401</th>
<th>458</th>
<th>433</th>
<th>482</th>
<th>456</th>
<th>464</th>
<th>445</th>
<th>400</th>
<th>403</th>
</tr>
</thead>
<tbody><tr>
<td>Number icalls</td>
<td>20</td>
<td>1</td>
<td>4</td>
<td>8</td>
<td>9</td>
<td>369</td>
<td>17</td>
<td>139</td>
<td>462</td>
</tr>
<tr>
<td>Number total icall targets</td>
<td>20</td>
<td>7</td>
<td>8</td>
<td>15</td>
<td>18</td>
<td>739</td>
<td>20</td>
<td>2414</td>
<td>31558</td>
</tr>
</tbody></table>
<h2 id="LLVM-CFI"><a href="#LLVM-CFI" class="headerlink" title="LLVM-CFI"></a>LLVM-CFI</h2><p>clang3.7 对 483好像不行，但是没有用到483，无所谓了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">cp clang.cfg LLVMCFI.cfg</span><br><span class="line">vim LLVMCFI.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment">#COPTIMIZE   = -O2 -fno-strict-aliasing</span></span><br><span class="line"><span class="comment">#CXXOPTIMIZE = -O2 -fno-strict-aliasing</span></span><br><span class="line">COPTIMIZE   = -flto -femit-vtbl-checks -fuse-ld=gold -Wl,-plugin-opt=sd-return -save-temps</span><br><span class="line">CXXOPTIMIZE = -flto -femit-vtbl-checks -fuse-ld=gold -Wl,-plugin-opt=sd-return -save-temps</span><br><span class="line"></span><br><span class="line"><span class="comment">#runspec -a build -c hpcfi.cfg -i test -noreportable -o text,screen,pdf -n 1 401 458 433 482 456 464 445 400 403</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get_result.sh</span></span><br><span class="line">mkdir -p /home/hzlg/Desktop/LLVM-CFI/result</span><br><span class="line">rm -rf /home/hzlg/Desktop/spec2006/benchspec/CPU2006/*/build</span><br><span class="line">rm -rf /home/hzlg/Desktop/spec2006/benchspec/CPU2006/*/exe</span><br><span class="line">runspec -c LLVMCFI.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 401 2&gt;&amp;1 | tee /home/hzlg/Desktop/LLVM-CFI/result/bc401.txt</span><br><span class="line">runspec -c LLVMCFI.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 458 2&gt;&amp;1 | tee /home/hzlg/Desktop/LLVM-CFI/result/bc458.txt</span><br><span class="line">runspec -c LLVMCFI.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 433 2&gt;&amp;1 | tee /home/hzlg/Desktop/LLVM-CFI/result/bc433.txt</span><br><span class="line">runspec -c LLVMCFI.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 482 2&gt;&amp;1 | tee /home/hzlg/Desktop/LLVM-CFI/result/bc482.txt</span><br><span class="line">runspec -c LLVMCFI.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 456 2&gt;&amp;1 | tee /home/hzlg/Desktop/LLVM-CFI/result/bc456.txt</span><br><span class="line">runspec -c LLVMCFI.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 464 2&gt;&amp;1 | tee /home/hzlg/Desktop/LLVM-CFI/result/bc464.txt</span><br><span class="line">runspec -c LLVMCFI.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 445 2&gt;&amp;1 | tee /home/hzlg/Desktop/LLVM-CFI/result/bc445.txt</span><br><span class="line">runspec -c LLVMCFI.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 400 2&gt;&amp;1 | tee /home/hzlg/Desktop/LLVM-CFI/result/bc400.txt</span><br><span class="line">runspec -c LLVMCFI.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 403 2&gt;&amp;1 | tee /home/hzlg/Desktop/LLVM-CFI/result/bc403.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /home/hzlg/Desktop/LLVM-CFI/build/lib</span><br><span class="line">mkdir -p result</span><br><span class="line">./kanalyzer @bc401.list 2&gt;&amp;1 | tee result/bc401.txt</span><br><span class="line">./kanalyzer @bc458.list 2&gt;&amp;1 | tee result/bc458.txt</span><br><span class="line">./kanalyzer @bc433.list 2&gt;&amp;1 | tee result/bc433.txt</span><br><span class="line">./kanalyzer @bc482.list 2&gt;&amp;1 | tee result/bc482.txt</span><br><span class="line">./kanalyzer @bc456.list 2&gt;&amp;1 | tee result/bc456.txt</span><br><span class="line">./kanalyzer @bc464.list 2&gt;&amp;1 | tee result/bc464.txt</span><br><span class="line">./kanalyzer @bc445.list 2&gt;&amp;1 | tee result/bc445.txt</span><br><span class="line">./kanalyzer @bc400.list 2&gt;&amp;1 | tee result/bc400.txt</span><br><span class="line">./kanalyzer @bc403.list 2&gt;&amp;1 | tee result/bc403.txt</span><br></pre></td></tr></table></figure>



<table>
<thead>
<tr>
<th></th>
<th>401</th>
<th>458</th>
<th>433</th>
<th>482</th>
<th>456</th>
<th>464</th>
<th>445</th>
<th>400</th>
<th>403</th>
</tr>
</thead>
<tbody><tr>
<td>Found indirect CallSites</td>
<td>20</td>
<td>1</td>
<td>3</td>
<td>2</td>
<td>11</td>
<td>352</td>
<td>43</td>
<td>269</td>
<td>306</td>
</tr>
<tr>
<td>Total number of CallSites</td>
<td>20</td>
<td>1</td>
<td>3</td>
<td>2</td>
<td>11</td>
<td>352</td>
<td>43</td>
<td>269</td>
<td>306</td>
</tr>
</tbody></table>
<h2 id="LLVM-patched"><a href="#LLVM-patched" class="headerlink" title="LLVM-patched"></a>LLVM-patched</h2><p><a target="_blank" rel="noopener" href="https://github.com/Lqs66/llvm-16.0.4/commit/8cf494d3789348b135395b67870a112cbd03c288#diff-4501da671276f6ba33e0701455975409a1f9f303c57a2e044a632e3d30a9947fR248-R1786">Modify the type mapping logic in the IR link process · Lqs66/llvm-16.0.4@8cf494d</a></p>
<p>‎llvm/include/llvm/Linker/IRMover.h</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">runspec -c MLTA.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 401 458 433 482 456 464 445 400 403</span><br><span class="line"></span><br><span class="line">find ../ -path <span class="string">&quot;*401*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc401_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*458*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc458_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*433*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc433_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*482*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc482_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*456*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc456_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*464*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc464_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*445*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc445_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*400*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc400_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*403*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc403_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line"></span><br><span class="line"><span class="comment"># get_result_p.sh</span></span><br><span class="line"><span class="built_in">cd</span> /home/hzlg/Desktop/mlta/build/lib</span><br><span class="line">mkdir -p result</span><br><span class="line">./kanalyzer @bc401.list 2&gt;&amp;1 | tee result/bc401_p.txt</span><br><span class="line">./kanalyzer @bc458.list 2&gt;&amp;1 | tee result/bc458_p.txt</span><br><span class="line">./kanalyzer @bc433.list 2&gt;&amp;1 | tee result/bc433_p.txt</span><br><span class="line">./kanalyzer @bc482.list 2&gt;&amp;1 | tee result/bc482_p.txt</span><br><span class="line">./kanalyzer @bc456.list 2&gt;&amp;1 | tee result/bc456_p.txt</span><br><span class="line">./kanalyzer @bc464.list 2&gt;&amp;1 | tee result/bc464_p.txt</span><br><span class="line">./kanalyzer @bc445.list 2&gt;&amp;1 | tee result/bc445_p.txt</span><br><span class="line">./kanalyzer @bc400.list 2&gt;&amp;1 | tee result/bc400_p.txt</span><br><span class="line">./kanalyzer @bc403.list 2&gt;&amp;1 | tee result/bc403_p.txt</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">runspec -c deeptype.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 401 458 433 482 456 464 445 400 403</span><br><span class="line"></span><br><span class="line">find ../ -path <span class="string">&quot;*401*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc401_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*458*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc458_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*433*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc433_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*482*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc482_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*456*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc456_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*464*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc464_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*445*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc445_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*400*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc400_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line">find ../ -path <span class="string">&quot;*403*&quot;</span> -name <span class="string">&quot;*bc&quot;</span> &gt; ~/Desktop/DeepType/build/lib/bc403_p.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line"></span><br><span class="line"><span class="comment"># get_result_p.sh</span></span><br><span class="line"><span class="built_in">cd</span> /home/hzlg/Desktop/DeepType/build/lib</span><br><span class="line">mkdir -p result</span><br><span class="line">./kanalyzer @bc401.list 2&gt;&amp;1 | tee result/bc401_p.txt</span><br><span class="line">./kanalyzer @bc458.list 2&gt;&amp;1 | tee result/bc458_p.txt</span><br><span class="line">./kanalyzer @bc433.list 2&gt;&amp;1 | tee result/bc433_p.txt</span><br><span class="line">./kanalyzer @bc482.list 2&gt;&amp;1 | tee result/bc482_p.txt</span><br><span class="line">./kanalyzer @bc456.list 2&gt;&amp;1 | tee result/bc456_p.txt</span><br><span class="line">./kanalyzer @bc464.list 2&gt;&amp;1 | tee result/bc464_p.txt</span><br><span class="line">./kanalyzer @bc445.list 2&gt;&amp;1 | tee result/bc445_p.txt</span><br><span class="line">./kanalyzer @bc400.list 2&gt;&amp;1 | tee result/bc400_p.txt</span><br><span class="line">./kanalyzer @bc403.list 2&gt;&amp;1 | tee result/bc403_p.txt</span><br></pre></td></tr></table></figure>





<h2 id="HPCFI"><a href="#HPCFI" class="headerlink" title="HPCFI"></a>HPCFI</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hpcfi-llvm-project/build/bin/clang -g -c -O1 -flto -flegacy-pass-manager -Xclang -load -Xclang hpcfi-llvm-project/build/lib/LLVMMLTA.so main.c -o main.o</span><br><span class="line"></span><br><span class="line">hpcfi-llvm-project/build/bin/clang -g -O1 -flto -flegacy-pass-manager -fuse-ld=lld -Wl,-plugin-opt=-load=hpcfi-svf/Release-build/lib/LLVMSvf.so,-plugin-opt=-load=hpcfi-llvm-project/build/lib/LLVMHPCFICmp.so main.o -o main</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">cp clang.cfg hpcfi.cfg</span><br><span class="line">vim hpcfi.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment">#COPTIMIZE   = -O2 -fno-strict-aliasing</span></span><br><span class="line"><span class="comment">#CXXOPTIMIZE = -O2 -fno-strict-aliasing</span></span><br><span class="line">COPTIMIZE   = -g -O1 -flto -flegacy-pass-manager \</span><br><span class="line">    -Xclang -load -Xclang /home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMMLTA.so \</span><br><span class="line">    -fuse-ld=lld \</span><br><span class="line">    -Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-svf/Release-build/lib/LLVMSvf.so \</span><br><span class="line">    -Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMHPCFICmp.so</span><br><span class="line"></span><br><span class="line">CXXOPTIMIZE =  -g -O1 -flto -flegacy-pass-manager \</span><br><span class="line">    -Xclang -load -Xclang /home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMMLTA.so \</span><br><span class="line">    -fuse-ld=lld \</span><br><span class="line">    -Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-svf/Release-build/lib/LLVMSvf.so \</span><br><span class="line">    -Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMHPCFICmp.so</span><br><span class="line"></span><br><span class="line"><span class="comment">#runspec -a build -c hpcfi.cfg -i test -noreportable -o text,screen,pdf -n 1 401 458 433 482 456 464 445 400 403</span></span><br><span class="line">mkdir -p /home/hzlg/Desktop/hpcfi/result</span><br><span class="line">runspec -c hpcfi.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 401 2&gt;&amp;1 | tee /home/hzlg/Desktop/hpcfi/result/bc401.txt</span><br><span class="line">runspec -c hpcfi.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 458 2&gt;&amp;1 | tee /home/hzlg/Desktop/hpcfi/result/bc458.txt</span><br><span class="line">runspec -c hpcfi.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 433 2&gt;&amp;1 | tee /home/hzlg/Desktop/hpcfi/result/bc433.txt</span><br><span class="line">runspec -c hpcfi.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 482 2&gt;&amp;1 | tee /home/hzlg/Desktop/hpcfi/result/bc482.txt</span><br><span class="line">runspec -c hpcfi.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 456 2&gt;&amp;1 | tee /home/hzlg/Desktop/hpcfi/result/bc456.txt</span><br><span class="line">runspec -c hpcfi.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 464 2&gt;&amp;1 | tee /home/hzlg/Desktop/hpcfi/result/bc464.txt</span><br><span class="line">runspec -c hpcfi.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 445 2&gt;&amp;1 | tee /home/hzlg/Desktop/hpcfi/result/bc445.txt</span><br><span class="line">runspec -c hpcfi.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 400 2&gt;&amp;1 | tee /home/hzlg/Desktop/hpcfi/result/bc400.txt</span><br><span class="line">runspec -c hpcfi.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 403 2&gt;&amp;1 | tee /home/hzlg/Desktop/hpcfi/result/bc403.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<table>
<thead>
<tr>
<th></th>
<th>401</th>
<th>458</th>
<th>433</th>
<th>482</th>
<th>456</th>
<th>464</th>
<th>445</th>
<th>400</th>
<th>403</th>
</tr>
</thead>
<tbody><tr>
<td>TotalCallSite</td>
<td>488</td>
<td>1431</td>
<td>1623</td>
<td>2427</td>
<td>2712</td>
<td>3914</td>
<td>11513</td>
<td>16244</td>
<td>52967</td>
</tr>
<tr>
<td>IndCallSites</td>
<td>20</td>
<td>1</td>
<td>4</td>
<td>2</td>
<td>9</td>
<td>351</td>
<td>43</td>
<td>137</td>
<td>435</td>
</tr>
<tr>
<td>IndCall targets</td>
<td>20</td>
<td>7</td>
<td>8</td>
<td>10</td>
<td>18</td>
<td>715</td>
<td>23151</td>
<td>2624</td>
<td>2497</td>
</tr>
</tbody></table>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="keyword">int</span>&gt; TCs = &#123;</span><br><span class="line">    <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(Targets.<span class="built_in">size</span>()),             <span class="comment">// 1. 所有可能的间接调用目标数</span></span><br><span class="line">    <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(TargetsSVFType.<span class="built_in">size</span>()),      <span class="comment">// 2. SVF 类型分析推导出的目标数</span></span><br><span class="line">    <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(TargetsSVF.<span class="built_in">size</span>()),          <span class="comment">// 3. SVF 直接推导出的目标数</span></span><br><span class="line">    <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(CanUseMlta ? TargetsMLTA-&gt;<span class="built_in">size</span>() : TargetsSameType.<span class="built_in">size</span>()), </span><br><span class="line">                                                 <span class="comment">// 4. MLTA 或相同类型目标数</span></span><br><span class="line">    <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(TargetsSameType.<span class="built_in">size</span>())      <span class="comment">// 5. 仅基于类型推导出的目标数</span></span><br><span class="line">&#125;;</span><br><span class="line">Targets.<span class="built_in">size</span>() = <span class="number">10</span>（最终可用目标）</span><br><span class="line">TargetsSVFType.<span class="built_in">size</span>() = <span class="number">10</span>（SVF + TYPE 交集）</span><br><span class="line">TargetsSVF.<span class="built_in">size</span>() = <span class="number">10</span>（SVF 识别的目标）</span><br><span class="line">TargetsMLTA-&gt;<span class="built_in">size</span>() = <span class="number">11</span>（MLTA 识别的目标）</span><br><span class="line">TargetsSameType.<span class="built_in">size</span>() = <span class="number">11</span>（类型分析识别的目标）</span><br><span class="line">    </span><br><span class="line">TargetsSVF：SVF 分析得到的目标函数。</span><br><span class="line">TargetsSameType：基于类型分析得到的目标函数。</span><br><span class="line">TargetsMLTA：MLTA 得到的目标函数（可能为空）。</span><br><span class="line">   </span><br><span class="line">TargetsSVFType 是 SVF 和 TYPE 的交集：</span><br><span class="line">只有 同时被 SVF 和 Type-based 认为是目标 的函数才会进入 TargetsSVFType。</span><br><span class="line">这个集合是 SVF+Type 更严格的交集，用于提高准确性。</span><br><span class="line">    </span><br><span class="line">TargetsUnion 是 SVF + TYPE + MLTA 的并集，用于后续打印。</span><br><span class="line"></span><br><span class="line">如果当前 CallBase 不包含 BlackHole（不可达函数），则使用 TargetsSVFType（SVF+TYPE 交集）。</span><br><span class="line">否则，回退到 TargetsSameType，即只基于类型推导目标。</span><br><span class="line"></span><br><span class="line">如果 MLTA 可用，最终目标函数 Targets 只保留 MLTA 也认可的目标。</span><br><span class="line">MLTA 进一步约束 Targets，提高分析精度。</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line">*********General Stats***************</span><br><span class="line">################ (program : ld-temp.o)###############</span><br><span class="line">BBWith3Succ         867</span><br><span class="line">AddrsNum            7987</span><br><span class="line">TotalFieldObjects   258</span><br><span class="line">LocalVarInRecur     315</span><br><span class="line">FSObjNum            2370</span><br><span class="line">TotalPTASVFStmts    108334</span><br><span class="line">GepsNum             33107</span><br><span class="line">FIObjNum            955</span><br><span class="line">LoadsNum            39794</span><br><span class="line">MaxStructSize       40</span><br><span class="line">TotalCallSite       16244</span><br><span class="line">TotalSVFStmts       232806</span><br><span class="line">TotalPointers       256179</span><br><span class="line">ReturnsNum          8366</span><br><span class="line">VarArrayObj         148</span><br><span class="line">CopysNum            15243</span><br><span class="line">ConstArrayObj       24</span><br><span class="line">CallsNum            24815</span><br><span class="line">TotalObjects        3326</span><br><span class="line">FunctionObjs        1804</span><br><span class="line">GlobalObjs          490</span><br><span class="line">HeapObjs            254</span><br><span class="line">StackObjs           776</span><br><span class="line">ConstStructObj      39</span><br><span class="line">VarStructObj        107</span><br><span class="line">NonPtrObj           2626</span><br><span class="line">ConstantObj         0</span><br><span class="line">IndCallSites        137</span><br><span class="line">StoresNum           16055</span><br><span class="line">BBWith2Succ         21093</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">#######################################################</span><br><span class="line"></span><br><span class="line">*********Constraint Graph Stats***************</span><br><span class="line">################ (program : ld-temp.o)###############</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">AvgIn/OutEdge       1.5176</span><br><span class="line">AvgIn/OutAddrEdge   0.0898556</span><br><span class="line">AvgIn/OutLoadEdge   0.307963</span><br><span class="line">AvgIn/OutCopyEdge   1.03949</span><br><span class="line">MaxInAddrEdge       1</span><br><span class="line">MaxOutStoreEdge     1612</span><br><span class="line">NumOfCGNode         245339</span><br><span class="line">TotalValidNode      70502</span><br><span class="line">AvgIn/OutStoreEdge  0</span><br><span class="line">TotalValidObjNode   3116</span><br><span class="line">NumOfGeps           30237</span><br><span class="line">NumOfCGEdge         100659</span><br><span class="line">NumOfAddrs          6335</span><br><span class="line">MaxOutAddrEdge      3267</span><br><span class="line">NumOfLoads          21712</span><br><span class="line">NumOfStores         5661</span><br><span class="line">MaxOutLoadEdge      733</span><br><span class="line">NumOfCopys          43049</span><br><span class="line">MaxOutCopyEdge      23410</span><br><span class="line">MaxInStoreEdge      352</span><br><span class="line">MaxInLoadEdge       3784</span><br><span class="line">MaxInCopyEdge       1699</span><br><span class="line">#######################################################</span><br><span class="line"></span><br><span class="line">*********Andersen Pointer Analysis Stats***************</span><br><span class="line">################ (program : ld-temp.o)###############</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">AvgTopLvlPtsSize    669.014</span><br><span class="line">AvgPtsSetSize       216.529</span><br><span class="line">LoadStoreTime       0</span><br><span class="line">CollapseTime        0</span><br><span class="line">UpdateCGTime        0</span><br><span class="line">CopyGepTime         0</span><br><span class="line">SCCMergeTime        0</span><br><span class="line">SCCDetectTime       0</span><br><span class="line">TotalTime           41.317</span><br><span class="line">NullPointer         376</span><br><span class="line">PointsToBlkPtr      0</span><br><span class="line">TotalPWCCycleNum    526</span><br><span class="line">IndEdgeSolved       6601</span><br><span class="line">TotalCycleNum       611</span><br><span class="line">IndCallSites        137</span><br><span class="line">PointsToConstPtr    26173</span><br><span class="line">MaxPtsSetSize       1167</span><br><span class="line">DYFieldObjs         258</span><br><span class="line">MemObjects          3326</span><br><span class="line">Pointers            255779</span><br><span class="line">NumOfFieldExpand    0</span><br><span class="line">DYFieldPtrs         400</span><br><span class="line">NumOfSFRs           0</span><br><span class="line">GepProcessed        161552</span><br><span class="line">LoadProcessed       10683306</span><br><span class="line">CopyProcessed       322500</span><br><span class="line">MaxNodesInSCC       1804</span><br><span class="line">Iterations          16</span><br><span class="line">StoreProcessed      1389257</span><br><span class="line">AddrProcessed       6591</span><br><span class="line">NumOfSCCDetect      16</span><br><span class="line">TotalObjects        3584</span><br><span class="line">NodesInCycles       4870</span><br><span class="line">TotalPointers       256179</span><br><span class="line">#######################################################</span><br><span class="line">****Persistent Points-To Cache Statistics: bv-finalize****</span><br><span class="line">UniquePointsToSets       6479</span><br><span class="line">TotalUnions              518071</span><br><span class="line">PropertyUnions           258353</span><br><span class="line">UniqueUnions             3110</span><br><span class="line">LookupUnions             251088</span><br><span class="line">PreemptiveUnions         5520</span><br><span class="line">TotalComplements         3969706</span><br><span class="line">PropertyComplements      3739872</span><br><span class="line">UniqueComplements        1079</span><br><span class="line">LookupComplements        227676</span><br><span class="line">PreemptiveComplements    1079</span><br><span class="line">TotalIntersections       331037</span><br><span class="line">PropertyIntersections    328845</span><br><span class="line">UniqueIntersections      19</span><br><span class="line">LookupIntersections      11</span><br><span class="line">PreemptiveIntersections  2162</span><br><span class="line"></span><br><span class="line">****Memory SSA Statistics****</span><br><span class="line"></span><br><span class="line">************************</span><br><span class="line">################ (program : ld-temp.o)###############</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">AverageRegSize      93.1434</span><br><span class="line">SSARenameTime       0.18</span><br><span class="line">InsertPHITime       0.367</span><br><span class="line">GenMUCHITime        1.552</span><br><span class="line">GenRegionTime       32.075</span><br><span class="line">TotalMSSATime       34.249</span><br><span class="line">BBHasMSSAPhi        7716</span><br><span class="line">StoreHasChi         6445</span><br><span class="line">MaxRegSize          914</span><br><span class="line">MemRegions          1304</span><br><span class="line">FunHasRetMu         1656</span><br><span class="line">FunEntryChi         11246</span><br><span class="line">StoreChiNode        12737</span><br><span class="line">LoadMuNode          72009</span><br><span class="line">MSSAPhi             67515</span><br><span class="line">LoadHasMu           23592</span><br><span class="line">CSChiNode           118011</span><br><span class="line">CSMuNode            145114</span><br><span class="line">CSHasChi            12385</span><br><span class="line">FunRetMu            11085</span><br><span class="line">FunHasEntryChi      1577</span><br><span class="line">CSHasMu             12693</span><br><span class="line">#######################################################</span><br><span class="line"></span><br><span class="line">****SVFG Statistics****</span><br><span class="line"></span><br><span class="line">************************</span><br><span class="line">################ (program : ld-temp.o)###############</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">AvgWeight           61.5212</span><br><span class="line">OptTime             0</span><br><span class="line">ATNodeTime          1.465</span><br><span class="line">TLNodeTime          0</span><br><span class="line">ConnDirEdgeTime     0</span><br><span class="line">ConnIndEdgeTime     4.525</span><br><span class="line">TotalTime           5.99</span><br><span class="line">MaxIndOutDeg        4994</span><br><span class="line">AvgIndOutDeg        2</span><br><span class="line">Addr                6591</span><br><span class="line">ActualOut           118011</span><br><span class="line">ActualRet           5485</span><br><span class="line">Copy                7086</span><br><span class="line">ActualParam         20127</span><br><span class="line">FormalRet           787</span><br><span class="line">ActualIn            145114</span><br><span class="line">Gep                 33107</span><br><span class="line">FormalParam         1880</span><br><span class="line">TotalNode           467243</span><br><span class="line">MaxOutDegree        4994</span><br><span class="line">MSSAPhi             67515</span><br><span class="line">FormalOut           11085</span><br><span class="line">FormalIn            11246</span><br><span class="line">IndRetEdge          129399</span><br><span class="line">Store               8834</span><br><span class="line">Load                23592</span><br><span class="line">MaxIndInDeg         4994</span><br><span class="line">IndCallEdge         164378</span><br><span class="line">PHI                 6782</span><br><span class="line">DirectCallEdge      16879</span><br><span class="line">DirectEdge          139454</span><br><span class="line">IndirectEdge        711133</span><br><span class="line">DirectRetEdge       5449</span><br><span class="line">AvgInDegree         1</span><br><span class="line">IndirectEdgeLabels  43749739</span><br><span class="line">AvgOutDegree        1</span><br><span class="line">TotalEdge           850587</span><br><span class="line">MaxInDegree         4994</span><br><span class="line">AvgIndInDeg         1</span><br><span class="line">#######################################################</span><br><span class="line">#functions: 1804</span><br><span class="line">#affunctions: 954</span><br><span class="line">ind call:   %87 = call %struct.op.98* %86() #40, !dbg !20089, !is_icall !17049, !mlta_info !20092</span><br><span class="line">filename: dump.c | 1452,23 | *** 348 *** 348 *** 348 *** 352 *** 352</span><br></pre></td></tr></table></figure>



<h1 id="ArduPilot-4-3-0"><a href="#ArduPilot-4-3-0" class="headerlink" title="ArduPilot 4.3.0"></a>ArduPilot 4.3.0</h1><blockquote>
<p><code>-flto</code>: 启用链接时优化（Link Time Optimization），可以跨文件优化。</p>
<p><code>-fno-discard-value-names</code>: 保留中间表示中的变量名（LLVM IR 中的变量名），便于后续工具分析，比如 TFA 或 HPCFI。</p>
<p><code>-fembed-bitcode</code>: 在目标文件中嵌入 LLVM bitcode，方便后续 LLVM 工具链处理。</p>
<p><code>-fwhole-program-vtables</code>: 让 vtable 更早可见于优化阶段，对一些安全工具有用。</p>
<p><code>-fuse-ld=ld.lld</code>: 使用 LLVM 的 LLD 链接器，通常和 <code>-flto</code> 一起用更快更稳定。</p>
</blockquote>
<h2 id="MLTA-1"><a href="#MLTA-1" class="headerlink" title="MLTA"></a>MLTA</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/ArduPilot/ardupilot.git</span><br><span class="line"><span class="built_in">cd</span> ardupilot</span><br><span class="line">git checkout Copter-4.3.0</span><br><span class="line">git submodule update --init --recursive --force</span><br><span class="line">./Tools/environment_install/install-prereqs-ubuntu.sh</span><br><span class="line"></span><br><span class="line">./waf clean</span><br><span class="line"><span class="built_in">export</span> PREFIX=<span class="string">&quot;/home/hzlg/Desktop/mlta/llvm-project/prefix&quot;</span></span><br><span class="line"><span class="built_in">export</span> CC=<span class="string">&quot;<span class="variable">$PREFIX</span>/bin/clang -Wno-error -g -Xclang -no-opaque-pointers -Xclang -flegacy-pass-manager -Xclang -load -Xclang /home/hzlg/Desktop/mlta/IRDumper/build/lib/libDumper.so&quot;</span></span><br><span class="line"><span class="built_in">export</span> CXX=<span class="string">&quot;<span class="variable">$PREFIX</span>/bin/clang++ -Wno-error -g -Xclang -no-opaque-pointers -Xclang -flegacy-pass-manager -Xclang -load -Xclang /home/hzlg/Desktop/mlta/IRDumper/build/lib/libDumper.so&quot;</span></span><br><span class="line">CC=<span class="variable">$CC</span> CXX=<span class="variable">$CXX</span> ./waf configure --board=sitl</span><br><span class="line">./waf copter -v</span><br><span class="line"></span><br><span class="line">find ./ -name <span class="string">&quot;*.bc&quot;</span> &gt; ~/Desktop/mlta/build/lib/bc_ardupilot.list -<span class="built_in">exec</span> realpath &#123;&#125; \;</span><br><span class="line"><span class="built_in">cd</span> /home/hzlg/Desktop/mlta/build/lib</span><br><span class="line">mkdir -p result</span><br><span class="line">./kanalyzer @bc_ardupilot.list 2&gt;&amp;1 | tee result/bc_ardupilot.txt</span><br></pre></td></tr></table></figure>



<h2 id="Deeptype"><a href="#Deeptype" class="headerlink" title="Deeptype"></a>Deeptype</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -save-temps 可以保存.s .bc .o等文件</span></span><br><span class="line">/home/hzlg/Desktop/llvm-project/build/bin/clang++ -g -Xclang -no-opaque-pointers -save-temps hello.cpp</span><br><span class="line">./kanalyzer ../../../<span class="built_in">test</span>/hello.bc</span><br></pre></td></tr></table></figure>



<p>/home/hzlg/Desktop/llvm-project/build/bin/clang++ -g -Xclang -no-opaque-pointers -save-temps hello.cpp</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/ArduPilot/ardupilot.git</span><br><span class="line"><span class="built_in">cd</span> ardupilot</span><br><span class="line">git checkout Copter-4.3.0</span><br><span class="line">git submodule update --init --recursive --force</span><br><span class="line">./Tools/environment_install/install-prereqs-ubuntu.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># -save-temps会有问题，用森哥的方法生成ll和bc，再去分析</span><br><span class="line"># 修改ardupilot文件夹下的wscript文件，在<span class="function">def <span class="title">configure</span><span class="params">(cfg)</span>函数中添加如下代码:</span></span><br><span class="line"><span class="function"># 添加在以下代码下面</span></span><br><span class="line"><span class="function"># cfg.env.CXXFLAGS +=</span> [<span class="string">&#x27;-include&#x27;</span>, <span class="string">&#x27;ap_config.h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta"># llvm ir</span></span><br><span class="line">    cfg.env.<span class="built_in">prepend_value</span>(<span class="string">&#x27;CFLAGS&#x27;</span>, [<span class="string">&#x27;-flto&#x27;</span>,<span class="string">&#x27;-g&#x27;</span>,<span class="string">&#x27;-Xclang&#x27;</span>,<span class="string">&#x27;-no-opaque-pointers&#x27;</span>])</span><br><span class="line">    cfg.env.<span class="built_in">prepend_value</span>(<span class="string">&#x27;CFLAGS&#x27;</span>, [<span class="string">&#x27;-flto&#x27;</span>])</span><br><span class="line">    cfg.env.<span class="built_in">prepend_value</span>(<span class="string">&#x27;CFLAGS&#x27;</span>, [<span class="string">&#x27;-fno-discard-value-names&#x27;</span>,<span class="string">&#x27;-fembed-bitcode&#x27;</span>,<span class="string">&#x27;-fno-jump-tables&#x27;</span>])</span><br><span class="line">        </span><br><span class="line">    cfg.env.<span class="built_in">prepend_value</span>(<span class="string">&#x27;CXXFLAGS&#x27;</span>, [<span class="string">&#x27;-flto&#x27;</span>,<span class="string">&#x27;-g&#x27;</span>,<span class="string">&#x27;-Xclang&#x27;</span>,<span class="string">&#x27;-no-opaque-pointers&#x27;</span>])</span><br><span class="line">    cfg.env.<span class="built_in">prepend_value</span>(<span class="string">&#x27;CXXFLAGS&#x27;</span>, [<span class="string">&#x27;-flto&#x27;</span>])</span><br><span class="line">    cfg.env.<span class="built_in">prepend_value</span>(<span class="string">&#x27;CXXFLAGS&#x27;</span>, [<span class="string">&#x27;-fno-discard-value-names&#x27;</span>,<span class="string">&#x27;-fembed-bitcode&#x27;</span>,<span class="string">&#x27;-fwhole-program-vtables&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    cfg.env.<span class="built_in">prepend_value</span>(<span class="string">&#x27;LINKFLAGS&#x27;</span>,<span class="string">&#x27;-flto&#x27;</span>)</span><br><span class="line">    cfg.env.<span class="built_in">prepend_value</span>(<span class="string">&#x27;LINKFLAGS&#x27;</span>,<span class="string">&#x27;-fuse-ld=ld.lld&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#./waf clean</span></span><br><span class="line"><span class="built_in">export</span> PREFIX=<span class="string">&quot;/home/hzlg/Desktop/llvm-project/build&quot;</span></span><br><span class="line"><span class="built_in">export</span> CC=<span class="string">&quot;<span class="variable">$PREFIX</span>/bin/clang&quot;</span></span><br><span class="line"><span class="built_in">export</span> CXX=<span class="string">&quot;<span class="variable">$PREFIX</span>/bin/clang++&quot;</span></span><br><span class="line"><span class="built_in">export</span> CFLAGS=<span class="string">&quot;-O0 -g  -Xclang -no-opaque-pointers&quot;</span>  </span><br><span class="line"><span class="built_in">export</span> CXXFLAGS=<span class="string">&quot;-O0 -g  -Xclang -no-opaque-pointers&quot;</span> </span><br><span class="line"><span class="built_in">export</span> LDFLAGS=<span class="string">&quot;-fuse-ld=<span class="variable">$PREFIX</span>/bin/ld.lld&quot;</span></span><br><span class="line">CC=<span class="variable">$CC</span> CXX=<span class="variable">$CXX</span> CFLAGS=<span class="variable">$CFLAGS</span> CXXFLAGS=<span class="variable">$CXXFLAGS</span> LDFLAGS=<span class="variable">$LDFLAGS</span> ./waf configure --board=sitl</span><br><span class="line"></span><br><span class="line">./waf copter -v</span><br><span class="line"></span><br><span class="line"><span class="comment">#cd [构建文件夹]</span></span><br><span class="line"><span class="built_in">cd</span> /home/hzlg/Desktop/ardupilot/build/sitl/</span><br><span class="line"></span><br><span class="line"><span class="comment"># [path]替换为你的路径</span></span><br><span class="line">/home/hzlg/Desktop/llvm-project/build/bin/llvm-ar -s lib/libArduCopter_libs.a</span><br><span class="line"></span><br><span class="line">/home/hzlg/Desktop/llvm-project/build/bin/clang++ -Wl,-plugin-opt=no-opaque-pointers -Wl,--export-dynamic -fuse-ld=lld -flto -Wl,--plugin-opt=emit-llvm -Wl,--lto-whole-program-visibility ArduCopter/*.o -Llib -lArduCopter_libs -o arducopter.bc</span><br><span class="line"></span><br><span class="line">llvm-dis arducopter.bc</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /home/hzlg/Desktop/DeepType/build/lib</span><br><span class="line">mkdir -p result</span><br><span class="line">./kanalyzer /home/hzlg/Desktop/ardupilot/build/sitl/arducopter.bc 2&gt;&amp;1 | tee result/bc_ardupilot.txt</span><br></pre></td></tr></table></figure>



<h2 id="HPCFI-1"><a href="#HPCFI-1" class="headerlink" title="HPCFI"></a>HPCFI</h2><blockquote>
<img src="/2025/02/26/%E4%BE%8B%E7%A8%8B/image-20250413234807447.png" alt="image-20250413234807447" style="zoom:50%;"> 

<p>1</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/ArduPilot/ardupilot.git</span><br><span class="line"><span class="built_in">cd</span> ardupilot</span><br><span class="line">git checkout Copter-4.3.0</span><br><span class="line">git submodule update --init --recursive --force</span><br><span class="line">./Tools/environment_install/install-prereqs-ubuntu.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cfg.env.prepend_value(<span class="string">&#x27;CFLAGS&#x27;</span>, [<span class="string">&#x27;-flto&#x27;</span>])</span><br><span class="line">    cfg.env.prepend_value(<span class="string">&#x27;CFLAGS&#x27;</span>, [<span class="string">&#x27;-fno-discard-value-names&#x27;</span>,<span class="string">&#x27;-fembed-bitcode&#x27;</span>])</span><br><span class="line">    cfg.env.prepend_value(<span class="string">&#x27;CXXFLAGS&#x27;</span>, [<span class="string">&#x27;-flto&#x27;</span>])</span><br><span class="line">    cfg.env.prepend_value(<span class="string">&#x27;CXXFLAGS&#x27;</span>, [<span class="string">&#x27;-fno-discard-value-names&#x27;</span>,<span class="string">&#x27;-fembed-bitcode&#x27;</span>])</span><br><span class="line">    cfg.env.prepend_value(<span class="string">&#x27;LINKFLAGS&#x27;</span>, [<span class="string">&#x27;-flto&#x27;</span>, <span class="string">&#x27;-fuse-ld=lld&#x27;</span>])</span><br><span class="line">    </span><br><span class="line">    cfg.env.prepend_value(<span class="string">&#x27;CFLAGS&#x27;</span>, [<span class="string">&#x27;-g&#x27;</span>, <span class="string">&#x27;-O1&#x27;</span>, <span class="string">&#x27;-flto&#x27;</span>, <span class="string">&#x27;-flegacy-pass-manager&#x27;</span>, <span class="string">&#x27;-Xclang&#x27;</span>, <span class="string">&#x27;-load&#x27;</span>, <span class="string">&#x27;-Xclang&#x27;</span>, <span class="string">&#x27;/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMMLTA.so&#x27;</span>])</span><br><span class="line">    cfg.env.prepend_value(<span class="string">&#x27;CXXFLAGS&#x27;</span>, [<span class="string">&#x27;-g&#x27;</span>, <span class="string">&#x27;-O1&#x27;</span>, <span class="string">&#x27;-flto&#x27;</span>, <span class="string">&#x27;-flegacy-pass-manager&#x27;</span>, <span class="string">&#x27;-Xclang&#x27;</span>, <span class="string">&#x27;-load&#x27;</span>, <span class="string">&#x27;-Xclang&#x27;</span>, <span class="string">&#x27;/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMMLTA.so&#x27;</span>])</span><br><span class="line">    cfg.env.prepend_value(<span class="string">&#x27;LINKFLAGS&#x27;</span>, [<span class="string">&#x27;-g&#x27;</span>, <span class="string">&#x27;-O1&#x27;</span>, <span class="string">&#x27;-flto&#x27;</span>, <span class="string">&#x27;-flegacy-pass-manager&#x27;</span>, <span class="string">&#x27;-fuse-ld=lld&#x27;</span>, <span class="string">&#x27;-Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-svf/Release-build/lib/LLVMSvf.so&#x27;</span>,<span class="string">&#x27;-Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMHPCFICmp.so&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    cfg.env.prepend_value(<span class="string">&#x27;CFLAGS&#x27;</span>, [<span class="string">&#x27;-g&#x27;</span>, <span class="string">&#x27;-O1&#x27;</span>, <span class="string">&#x27;-flto&#x27;</span>, <span class="string">&#x27;-flegacy-pass-manager&#x27;</span>, <span class="string">&#x27;-Xclang&#x27;</span>, <span class="string">&#x27;-load&#x27;</span>, <span class="string">&#x27;-Xclang&#x27;</span>, <span class="string">&#x27;/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMMLTA.so&#x27;</span>])</span><br><span class="line">    cfg.env.prepend_value(<span class="string">&#x27;CXXFLAGS&#x27;</span>, [<span class="string">&#x27;-g&#x27;</span>, <span class="string">&#x27;-O1&#x27;</span>, <span class="string">&#x27;-flto&#x27;</span>, <span class="string">&#x27;-flegacy-pass-manager&#x27;</span>, <span class="string">&#x27;-Xclang&#x27;</span>, <span class="string">&#x27;-load&#x27;</span>, <span class="string">&#x27;-Xclang&#x27;</span>, <span class="string">&#x27;/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMMLTA.so&#x27;</span>])</span><br><span class="line">    cfg.env.prepend_value(<span class="string">&#x27;LINKFLAGS&#x27;</span>, [<span class="string">&#x27;-g&#x27;</span>, <span class="string">&#x27;-O1&#x27;</span>, <span class="string">&#x27;-flto&#x27;</span>, <span class="string">&#x27;-flegacy-pass-manager&#x27;</span>, <span class="string">&#x27;-fuse-ld=lld&#x27;</span>, <span class="string">&#x27;-Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-svf/Release-build/lib/LLVMSvf.so&#x27;</span>,<span class="string">&#x27;-Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMHPCFICmp.so&#x27;</span>])</span><br><span class="line">    </span><br><span class="line"><span class="comment">#./waf clean</span></span><br><span class="line"><span class="comment">#CXXOPTIMIZE =  -g -O1 -flto -flegacy-pass-manager \</span></span><br><span class="line"><span class="comment">#    -Xclang -load -Xclang /home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMMLTA.so \</span></span><br><span class="line"><span class="comment">#    -fuse-ld=lld \</span></span><br><span class="line"><span class="comment">#    -Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-svf/Release-build/lib/LLVMSvf.so \</span></span><br><span class="line"><span class="comment">#    -Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMHPCFICmp.so</span></span><br><span class="line"><span class="comment">#export PREFIX=&quot;hpcfi-llvm-project/build&quot;</span></span><br><span class="line"><span class="comment">#export CC=&quot;$PREFIX/bin/clang -g -O1 -flto -flegacy-pass-manager -Xclang -load -Xclang /home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMMLTA.so -fuse-ld=lld -Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-svf/Release-build/lib/LLVMSvf.so -Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMHPCFICmp.so&quot;</span></span><br><span class="line"><span class="comment">#export CXX=&quot;$PREFIX/bin/clang++ -g -O1 -flto -flegacy-pass-manager -Xclang -load -Xclang /home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMMLTA.so -fuse-ld=lld -Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-svf/Release-build/lib/LLVMSvf.so -Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMHPCFICmp.so&quot;</span></span><br><span class="line"><span class="comment">#CC=$CC CXX=$CXX ./waf configure --board=sitl</span></span><br><span class="line"></span><br><span class="line">CC=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/clang CXX=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/clang++ ./waf configure --board=sitl</span><br><span class="line"></span><br><span class="line">CC=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/clang CXX=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/clang++ LDFLAGS=<span class="string">&quot;-fuse-ld=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/ld.lld&quot;</span> ./waf configure --board=sitl</span><br><span class="line"></span><br><span class="line">./waf copter -v </span><br><span class="line"></span><br><span class="line"><span class="comment">#cd [构建文件夹]</span></span><br><span class="line"><span class="built_in">cd</span> /home/hzlg/Desktop/ardupilot/build/sitl/</span><br><span class="line"></span><br><span class="line">/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/clang++ -fuse-ld=lld -flto -Wl,--lto-whole-program-visibility ArduCopter/*.o -Llib -lArduCopter_libs -o arducopter.bc</span><br><span class="line"></span><br><span class="line"><span class="comment"># [path]替换为你的路径</span></span><br><span class="line">/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/llvm-ar -s lib/libArduCopter_libs.a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/clang++ -Wl,--export-dynamic -fuse-ld=lld -flto -Wl,--plugin-opt=emit-llvm -Wl,--lto-whole-program-visibility ArduCopter/*.o -Llib -lArduCopter_libs -o arducopter.bc</span><br><span class="line"></span><br><span class="line">llvm-dis arducopter.bc</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /home/hzlg/Desktop/hpcfi</span><br><span class="line"></span><br><span class="line">/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/clang++ -g -O1 -flto -flegacy-pass-manager -fuse-ld=lld -Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-svf/Release-build/lib/LLVMSvf.so,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMHPCFICmp.so ArduCopter/*.o -Llib -lArduCopter_libs -o arducopter_hpcfi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir -p /home/hzlg/Desktop/hpcfi/result</span><br><span class="line">runspec -c hpcfi.cfg -i <span class="built_in">test</span> -noreportable -o text,screen,pdf -n 1 401 2&gt;&amp;1 | tee /home/hzlg/Desktop/hpcfi/result/bc401.txt</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/clang -g -c -O1 -flto -flegacy-pass-manager -Xclang -load -Xclang /home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMMLTA.so main.c -o main.o</span><br><span class="line"></span><br><span class="line">/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/clang -g -O1 -flto -flegacy-pass-manager -fuse-ld=lld -Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-svf/Release-build/lib/LLVMSvf.so,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMHPCFICmp.so main.o -o main</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> LLVM=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build</span><br><span class="line"><span class="built_in">export</span> CLANG=<span class="variable">$&#123;LLVM&#125;</span>/bin/clang</span><br><span class="line"><span class="built_in">export</span> CLANGXX=<span class="variable">$&#123;LLVM&#125;</span>/bin/clang++</span><br><span class="line"><span class="built_in">export</span> AR=<span class="variable">$&#123;LLVM&#125;</span>/bin/llvm-ar</span><br><span class="line"><span class="built_in">export</span> LIBS=<span class="variable">$&#123;LLVM&#125;</span>/lib</span><br><span class="line"><span class="built_in">export</span> MLTALIB=<span class="variable">$&#123;LIBS&#125;</span>/LLVMMLTA.so</span><br><span class="line"><span class="built_in">export</span> HPCFICMPLIB=<span class="variable">$&#123;LIBS&#125;</span>/LLVMHPCFICmp.so</span><br><span class="line"><span class="built_in">export</span> HPCFIJMPLIB=<span class="variable">$&#123;LIBS&#125;</span>/LLVMHPCFIJmp.so</span><br><span class="line"><span class="built_in">export</span> SVFLIB=/home/hzlg/Desktop/hpcfi/hpcfi-svf/Release-build/lib/LLVMSvf.so</span><br><span class="line"></span><br><span class="line">CC=<span class="variable">$CLANG</span> CXX=<span class="variable">$CLANGXX</span> AR=<span class="variable">$AR</span> CFLAGS=<span class="string">&quot;-flto -flegacy-pass-manager -Xclang -load -Xclang <span class="variable">$&#123;MLTALIB&#125;</span> -O0 -g&quot;</span> CXXFLAGS=<span class="string">&quot;-flto -flegacy-pass-manager -Xclang -load -Xclang <span class="variable">$&#123;MLTALIB&#125;</span> -O0 -g&quot;</span> LDFLAGS=<span class="string">&quot;-flto -flegacy-pass-manager -fuse-ld=lld -Wl,-plugin-opt=-load=<span class="variable">$&#123;SVFLIB&#125;</span>,-plugin-opt=-load=<span class="variable">$&#123;HPCFICMPLIB&#125;</span>&quot;</span> ./waf configure --board sitl --static</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$&#123;CLANG&#125;</span>  -L/home/hzlg/Desktop/ardupilot/build/sitl/lib -g -O0 -flto -flegacy-pass-manager -fuse-ld=lld -Wl,-plugin-opt=-load=<span class="variable">$&#123;SVFLIB&#125;</span>,-plugin-opt=-load=<span class="variable">$&#123;HPCFICMPLIB&#125;</span> /home/hzlg/Desktop/ardupilot/build/sitl/ArduCopter/*.cpp.*.o -o ardupilot111 -Llib -lArduCopter_libs -lstdc++ -lm  -lgcc -lgcc_eh -lpthread -lc </span><br></pre></td></tr></table></figure>

<p>  143  CC=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/clang CXX=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/clang++  LDFLAGS=”-fuse-ld=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/lld” ./waf configure –board=sitl<br>  144  CC=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/clang CXX=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/clang++ ./waf configure –board=sitl</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/clang++ -Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-svf/Release-build/lib/LLVMSvf.so -Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMHPCFICmp.so -flto -fuse-ld=lld -fno-exceptions -Wl,--gc-sections -pthread A -obin/arducopter -Wl,-Bstatic -Llib -lArduCopter_libs -Wl,-Bdynamic -lm -fuse-ld=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/ld.lld</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export LLVM=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build export CLANG=$&#123;LLVM&#125;/bin/clang export CLANGXX=$&#123;LLVM&#125;/bin/clang++ export AR=$&#123;LLVM&#125;/bin/llvm-ar export LIBS=$&#123;LLVM&#125;/lib export MLTALIB=$&#123;LIBS&#125;/LLVMMLTA.so export HPCFICMPLIB=$&#123;LIBS&#125;/LLVMHPCFICmp.so export HPCFIJMPLIB=$&#123;LIBS&#125;/LLVMHPCFIJmp.so export SVFLIB=/home/hzlg/Desktop/hpcfi/hpcfi-svf/Release-build/lib/LLVMSvf.so</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/bin/clang++ -flegacy-pass-manager -Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-svf/Release-build/lib/LLVMSvf.so -Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMHPCFICmp.so -flto -fuse-ld=lld -fno-exceptions -Wl,--gc-sections -pthread ArduCopter/AP_Arming.cpp.48.o ArduCopter/AP_Rally.cpp.48.o ArduCopter/AP_State.cpp.48.o ArduCopter/Attitude.cpp.48.o ArduCopter/Copter.cpp.48.o ArduCopter/GCS_Copter.cpp.48.o ArduCopter/GCS_Mavlink.cpp.48.o ArduCopter/Log.cpp.48.o ArduCopter/Parameters.cpp.48.o ArduCopter/RC_Channel.cpp.48.o ArduCopter/UserCode.cpp.48.o ArduCopter/UserParameters.cpp.48.o ArduCopter/afs_copter.cpp.48.o ArduCopter/autoyaw.cpp.48.o ArduCopter/avoidance.cpp.48.o ArduCopter/avoidance_adsb.cpp.48.o ArduCopter/baro_ground_effect.cpp.48.o ArduCopter/commands.cpp.48.o ArduCopter/compassmot.cpp.48.o ArduCopter/crash_check.cpp.48.o ArduCopter/ekf_check.cpp.48.o ArduCopter/esc_calibration.cpp.48.o ArduCopter/events.cpp.48.o ArduCopter/failsafe.cpp.48.o ArduCopter/fence.cpp.48.o ArduCopter/heli.cpp.48.o ArduCopter/inertia.cpp.48.o ArduCopter/land_detector.cpp.48.o ArduCopter/landing_gear.cpp.48.o ArduCopter/mode.cpp.48.o ArduCopter/mode_acro.cpp.48.o ArduCopter/mode_acro_heli.cpp.48.o ArduCopter/mode_althold.cpp.48.o ArduCopter/mode_auto.cpp.48.o ArduCopter/mode_autorotate.cpp.48.o ArduCopter/mode_autotune.cpp.48.o ArduCopter/mode_avoid_adsb.cpp.48.o ArduCopter/mode_brake.cpp.48.o ArduCopter/mode_circle.cpp.48.o ArduCopter/mode_drift.cpp.48.o ArduCopter/mode_flip.cpp.48.o ArduCopter/mode_flowhold.cpp.48.o ArduCopter/mode_follow.cpp.48.o ArduCopter/mode_guided.cpp.48.o ArduCopter/mode_guided_nogps.cpp.48.o ArduCopter/mode_land.cpp.48.o ArduCopter/mode_loiter.cpp.48.o ArduCopter/mode_poshold.cpp.48.o ArduCopter/mode_rtl.cpp.48.o ArduCopter/mode_smart_rtl.cpp.48.o ArduCopter/mode_sport.cpp.48.o ArduCopter/mode_stabilize.cpp.48.o ArduCopter/mode_stabilize_heli.cpp.48.o ArduCopter/mode_systemid.cpp.48.o ArduCopter/mode_throw.cpp.48.o ArduCopter/mode_turtle.cpp.48.o ArduCopter/mode_zigzag.cpp.48.o ArduCopter/motor_test.cpp.48.o ArduCopter/motors.cpp.48.o ArduCopter/navigation.cpp.48.o ArduCopter/precision_landing.cpp.48.o ArduCopter/radio.cpp.48.o ArduCopter/sensors.cpp.48.o ArduCopter/standby.cpp.48.o ArduCopter/surface_tracking.cpp.48.o ArduCopter/system.cpp.48.o ArduCopter/takeoff.cpp.48.o ArduCopter/takeoff_check.cpp.48.o ArduCopter/terrain.cpp.48.o ArduCopter/toy_mode.cpp.48.o ArduCopter/tuning.cpp.48.o -obin/arducopter -Wl,-Bstatic -Llib -lArduCopter_libs -Wl,-Bdynamic -lm</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;CLANG&#125; -L/home/hzlg/Desktop/ardupilot/libraries/ -g -O1 -flto -flegacy-pass-manager -fuse-ld=lld -Wl,-plugin-opt=-load=$&#123;SVFLIB&#125;,-plugin-opt=-load=$&#123;HPCFICMPLIB&#125;  ./build/sitl/ArduCopter/*.o</span><br><span class="line">./ArduCopter/AP_Arming.cpp.48.o ./ArduCopter/AP_Rally.cpp.48.o ./ArduCopter/AP_State.cpp.48.o ./ArduCopter/Attitude.cpp.48.o ./ArduCopter/Copter.cpp.48.o ./ArduCopter/GCS_Copter.cpp.48.o ./ArduCopter/GCS_Mavlink.cpp.48.o ./ArduCopter/Log.cpp.48.o ./ArduCopter/Parameters.cpp.48.o ./ArduCopter/RC_Channel.cpp.48.o ./ArduCopter/UserCode.cpp.48.o ./ArduCopter/UserParameters.cpp.48.o ./ArduCopter/afs_copter.cpp.48.o ./ArduCopter/autoyaw.cpp.48.o ./ArduCopter/avoidance.cpp.48.o ./ArduCopter/avoidance_adsb.cpp.48.o ./ArduCopter/baro_ground_effect.cpp.48.o ./ArduCopter/commands.cpp.48.o ./ArduCopter/compassmot.cpp.48.o ./ArduCopter/crash_check.cpp.48.o ./ArduCopter/ekf_check.cpp.48.o ./ArduCopter/esc_calibration.cpp.48.o ./ArduCopter/events.cpp.48.o ./ArduCopter/failsafe.cpp.48.o ./ArduCopter/fence.cpp.48.o ./ArduCopter/heli.cpp.48.o ./ArduCopter/inertia.cpp.48.o ./ArduCopter/land_detector.cpp.48.o ./ArduCopter/landing_gear.cpp.48.o ./ArduCopter/mode.cpp.48.o ./ArduCopter/mode_acro.cpp.48.o ./ArduCopter/mode_acro_heli.cpp.48.o ./ArduCopter/mode_althold.cpp.48.o ./ArduCopter/mode_auto.cpp.48.o ./ArduCopter/mode_autorotate.cpp.48.o ./ArduCopter/mode_autotune.cpp.48.o ./ArduCopter/mode_avoid_adsb.cpp.48.o ./ArduCopter/mode_brake.cpp.48.o ./ArduCopter/mode_circle.cpp.48.o ./ArduCopter/mode_drift.cpp.48.o ./ArduCopter/mode_flip.cpp.48.o ./ArduCopter/mode_flowhold.cpp.48.o ./ArduCopter/mode_follow.cpp.48.o ./ArduCopter/mode_guided.cpp.48.o ./ArduCopter/mode_guided_nogps.cpp.48.o ./ArduCopter/mode_land.cpp.48.o ./ArduCopter/mode_loiter.cpp.48.o ./ArduCopter/mode_poshold.cpp.48.o ./ArduCopter/mode_rtl.cpp.48.o ./ArduCopter/mode_smart_rtl.cpp.48.o ./ArduCopter/mode_sport.cpp.48.o ./ArduCopter/mode_stabilize.cpp.48.o ./ArduCopter/mode_stabilize_heli.cpp.48.o ./ArduCopter/mode_systemid.cpp.48.o ./ArduCopter/mode_throw.cpp.48.o ./ArduCopter/mode_turtle.cpp.48.o ./ArduCopter/mode_zigzag.cpp.48.o ./ArduCopter/motor_test.cpp.48.o ./ArduCopter/motors.cpp.48.o ./ArduCopter/navigation.cpp.48.o ./ArduCopter/precision_landing.cpp.48.o ./ArduCopter/radio.cpp.48.o ./ArduCopter/sensors.cpp.48.o ./ArduCopter/standby.cpp.48.o ./ArduCopter/surface_tracking.cpp.48.o ./ArduCopter/system.cpp.48.o ./ArduCopter/takeoff.cpp.48.o ./ArduCopter/takeoff_check.cpp.48.o ./ArduCopter/terrain.cpp.48.o ./ArduCopter/toy_mode.cpp.48.o ./ArduCopter/tuning.cpp.48.o</span><br></pre></td></tr></table></figure>



<h2 id="TFA-1"><a href="#TFA-1" class="headerlink" title="TFA"></a>TFA</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/ArduPilot/ardupilot.git</span><br><span class="line"><span class="built_in">cd</span> ardupilot</span><br><span class="line">git checkout Copter-4.3.0</span><br><span class="line">git submodule update --init --recursive --force</span><br><span class="line">./Tools/environment_install/install-prereqs-ubuntu.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 修改ardupilot文件夹下的wscript文件，在<span class="function">def <span class="title">configure</span><span class="params">(cfg)</span>函数中添加如下代码:</span></span><br><span class="line"><span class="function"># 添加在以下代码下面</span></span><br><span class="line"><span class="function"># cfg.env.CXXFLAGS +=</span> [<span class="string">&#x27;-include&#x27;</span>, <span class="string">&#x27;ap_config.h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta"># llvm ir</span></span><br><span class="line">cfg.env.<span class="built_in">prepend_value</span>(<span class="string">&#x27;CFLAGS&#x27;</span>, [<span class="string">&#x27;-flto&#x27;</span>])</span><br><span class="line">cfg.env.<span class="built_in">prepend_value</span>(<span class="string">&#x27;CFLAGS&#x27;</span>, [<span class="string">&#x27;-fno-discard-value-names&#x27;</span>,<span class="string">&#x27;-fembed-bitcode&#x27;</span>])</span><br><span class="line">cfg.env.<span class="built_in">prepend_value</span>(<span class="string">&#x27;CXXFLAGS&#x27;</span>, [<span class="string">&#x27;-flto&#x27;</span>])</span><br><span class="line">cfg.env.<span class="built_in">prepend_value</span>(<span class="string">&#x27;CXXFLAGS&#x27;</span>, [<span class="string">&#x27;-fno-discard-value-names&#x27;</span>,<span class="string">&#x27;-fembed-bitcode&#x27;</span>,<span class="string">&#x27;-fwhole-program-vtables&#x27;</span>])</span><br><span class="line">cfg.env.<span class="built_in">prepend_value</span>(<span class="string">&#x27;LINKFLAGS&#x27;</span>,<span class="string">&#x27;-flto&#x27;</span>)</span><br><span class="line">cfg.env.<span class="built_in">prepend_value</span>(<span class="string">&#x27;LINKFLAGS&#x27;</span>,<span class="string">&#x27;-fuse-ld=ld.lld&#x27;</span>)</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CC=/home/hzlg/Desktop/llvm-project/build/bin/clang CXX=/home/hzlg/Desktop/llvm-project/build/bin/clang++  LDFLAGS=<span class="string">&quot;-fuse-ld=/home/hzlg/Desktop/llvm-project/build/bin/ld.lld&quot;</span> ./waf configure --board=sitl</span><br><span class="line"></span><br><span class="line">./waf copter -v</span><br><span class="line"></span><br><span class="line"><span class="comment">#cd [构建文件夹]</span></span><br><span class="line"><span class="built_in">cd</span> /home/hzlg/Desktop/ardupilot/build/sitl/</span><br><span class="line"></span><br><span class="line"><span class="comment"># [path]替换为你的路径</span></span><br><span class="line">/home/hzlg/Desktop/llvm-project/build/bin/llvm-ar -s lib/libArduCopter_libs.a</span><br><span class="line"></span><br><span class="line">/home/hzlg/Desktop/llvm-project/build/bin/clang++ -Wl,--export-dynamic -fuse-ld=lld -flto -Wl,--plugin-opt=emit-llvm -Wl,--lto-whole-program-visibility ArduCopter/*.o -Llib -lArduCopter_libs -o arducopter.bc</span><br><span class="line"></span><br><span class="line">llvm-dis arducopter.bc</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /home/hzlg/Desktop/TFA-project/build/lib</span><br><span class="line">mkdir -p result</span><br><span class="line">./analyzer /home/hzlg/Desktop/ardupilot/build/sitl/arducopter.bc 2&gt;&amp;1 | tee result/bc_ardupilot.txt</span><br></pre></td></tr></table></figure>

<p>/home/hzlg/Desktop/llvm-project/build/bin/llvm-ar -s lib/libArduCopter_libs.a</p>
<h1 id="PX4"><a href="#PX4" class="headerlink" title="PX4"></a>PX4</h1><h2 id="Deeptype-1"><a href="#Deeptype-1" class="headerlink" title="Deeptype"></a>Deeptype</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/PX4/PX4-Autopilot.git</span><br><span class="line"><span class="built_in">cd</span> PX4-Autopilot/</span><br><span class="line">git checkout v1.10.1</span><br><span class="line">git submodule update --init --recursive --force</span><br><span class="line">sudo apt install python3-pip</span><br><span class="line"><span class="comment">#sudo apt install python3-pip --fix-missing</span></span><br><span class="line">pip install empy==3.3.4</span><br><span class="line">pip3 install --user pyros-genmsg</span><br><span class="line">pip3 install --user jinja2</span><br><span class="line">pip3 install kconfiglib</span><br><span class="line">pip3 install --user jsonschema</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.新建[px4_root_dir]/set_compiler.sh文件：</span><br><span class="line">vim set_compiler.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PREFIX=<span class="string">&quot;/home/hzlg/Desktop/llvm-project/build&quot;</span></span><br><span class="line"><span class="built_in">export</span> CC=<span class="string">&quot;<span class="variable">$PREFIX</span>/bin/clang&quot;</span></span><br><span class="line"><span class="built_in">export</span> CFLAGS=<span class="string">&quot;-O0 -flto -g -Xclang -no-opaque-pointers -fno-discard-value-names -fembed-bitcode&quot;</span></span><br><span class="line"><span class="built_in">export</span> CXX=<span class="string">&quot;<span class="variable">$PREFIX</span>/bin/clang++ -v&quot;</span></span><br><span class="line"><span class="built_in">export</span> CXXFLAGS=<span class="string">&quot;-O0 -flto -g -Xclang -no-opaque-pointers -fno-discard-value-names -fembed-bitcode -fwhole-program-vtables&quot;</span></span><br><span class="line"><span class="built_in">export</span> AR=<span class="string">&quot;<span class="variable">$PREFIX</span>/bin/llvm-ar&quot;</span></span><br><span class="line"><span class="built_in">export</span> LD=<span class="string">&quot;<span class="variable">$PREFIX</span>/bin/lld&quot;</span></span><br><span class="line"><span class="built_in">export</span> NM=<span class="string">&quot;<span class="variable">$PREFIX</span>/bin/nm&quot;</span></span><br><span class="line"><span class="built_in">export</span> RANLIB=<span class="string">&quot;<span class="variable">$PREFIX</span>/bin/llvm-ranlib&quot;</span></span><br><span class="line"><span class="built_in">export</span> LDFLAGS=<span class="string">&quot;-fuse-ld=lld -flto&quot;</span></span><br><span class="line"></span><br><span class="line">2.修改[px4_root_dir]/CMakeLists.txt文件：</span><br><span class="line">vim CMakeLists.txt</span><br><span class="line"></span><br><span class="line">project(px4 CXX C ASM)</span><br><span class="line"><span class="comment"># 在以上代码下一行添加下列代码</span></span><br><span class="line"><span class="built_in">set</span> (CMAKE_BUILD_TYPE <span class="string">&quot;Debug&quot;</span> CACHE STRING <span class="string">&quot;Choose the type of build.&quot;</span> FORCE)</span><br><span class="line">  </span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># gold linker - use if available (posix only for now)</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$&#123;PX4_PLATFORM&#125;</span> STREQUAL <span class="string">&quot;posix&quot;</span>)</span><br><span class="line">  include(CMakeDependentOption)</span><br><span class="line">  CMAKE_DEPENDENT_OPTION(USE_LD_GOLD</span><br><span class="line">      <span class="string">&quot;Use GNU gold linker&quot;</span> ON</span><br><span class="line">      <span class="string">&quot;NOT WIN32;NOT APPLE&quot;</span> OFF</span><br><span class="line">  )</span><br><span class="line"><span class="comment"># 在以上代码下一行添加下列代码，不使用gold链接器</span></span><br><span class="line"><span class="built_in">set</span>(USE_LD_GOLD OFF)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.在[px4_root_dir]/cmake/px4_add_common_flags.cmake：</span><br><span class="line">vim cmake/px4_add_common_flags.cmake</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注释-Werror</span></span><br><span class="line"><span class="comment"># -Werror</span></span><br><span class="line"></span><br><span class="line">4.修改[px4_root_dir]/platforms/common/px4_work_queue/WorkQueueManager.cpp：</span><br><span class="line">vim platforms/common/px4_work_queue/WorkQueueManager.cpp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改以下代码。这里是一个bug，clang-15编译器认为模板的传入必须一致，PTHREAD_STACK_MIN是long类型而PX4_STACK_ADJUSTED(wq-&gt;stacksize)是int型，因此编译无法通过</span></span><br><span class="line">const size_t stacksize = math::max(PTHREAD_STACK_MIN, PX4_STACK_ADJUSTED(wq-&gt;stacksize));</span><br><span class="line">const size_t stacksize = math::max((int)PTHREAD_STACK_MIN, PX4_STACK_ADJUSTED(wq-&gt;stacksize));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5.编译：</span><br><span class="line"><span class="built_in">source</span> set_compiler.sh</span><br><span class="line">CC=<span class="variable">$CC</span> CXX=<span class="variable">$CXX</span> CFLAGS=<span class="variable">$CFLAGS</span> CXXFLAGS=<span class="variable">$CXXFLAGS</span> LDFLAGS=<span class="variable">$LDFLAGS</span> make px4_sitl</span><br><span class="line"></span><br><span class="line">6.获得IR：</span><br><span class="line"><span class="built_in">cd</span> build/px4_sitl_default</span><br><span class="line"></span><br><span class="line"><span class="comment">#获得IR</span></span><br><span class="line"><span class="built_in">export</span> LLVM_SYMBOLIZER_PATH=/home/hzlg/Desktop/llvm-project/build/bin/llvm-symbolizer</span><br><span class="line"></span><br><span class="line">/home/hzlg/Desktop/llvm-project/build/bin/clang++ -Wl,--export-dynamic -fuse-ld=lld -flto -Wl,--plugin-opt=emit-llvm -Wl,--lto-whole-program-visibility -Wl,-plugin-opt=no-opaque-pointers  $(find ./platforms/posix/CMakeFiles/px4.dir/ -<span class="built_in">type</span> f -name <span class="string">&quot;*.o&quot;</span>)  -o px4.bc $(find ./ -<span class="built_in">type</span> f -name <span class="string">&quot;*.a&quot;</span>)</span><br><span class="line"></span><br><span class="line">/home/hzlg/Desktop/llvm-project/build/bin/llvm-dis px4.bc</span><br><span class="line">grep <span class="string">&quot;ptr&quot;</span> px4.ll</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /home/hzlg/Desktop/DeepType/build/lib</span><br><span class="line">mkdir -p result</span><br><span class="line">./kanalyzer /home/hzlg/Desktop/PX4-Autopilot/build/px4_sitl_default/px4.bc 2&gt;&amp;1 | tee result/bc_px4.txt</span><br></pre></td></tr></table></figure>

<h2 id="hpcfi"><a href="#hpcfi" class="headerlink" title="hpcfi"></a>hpcfi</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/PX4/PX4-Autopilot.git</span><br><span class="line"><span class="built_in">cd</span> PX4-Autopilot/</span><br><span class="line">git submodule update --init --recursive --force</span><br><span class="line">sudo apt install python3-pip</span><br><span class="line"><span class="comment">#sudo apt install python3-pip --fix-missing</span></span><br><span class="line">pip install empy==3.3.4</span><br><span class="line">pip3 install --user pyros-genmsg</span><br><span class="line">pip3 install --user jinja2</span><br><span class="line">pip3 install kconfiglib</span><br><span class="line">pip3 install --user jsonschema</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.新建[px4_root_dir]/set_compiler.sh文件：</span><br><span class="line">vim set_compiler.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PREFIX=<span class="string">&quot;/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build&quot;</span> <span class="comment"># 替换为自己的路径</span></span><br><span class="line"><span class="built_in">export</span> CC=<span class="string">&quot;<span class="variable">$PREFIX</span>/bin/clang&quot;</span></span><br><span class="line"><span class="built_in">export</span> CFLAGS=<span class="string">&quot;-g -O1 -flto -flegacy-pass-manager -Xclang -load -Xclang /home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMMLTA.so&quot;</span></span><br><span class="line"><span class="built_in">export</span> CXX=<span class="string">&quot;<span class="variable">$PREFIX</span>/bin/clang++ -v&quot;</span> <span class="comment"># 这个 -v 是为了获取link过程，便于后续生成IR</span></span><br><span class="line"><span class="built_in">export</span> CXXFLAGS=<span class="string">&quot;-g -O1 -flto -flegacy-pass-manager -Xclang -load -Xclang /home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMMLTA.so&quot;</span></span><br><span class="line"><span class="built_in">export</span> AR=<span class="string">&quot;<span class="variable">$PREFIX</span>/bin/llvm-ar&quot;</span></span><br><span class="line"><span class="built_in">export</span> LD=<span class="string">&quot;<span class="variable">$PREFIX</span>/bin/lld&quot;</span></span><br><span class="line"><span class="built_in">export</span> NM=<span class="string">&quot;<span class="variable">$PREFIX</span>/bin/nm&quot;</span></span><br><span class="line"><span class="built_in">export</span> RANLIB=<span class="string">&quot;<span class="variable">$PREFIX</span>/bin/llvm-ranlib&quot;</span></span><br><span class="line"><span class="built_in">export</span> LDFLAGS=<span class="string">&quot;-fuse-ld=lld -flto -flegacy-pass-manager -Wl,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-svf/Release-build/lib/LLVMSvf.so,-plugin-opt=-load=/home/hzlg/Desktop/hpcfi/hpcfi-llvm-project/build/lib/LLVMHPCFICmp.so&quot;</span></span><br><span class="line"></span><br><span class="line">2.修改[px4_root_dir]/CMakeLists.txt文件：</span><br><span class="line">vim CMakeLists.txt</span><br><span class="line"></span><br><span class="line">project(px4 CXX C ASM)</span><br><span class="line"><span class="comment"># 在以上代码下一行添加下列代码</span></span><br><span class="line"><span class="built_in">set</span> (CMAKE_BUILD_TYPE <span class="string">&quot;Debug&quot;</span> CACHE STRING <span class="string">&quot;Choose the type of build.&quot;</span> FORCE)</span><br><span class="line">  </span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># gold linker - use if available (posix only for now)</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$&#123;PX4_PLATFORM&#125;</span> STREQUAL <span class="string">&quot;posix&quot;</span>)</span><br><span class="line">  include(CMakeDependentOption)</span><br><span class="line">  CMAKE_DEPENDENT_OPTION(USE_LD_GOLD</span><br><span class="line">      <span class="string">&quot;Use GNU gold linker&quot;</span> ON</span><br><span class="line">      <span class="string">&quot;NOT WIN32;NOT APPLE&quot;</span> OFF</span><br><span class="line">  )</span><br><span class="line"><span class="comment"># 在以上代码下一行添加下列代码，不使用gold链接器</span></span><br><span class="line"><span class="built_in">set</span>(USE_LD_GOLD OFF)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.在[px4_root_dir]/cmake/px4_add_common_flags.cmake：</span><br><span class="line">vim cmake/px4_add_common_flags.cmake</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注释-Werror</span></span><br><span class="line"><span class="comment"># -Werror</span></span><br><span class="line"></span><br><span class="line">4.修改[px4_root_dir]/platforms/common/px4_work_queue/WorkQueueManager.cpp：</span><br><span class="line">vim platforms/common/px4_work_queue/WorkQueueManager.cpp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改以下代码。这里是一个bug，clang-15编译器认为模板的传入必须一致，PTHREAD_STACK_MIN是long类型而PX4_STACK_ADJUSTED(wq-&gt;stacksize)是int型，因此编译无法通过</span></span><br><span class="line">const size_t stacksize = math::max(PTHREAD_STACK_MIN, PX4_STACK_ADJUSTED(wq-&gt;stacksize));</span><br><span class="line">const size_t stacksize = math::max((int)PTHREAD_STACK_MIN, PX4_STACK_ADJUSTED(wq-&gt;stacksize));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5.编译：</span><br><span class="line"><span class="built_in">source</span> set_compiler.sh</span><br><span class="line">CC=<span class="variable">$CC</span> CXX=<span class="variable">$CXX</span> CFLAGS=<span class="variable">$CFLAGS</span> CXXFLAGS=<span class="variable">$CXXFLAGS</span> LDFLAGS=<span class="variable">$LDFLAGS</span> make px4_sitl</span><br></pre></td></tr></table></figure>



<h1 id="easy"><a href="#easy" class="headerlink" title="easy"></a>easy</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Hello from Base!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived</span> :</span> <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Hello from Derived!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Base *basePtr = <span class="keyword">new</span> <span class="built_in">Derived</span>();</span><br><span class="line">    basePtr-&gt;<span class="built_in">hello</span>();</span><br><span class="line">    <span class="keyword">delete</span> basePtr;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="DeepType-1"><a href="#DeepType-1" class="headerlink" title="DeepType"></a>DeepType</h2><p>/home/hzlg/Desktop/llvm-project/build/bin/clang++ -emit-llvm -c -g -Xclang -no-opaque-pointers hello.cpp -o hello.bc</p>
<p>./kanalyzer ../../../test/hello.bc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Total 1 file(s)</span><br><span class="line">[CallGraph] Initializing 1 modules </span><br><span class="line">Collecting information...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[CallGraph / 1] [1 / 1] [../../../test/hello.bc]</span><br><span class="line">Identify indirect call targets with SMLTA...</span><br><span class="line"></span><br><span class="line">1 Call Site hello.cpp:19:14</span><br><span class="line">Call site type: void (oid (%class.Base*)*|class.Derived</span><br><span class="line">No target.</span><br><span class="line"></span><br><span class="line">[CallGraph] Updated in 0 modules.</span><br><span class="line">[CallGraph] Done!</span><br><span class="line"></span><br><span class="line">############## DeepType Result Statistics ##############</span><br><span class="line"># Number of indirect calls: 			1</span><br><span class="line"># Number of indirect-call targets: 		0</span><br><span class="line"># Number of address-taken functions: 		3</span><br><span class="line"># Number of 0-target i-calls: 			1</span><br><span class="line"># Ave. Number of indirect-call targets: 	0.00</span><br><span class="line">Stage 1 1 ms</span><br><span class="line">Stage 2 0 ms</span><br><span class="line">total 1 ms</span><br></pre></td></tr></table></figure>

<h2 id="MLTA-2"><a href="#MLTA-2" class="headerlink" title="MLTA"></a>MLTA</h2><ol>
<li>准备 bitcode</li>
</ol>
<p>export PATH =/home/hzlg/Desktop/mlta/llvm-project/prefix/bin/:$PATH</p>
<p>clang++ -Wno-error -g -Xclang -no-opaque-pointers -Xclang -flegacy-pass-manager -Xclang -load -Xclang /home/hzlg/Desktop/mlta/IRDumper/build/lib/libDumper.so hello.cpp</p>
<ol start="2">
<li>分析 bc</li>
</ol>
<p>./kanalyzer ../../../test/src/hello.c.bc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Total 1 file(s)</span><br><span class="line">[CallGraph] Initializing 1 modules #0 Initializing: ../../../test/src/hello.c.bc</span><br><span class="line">.</span><br><span class="line">[CallGraph / 1] [1 / 1] [../../../test/src/hello.c.bc]</span><br><span class="line">== Warning: please specify the path of linux source. [RESOLVING] hello.cpp +19</span><br><span class="line">== Warning: please specify the path of linux source. [CALLER] hello.cpp +19</span><br><span class="line"></span><br><span class="line">	 Indirect-call targets: (3)</span><br><span class="line">== Warning: please specify the path of linux source. [TARGET] hello.cpp +12</span><br><span class="line">== Warning: please specify the path of linux source. [TARGET] hello.cpp +5</span><br><span class="line">== Warning: please specify the path of linux source. [TARGET] hello.cpp +0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[CallGraph] Updated in 0 modules.</span><br><span class="line">[CallGraph] Postprocessing ...</span><br><span class="line">[CallGraph] Done!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@@ Total number of final callees: 3.</span><br><span class="line">############## Result Statistics ##############</span><br><span class="line"># Number of indirect calls: 			1</span><br><span class="line"># Number of indirect calls with targets: 	1</span><br><span class="line"># Number of indirect-call targets: 		3</span><br><span class="line"># Number of address-taken functions: 		5</span><br><span class="line"># Number of multi-layer calls: 			0</span><br><span class="line"># Number of multi-layer targets: 		0</span><br><span class="line"># Number of one-layer calls: 			1</span><br><span class="line"># Number of one-layer targets: 			3</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Total 1 file(s)</span><br><span class="line">[CallGraph] Initializing 1 modules #0 Initializing: ../../../test/src/hello2.bc</span><br><span class="line">.</span><br><span class="line">[CallGraph / 1] [1 / 1] [../../../test/src/hello2.bc]</span><br><span class="line">== Warning: please specify the path of linux source. [RESOLVING] hello.cpp +19</span><br><span class="line">== Warning: please specify the path of linux source. [CALLER] hello.cpp +19</span><br><span class="line"></span><br><span class="line">	 Indirect-call targets: (3)</span><br><span class="line">== Warning: please specify the path of linux source. [TARGET] hello.cpp +12</span><br><span class="line">== Warning: please specify the path of linux source. [TARGET] hello.cpp +5</span><br><span class="line">== Warning: please specify the path of linux source.</span><br><span class="line"></span><br><span class="line"> [TARGET] hello.cpp +0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[CallGraph] Updated in 0 modules.</span><br><span class="line">[CallGraph] Postprocessing ...</span><br><span class="line">[CallGraph] Done!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@@ Total number of final callees: 3.</span><br><span class="line">############## Result Statistics ##############</span><br><span class="line"># Number of indirect calls: 			1</span><br><span class="line"># Number of indirect calls with targets: 	1</span><br><span class="line"># Number of indirect-call targets: 		3</span><br><span class="line"># Number of address-taken functions: 		5</span><br><span class="line"># Number of multi-layer calls: 			0</span><br><span class="line"># Number of multi-layer targets: 		0</span><br><span class="line"># Number of one-layer calls: 			1</span><br><span class="line"># Number of one-layer targets: 			3</span><br></pre></td></tr></table></figure>


      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/CFI/" rel="tag"># CFI</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2025/02/24/indirect-call/MLTA/" rel="next" title="MLTA">
                <i class="fa fa-chevron-left"></i> MLTA
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2025/03/06/%E7%8E%AF%E5%A2%83%20%E5%B7%A5%E5%85%B7/git/" rel="prev" title="git">
                git <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="" />
          <p class="site-author-name" itemprop="name"></p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">108</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">15</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9"><span class="nav-number">1.</span> <span class="nav-text">修改</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%95%88%E6%9E%9C%EF%BC%9A"><span class="nav-number">1.0.0.0.1.</span> <span class="nav-text">效果：</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#spec"><span class="nav-number">2.</span> <span class="nav-text">spec</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MLTA"><span class="nav-number">2.1.</span> <span class="nav-text">MLTA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DeepType"><span class="nav-number">2.2.</span> <span class="nav-text">DeepType</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TFA"><span class="nav-number">2.3.</span> <span class="nav-text">TFA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LLVM-CFI"><span class="nav-number">2.4.</span> <span class="nav-text">LLVM-CFI</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LLVM-patched"><span class="nav-number">2.5.</span> <span class="nav-text">LLVM-patched</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HPCFI"><span class="nav-number">2.6.</span> <span class="nav-text">HPCFI</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ArduPilot-4-3-0"><span class="nav-number">3.</span> <span class="nav-text">ArduPilot 4.3.0</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MLTA-1"><span class="nav-number">3.1.</span> <span class="nav-text">MLTA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Deeptype"><span class="nav-number">3.2.</span> <span class="nav-text">Deeptype</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HPCFI-1"><span class="nav-number">3.3.</span> <span class="nav-text">HPCFI</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TFA-1"><span class="nav-number">3.4.</span> <span class="nav-text">TFA</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PX4"><span class="nav-number">4.</span> <span class="nav-text">PX4</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Deeptype-1"><span class="nav-number">4.1.</span> <span class="nav-text">Deeptype</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hpcfi"><span class="nav-number">4.2.</span> <span class="nav-text">hpcfi</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#easy"><span class="nav-number">5.</span> <span class="nav-text">easy</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#DeepType-1"><span class="nav-number">5.1.</span> <span class="nav-text">DeepType</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MLTA-2"><span class="nav-number">5.2.</span> <span class="nav-text">MLTA</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hzlg</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
